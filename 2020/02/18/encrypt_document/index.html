<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">

<script>
    (function(){
        if(''){
            if (prompt('请输入密码') !== ''){
                alert('密码错误');
                history.back();
            }
        }
    })();
</script>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Crypto,algorithm," />










<meta name="description" content="去年看对称加密算法写的一些文档，补了几个坑，剩下的坑有空再补（咕咕咕">
<meta property="og:type" content="article">
<meta property="og:title" content="对称加密算法&amp;&amp;Hash算法 文档">
<meta property="og:url" content="http://yoursite.com/2020/02/18/encrypt_document/index.html">
<meta property="og:site_name" content="feng&#39;s blog">
<meta property="og:description" content="去年看对称加密算法写的一些文档，补了几个坑，剩下的坑有空再补（咕咕咕">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://yoursite.com/images/DES%E5%9B%BE%E8%A7%A3.PNG">
<meta property="og:image" content="http://yoursite.com/images/TEA.png">
<meta property="og:image" content="http://yoursite.com/images/XTEA.PNG">
<meta property="og:image" content="http://yoursite.com/images/XXTEA.PNG">
<meta property="og:image" content="http://yoursite.com/images/MD5.png">
<meta property="og:image" content="http://yoursite.com/images/md5%E7%A2%B0%E6%92%9E.PNG">
<meta property="article:published_time" content="2020-02-17T16:00:00.000Z">
<meta property="article:modified_time" content="2020-04-05T10:13:08.240Z">
<meta property="article:author" content="feng">
<meta property="article:tag" content="Crypto">
<meta property="article:tag" content="algorithm">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/images/DES%E5%9B%BE%E8%A7%A3.PNG">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2020/02/18/encrypt_document/"/>





  <title>对称加密算法&&Hash算法 文档 | feng's blog</title>
  








<meta name="generator" content="Hexo 4.2.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">feng's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/18/encrypt_document/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="feng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/feng.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="feng's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">对称加密算法&&Hash算法 文档</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-02-18T00:00:00+08:00">
                2020-02-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>去年看对称加密算法写的一些文档，补了几个坑，剩下的坑有空再补（咕咕咕</p>
<a id="more"></a>
<h2 id="对称加密算法"><a href="#对称加密算法" class="headerlink" title="对称加密算法"></a>对称加密算法</h2><blockquote>
<p><strong>对称密钥算法</strong>（英语：<strong>Symmetric-key algorithm</strong>）又称为<strong>对称加密</strong>、<strong>私钥加密</strong>、<strong>共享密钥加密</strong>，是密码学中的一类加密算法。这类算法在加密和解密时使用相同的密钥，或是使用两个可以简单地相互推算的密钥。算法安全性依赖于加密算法强度以及密钥的保密。</p>
<p>常见的对称加密算法有DES、3DES、AES、SM4、Blowfish、IDEA、TEA、RC4、RC5、RC6。对称加密的速度比公钥加密快很多，在很多场合都需要对称加密。</p>
</blockquote>
<h3 id="DES、3DES"><a href="#DES、3DES" class="headerlink" title="DES、3DES"></a>DES、3DES</h3><h4 id="关于DES"><a href="#关于DES" class="headerlink" title="关于DES"></a>关于DES</h4><blockquote>
<p>DES(Data Encryption Standard)，是一种对称密钥块密码算法，分组大小为64位，密钥长度为56位（长度总共为64位，实际为56位，第8、16、24、32、40、48、56、64位是校验位）</p>
<p>3DES(Triple Data Encryption Algorithm)，相当于对每个数据块应用三次DES即（DES_encrypt(DES_decrypt(DES_encrypt(plainText)))</p>
</blockquote>
<h4 id="算法原理"><a href="#算法原理" class="headerlink" title="算法原理"></a>算法原理</h4><h5 id="IP表初始置换"><a href="#IP表初始置换" class="headerlink" title="IP表初始置换"></a>IP表初始置换</h5><p>64位明文通过IP初始置换表置换为L0（置换后的数据的前32位），R0（置换后的数据的后32位）</p>
<h5 id="子密钥生成"><a href="#子密钥生成" class="headerlink" title="子密钥生成"></a>子密钥生成</h5><p>通过PC1置换表将56位密钥置换位C0（置换后的数据的前28位），D0（置换后的数据的后32位）</p>
<p>将C0，D0分别循环位移（位移表固定{ 1, 1, 2, 2, 2, 2, 2, 2, 1, 2, 2, 2, 2, 2, 2, 1}）得到C1、D1</p>
<p>C1、D1合并，通过PC2置换表得到第一个子密钥K1</p>
<p>回到第二步继续循环，得到子密钥K2、K3、……、K16</p>
<h5 id="迭代加密"><a href="#迭代加密" class="headerlink" title="迭代加密"></a>迭代加密</h5><p><strong>f函数</strong>（16轮）</p>
<p>Ln = R(n - 1)；</p>
<p>Rn = L(n - 1)⊕f(Rn-1,kn-1)</p>
<p>其中涉及到E盒扩展、S盒压缩</p>
<p>Rn通过<strong>E盒</strong>由32位扩展到48位，而后与子密钥异或</p>
<p>异或得到的48位分为8个6位分组，分别进入S1——S8替换压缩，S盒有8个，每个64位，输入数据为6位，输出数据为4位，得到8个4位分组，即将48位数据通过<strong>S盒</strong>压缩成32位</p>
<p><strong>S盒</strong>压缩得到的32位数据通过<strong>P盒</strong>置换得到新的32位数据</p>
<p><strong>P盒</strong>置换得到的32位数据与Ln异或得到Rn+1</p>
<p>回到f函数继续迭代15轮（总共16轮）</p>
<p>将L16和R16整体<strong>互换位置</strong>（第16轮结束后）并且合并得到64位数据</p>
<h5 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h5><p>将得到的64位数据通过<strong>IP逆置换表</strong>置换得到64位数据并输出，这就是密文了</p>
<h5 id="图解"><a href="#图解" class="headerlink" title="图解"></a>图解</h5><p>图片来源于看雪会员Yangs的帖子，<a href="https://bbs.pediy.com/thread-90593.htm，我更正了少许错误" target="_blank" rel="noopener">https://bbs.pediy.com/thread-90593.htm，我更正了少许错误</a></p>
<p><img src="/images/DES%E5%9B%BE%E8%A7%A3.PNG" alt=""></p>
<h5 id="解密"><a href="#解密" class="headerlink" title="解密"></a>解密</h5><p>解密过程与加密过程算法基本相同，唯一不同点的是子密钥要逆序使用，所以只要改变子密钥的顺序，逆序使用就可以得到明文了</p>
<h4 id="DES加解密实现"><a href="#DES加解密实现" class="headerlink" title="DES加解密实现"></a>DES加解密实现</h4><p>C/C++实现</p>
<p>from <a href="https://cloud.tencent.com/developer/article/1016180" target="_blank" rel="noopener">https://cloud.tencent.com/developer/article/1016180</a></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//from https://cloud.tencent.com/developer/article/1016180</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//  IP 初始置换表</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> IP_Init_Table[<span class="number">64</span>] = &#123;</span><br><span class="line">    <span class="number">58</span>, <span class="number">50</span>, <span class="number">42</span>, <span class="number">34</span>, <span class="number">26</span>, <span class="number">18</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">60</span>, <span class="number">52</span>, <span class="number">44</span>, <span class="number">36</span>, <span class="number">28</span>, <span class="number">20</span>, <span class="number">12</span>, <span class="number">4</span>,</span><br><span class="line">    <span class="number">62</span>, <span class="number">54</span>, <span class="number">46</span>, <span class="number">38</span>, <span class="number">30</span>, <span class="number">22</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">64</span>, <span class="number">56</span>, <span class="number">48</span>, <span class="number">40</span>, <span class="number">32</span>, <span class="number">24</span>, <span class="number">16</span>, <span class="number">8</span>,</span><br><span class="line">    <span class="number">57</span>, <span class="number">49</span>, <span class="number">41</span>, <span class="number">33</span>, <span class="number">25</span>, <span class="number">17</span>, <span class="number">9</span>,  <span class="number">1</span>, <span class="number">59</span>, <span class="number">51</span>, <span class="number">43</span>, <span class="number">35</span>, <span class="number">27</span>, <span class="number">19</span>, <span class="number">11</span>, <span class="number">3</span>,</span><br><span class="line">    <span class="number">61</span>, <span class="number">53</span>, <span class="number">45</span>, <span class="number">37</span>, <span class="number">29</span>, <span class="number">21</span>, <span class="number">13</span>, <span class="number">5</span>, <span class="number">63</span>, <span class="number">55</span>, <span class="number">47</span>, <span class="number">39</span>, <span class="number">31</span>, <span class="number">23</span>, <span class="number">15</span>, <span class="number">7</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  E 扩展表</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> E_Table[<span class="number">48</span>] = &#123;<span class="number">32</span>, <span class="number">1</span>,  <span class="number">2</span>,  <span class="number">3</span>,  <span class="number">4</span>,  <span class="number">5</span>,  <span class="number">4</span>,  <span class="number">5</span>,  <span class="number">6</span>,  <span class="number">7</span>,  <span class="number">8</span>,  <span class="number">9</span>,</span><br><span class="line">                         <span class="number">8</span>,  <span class="number">9</span>,  <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>,</span><br><span class="line">                         <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>,</span><br><span class="line">                         <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">32</span>, <span class="number">1</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  P 盒</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> P_Table[<span class="number">32</span>] = &#123;<span class="number">16</span>, <span class="number">7</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">29</span>, <span class="number">12</span>, <span class="number">28</span>, <span class="number">17</span>, <span class="number">1</span>,  <span class="number">15</span>, <span class="number">23</span>,</span><br><span class="line">                         <span class="number">26</span>, <span class="number">5</span>, <span class="number">18</span>, <span class="number">31</span>, <span class="number">10</span>, <span class="number">2</span>,  <span class="number">8</span>,  <span class="number">24</span>, <span class="number">14</span>, <span class="number">32</span>, <span class="number">27</span>,</span><br><span class="line">                         <span class="number">3</span>,  <span class="number">9</span>, <span class="number">19</span>, <span class="number">13</span>, <span class="number">30</span>, <span class="number">6</span>,  <span class="number">22</span>, <span class="number">11</span>, <span class="number">4</span>,  <span class="number">25</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  IP 逆置换表</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> IPR_Table[<span class="number">64</span>] = &#123;<span class="number">40</span>, <span class="number">8</span>,  <span class="number">48</span>, <span class="number">16</span>, <span class="number">56</span>, <span class="number">24</span>, <span class="number">64</span>, <span class="number">32</span>, <span class="number">39</span>, <span class="number">7</span>,  <span class="number">47</span>, <span class="number">15</span>, <span class="number">55</span>,</span><br><span class="line">                           <span class="number">23</span>, <span class="number">63</span>, <span class="number">31</span>, <span class="number">38</span>, <span class="number">6</span>,  <span class="number">46</span>, <span class="number">14</span>, <span class="number">54</span>, <span class="number">22</span>, <span class="number">62</span>, <span class="number">30</span>, <span class="number">37</span>, <span class="number">5</span>,</span><br><span class="line">                           <span class="number">45</span>, <span class="number">13</span>, <span class="number">53</span>, <span class="number">21</span>, <span class="number">61</span>, <span class="number">29</span>, <span class="number">36</span>, <span class="number">4</span>,  <span class="number">44</span>, <span class="number">12</span>, <span class="number">52</span>, <span class="number">20</span>, <span class="number">60</span>,</span><br><span class="line">                           <span class="number">28</span>, <span class="number">35</span>, <span class="number">3</span>,  <span class="number">43</span>, <span class="number">11</span>, <span class="number">51</span>, <span class="number">19</span>, <span class="number">59</span>, <span class="number">27</span>, <span class="number">34</span>, <span class="number">2</span>,  <span class="number">42</span>, <span class="number">10</span>,</span><br><span class="line">                           <span class="number">50</span>, <span class="number">18</span>, <span class="number">58</span>, <span class="number">26</span>, <span class="number">33</span>, <span class="number">1</span>,  <span class="number">41</span>, <span class="number">9</span>,  <span class="number">49</span>, <span class="number">17</span>, <span class="number">57</span>, <span class="number">25</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  密钥第一次置换表</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> PC1_Table[<span class="number">56</span>] = &#123;</span><br><span class="line">    <span class="number">57</span>, <span class="number">49</span>, <span class="number">41</span>, <span class="number">33</span>, <span class="number">25</span>, <span class="number">17</span>, <span class="number">9</span>,  <span class="number">1</span>,  <span class="number">58</span>, <span class="number">50</span>, <span class="number">42</span>, <span class="number">34</span>, <span class="number">26</span>, <span class="number">18</span>, <span class="number">10</span>, <span class="number">2</span>,  <span class="number">59</span>, <span class="number">51</span>, <span class="number">43</span>,</span><br><span class="line">    <span class="number">35</span>, <span class="number">27</span>, <span class="number">19</span>, <span class="number">11</span>, <span class="number">3</span>,  <span class="number">60</span>, <span class="number">52</span>, <span class="number">44</span>, <span class="number">36</span>, <span class="number">63</span>, <span class="number">55</span>, <span class="number">47</span>, <span class="number">39</span>, <span class="number">31</span>, <span class="number">23</span>, <span class="number">15</span>, <span class="number">7</span>,  <span class="number">62</span>, <span class="number">54</span>,</span><br><span class="line">    <span class="number">46</span>, <span class="number">38</span>, <span class="number">30</span>, <span class="number">22</span>, <span class="number">14</span>, <span class="number">6</span>,  <span class="number">61</span>, <span class="number">53</span>, <span class="number">45</span>, <span class="number">37</span>, <span class="number">29</span>, <span class="number">21</span>, <span class="number">13</span>, <span class="number">5</span>,  <span class="number">28</span>, <span class="number">20</span>, <span class="number">12</span>, <span class="number">4</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  密钥第二次置换表</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> PC2_Table[<span class="number">48</span>] = &#123;<span class="number">14</span>, <span class="number">17</span>, <span class="number">11</span>, <span class="number">24</span>, <span class="number">1</span>,  <span class="number">5</span>,  <span class="number">3</span>,  <span class="number">28</span>, <span class="number">15</span>, <span class="number">6</span>,  <span class="number">21</span>, <span class="number">10</span>,</span><br><span class="line">                           <span class="number">23</span>, <span class="number">19</span>, <span class="number">12</span>, <span class="number">4</span>,  <span class="number">26</span>, <span class="number">8</span>,  <span class="number">16</span>, <span class="number">7</span>,  <span class="number">27</span>, <span class="number">20</span>, <span class="number">13</span>, <span class="number">2</span>,</span><br><span class="line">                           <span class="number">41</span>, <span class="number">52</span>, <span class="number">31</span>, <span class="number">37</span>, <span class="number">47</span>, <span class="number">55</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">51</span>, <span class="number">45</span>, <span class="number">33</span>, <span class="number">48</span>,</span><br><span class="line">                           <span class="number">44</span>, <span class="number">49</span>, <span class="number">39</span>, <span class="number">56</span>, <span class="number">34</span>, <span class="number">53</span>, <span class="number">46</span>, <span class="number">42</span>, <span class="number">50</span>, <span class="number">36</span>, <span class="number">29</span>, <span class="number">32</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  S 盒</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> S_Box[<span class="number">8</span>][<span class="number">4</span>][<span class="number">16</span>] = &#123;</span><br><span class="line">    <span class="comment">//  s1</span></span><br><span class="line">    <span class="number">14</span>, <span class="number">4</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">15</span>, <span class="number">11</span>, <span class="number">8</span>, <span class="number">3</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">15</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">14</span>, <span class="number">2</span>,</span><br><span class="line">    <span class="number">13</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">14</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">11</span>, <span class="number">15</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">7</span>,</span><br><span class="line">    <span class="number">3</span>, <span class="number">10</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">15</span>, <span class="number">12</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">13</span>,</span><br><span class="line">    <span class="comment">//  s2</span></span><br><span class="line">    <span class="number">15</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">3</span>, <span class="number">13</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">15</span>, <span class="number">2</span>, <span class="number">8</span>,</span><br><span class="line">    <span class="number">14</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">4</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">6</span>, <span class="number">9</span>,</span><br><span class="line">    <span class="number">3</span>, <span class="number">2</span>, <span class="number">15</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">11</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">14</span>, <span class="number">9</span>,</span><br><span class="line">    <span class="comment">//  s3</span></span><br><span class="line">    <span class="number">10</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">6</span>,</span><br><span class="line">    <span class="number">10</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">15</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">11</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">5</span>,</span><br><span class="line">    <span class="number">10</span>, <span class="number">14</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">15</span>, <span class="number">14</span>, <span class="number">3</span>, <span class="number">11</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">12</span>,</span><br><span class="line">    <span class="comment">//  s4</span></span><br><span class="line">    <span class="number">7</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">15</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">15</span>,</span><br><span class="line">    <span class="number">0</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">7</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">14</span>,</span><br><span class="line">    <span class="number">5</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">14</span>,</span><br><span class="line">    <span class="comment">//  s5</span></span><br><span class="line">    <span class="number">2</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">9</span>, <span class="number">14</span>, <span class="number">11</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">7</span>,</span><br><span class="line">    <span class="number">13</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">15</span>, <span class="number">10</span>, <span class="number">3</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">6</span>,</span><br><span class="line">    <span class="number">3</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">11</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">14</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">3</span>,</span><br><span class="line">    <span class="comment">//  s6</span></span><br><span class="line">    <span class="number">12</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">9</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">13</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">14</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">12</span>,</span><br><span class="line">    <span class="number">9</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">0</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">1</span>,</span><br><span class="line">    <span class="number">13</span>, <span class="number">11</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">15</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">14</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">13</span>,</span><br><span class="line">    <span class="comment">//  s7</span></span><br><span class="line">    <span class="number">4</span>, <span class="number">11</span>, <span class="number">2</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">3</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">11</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">1</span>,</span><br><span class="line">    <span class="number">10</span>, <span class="number">14</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">12</span>, <span class="number">2</span>, <span class="number">15</span>, <span class="number">8</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">14</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">0</span>,</span><br><span class="line">    <span class="number">5</span>, <span class="number">9</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">15</span>, <span class="number">14</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">12</span>,</span><br><span class="line">    <span class="comment">//  s8</span></span><br><span class="line">    <span class="number">13</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">11</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">15</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">3</span>,</span><br><span class="line">    <span class="number">7</span>, <span class="number">4</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">11</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">9</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">13</span>,</span><br><span class="line">    <span class="number">15</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">14</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">11</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *  类型转换函数 I</span></span><br><span class="line"><span class="comment"> *  将 char 型转化为二进制形式</span></span><br><span class="line"><span class="comment"> *  8 * sizeof(char) = 8(位) 8 个字符 64 位</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CharToBit</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> input[], <span class="keyword">int</span> output[], <span class="keyword">int</span> bits)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">8</span>; j++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line">      output[<span class="number">7</span> * (j + <span class="number">1</span>) - i + j] = (input[j] &gt;&gt; i) &amp; <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *  类型转换函数 II</span></span><br><span class="line"><span class="comment"> *  将二进制形式转化为 char 型</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BitToChar</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> intput[], <span class="keyword">char</span> output[], <span class="keyword">int</span> bits)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">8</span>; j++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line">      output[j] = output[j] * <span class="number">2</span> + intput[i + <span class="number">8</span> * j];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *  异或函数</span></span><br><span class="line"><span class="comment"> *  将数组 INA 和 INB 进行异或操作，并且保存在 INA 中</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Xor</span><span class="params">(<span class="keyword">int</span>* INA, <span class="keyword">int</span>* INB, <span class="keyword">int</span> len)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">    *(INA + i) = *(INA + i) ^ *(INB + i);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *  IP 初始置换函数</span></span><br><span class="line"><span class="comment"> *  IP 根据 IP 初始置换表进行初始置换</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">IP_Init_Rep</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> input[<span class="number">64</span>], <span class="keyword">int</span> output[<span class="number">64</span>], <span class="keyword">const</span> <span class="keyword">int</span> table[<span class="number">64</span>])</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">64</span>; i++) &#123;</span><br><span class="line">    output[i] = input[table[i] - <span class="number">1</span>];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *  E 扩展置换函数</span></span><br><span class="line"><span class="comment"> *  根据 E 扩展表进行扩展</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">E_Extend</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> input[<span class="number">32</span>], <span class="keyword">int</span> output[<span class="number">48</span>], <span class="keyword">const</span> <span class="keyword">int</span> table[<span class="number">48</span>])</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">48</span>; i++) &#123;</span><br><span class="line">    output[i] = input[table[i] - <span class="number">1</span>];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *  P 置换函数</span></span><br><span class="line"><span class="comment"> *  根据 P 盒进行置换</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">P_Rep</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> input[<span class="number">32</span>], <span class="keyword">int</span> output[<span class="number">32</span>], <span class="keyword">const</span> <span class="keyword">int</span> table[<span class="number">32</span>])</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">    output[i] = input[table[i] - <span class="number">1</span>];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *  IP 逆置换函数</span></span><br><span class="line"><span class="comment"> *  IP 根据 IP 逆置换表进行置换</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">IP_Inv_Rep</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> input[<span class="number">64</span>], <span class="keyword">int</span> output[<span class="number">64</span>], <span class="keyword">const</span> <span class="keyword">int</span> table[<span class="number">64</span>])</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">64</span>; i++) &#123;</span><br><span class="line">    output[i] = input[table[i] - <span class="number">1</span>];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *  密匙第一次置换函数</span></span><br><span class="line"><span class="comment"> *  根据密匙第一次置换表进行置换</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">PC_1</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> input[<span class="number">64</span>], <span class="keyword">int</span> output[<span class="number">56</span>], <span class="keyword">const</span> <span class="keyword">int</span> table[<span class="number">56</span>])</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">56</span>; i++) &#123;</span><br><span class="line">    output[i] = input[table[i] - <span class="number">1</span>];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *  密匙第二次置换函数</span></span><br><span class="line"><span class="comment"> *  根据密匙第二次置换表进行置换</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">PC_2</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> input[<span class="number">56</span>], <span class="keyword">int</span> output[<span class="number">48</span>], <span class="keyword">const</span> <span class="keyword">int</span> table[<span class="number">48</span>])</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">48</span>; i++) &#123;</span><br><span class="line">    output[i] = input[table[i] - <span class="number">1</span>];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *  S 盒压缩函数</span></span><br><span class="line"><span class="comment"> *  根据 8 个 S 盒进行压缩</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">S_Comp</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> input[<span class="number">48</span>], <span class="keyword">int</span> output[<span class="number">32</span>], <span class="keyword">const</span> <span class="keyword">int</span> table[<span class="number">8</span>][<span class="number">4</span>][<span class="number">16</span>])</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> INT[<span class="number">8</span>];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>; i &lt; <span class="number">48</span>; i = i + <span class="number">6</span>) &#123;</span><br><span class="line">    INT[j] = table[j][(input[i] &lt;&lt; <span class="number">1</span>) + (input[i + <span class="number">5</span>])]</span><br><span class="line">                  [(input[i + <span class="number">1</span>] &lt;&lt; <span class="number">3</span>) + (input[i + <span class="number">2</span>] &lt;&lt; <span class="number">2</span>) +</span><br><span class="line">                   (input[i + <span class="number">3</span>] &lt;&lt; <span class="number">1</span>) + (input[i + <span class="number">4</span>])];</span><br><span class="line">    j++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">8</span>; j++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">      output[<span class="number">3</span> * (j + <span class="number">1</span>) - i + j] = (INT[j] &gt;&gt; i) &amp; <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *  轮迭代函数</span></span><br><span class="line"><span class="comment"> *  DES 核心迭代部分</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">F_func</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> input[<span class="number">32</span>], <span class="keyword">int</span> output[<span class="number">32</span>], <span class="keyword">int</span> subKey[<span class="number">48</span>])</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> len = <span class="number">48</span>;</span><br><span class="line">  <span class="keyword">int</span> temp0[<span class="number">48</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">  <span class="keyword">int</span> temp1[<span class="number">32</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">  E_Extend(input, temp0, E_Table);</span><br><span class="line">  Xor(temp0, subKey, len);</span><br><span class="line">  S_Comp(temp0, temp1, S_Box);</span><br><span class="line">  P_Rep(temp1, output, P_Table);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *  密匙循环左移函数</span></span><br><span class="line"><span class="comment"> *  密匙在不同轮数都要进行不同的左移操作</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">RotateL</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> input[<span class="number">28</span>], <span class="keyword">int</span> output[<span class="number">28</span>], <span class="keyword">int</span> leftCount)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> len = <span class="number">28</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">    output[i] = input[(i + leftCount) % len];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *  子密匙生成函数</span></span><br><span class="line"><span class="comment"> *  生成 subKey，在第 1、2、9、16 轮循环左移 1 位，其他轮循环左移 2 位</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">subKey_fun</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> input[<span class="number">64</span>], <span class="keyword">int</span> subKey[<span class="number">16</span>][<span class="number">48</span>])</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> loop0 = <span class="number">1</span>, loop1 = <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">int</span> c[<span class="number">28</span>], d[<span class="number">28</span>];</span><br><span class="line">  <span class="keyword">int</span> pc_1[<span class="number">56</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">  <span class="keyword">int</span> pc_2[<span class="number">16</span>][<span class="number">56</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">  <span class="keyword">int</span> rotatel_c[<span class="number">16</span>][<span class="number">28</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">  <span class="keyword">int</span> rotatel_d[<span class="number">16</span>][<span class="number">28</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">  PC_1(input, pc_1, PC1_Table);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">28</span>; i++) &#123;</span><br><span class="line">    c[i] = pc_1[i];</span><br><span class="line">    d[i] = pc_1[i + <span class="number">28</span>];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> leftCount = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; <span class="number">17</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (i == <span class="number">1</span> || i == <span class="number">2</span> || i == <span class="number">9</span> || i == <span class="number">16</span>) &#123;</span><br><span class="line">      leftCount += loop0;</span><br><span class="line">      RotateL(c, rotatel_c[i - <span class="number">1</span>], leftCount);</span><br><span class="line">      RotateL(d, rotatel_d[i - <span class="number">1</span>], leftCount);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      leftCount += loop1;</span><br><span class="line">      RotateL(c, rotatel_c[i - <span class="number">1</span>], leftCount);</span><br><span class="line">      RotateL(d, rotatel_d[i - <span class="number">1</span>], leftCount);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">28</span>; j++) &#123;</span><br><span class="line">      pc_2[i][j] = rotatel_c[i][j];</span><br><span class="line">      pc_2[i][j + <span class="number">28</span>] = rotatel_d[i][j];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++) &#123;</span><br><span class="line">    PC_2(pc_2[i], subKey[i], PC2_Table);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *  DES 加密函数</span></span><br><span class="line"><span class="comment"> *  传入明文 input 和密匙 inKey，获取 64 位二进制密文 output</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DES_Efun</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> input[<span class="number">8</span>], <span class="keyword">char</span> inKey[<span class="number">8</span>], <span class="keyword">char</span> output[<span class="number">8</span>])</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> ip[<span class="number">64</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">  <span class="keyword">int</span> output_1[<span class="number">64</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">  <span class="keyword">int</span> output_2[<span class="number">64</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">  <span class="keyword">int</span> subKeys[<span class="number">16</span>][<span class="number">48</span>];</span><br><span class="line">  <span class="keyword">int</span> chartobit[<span class="number">64</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">  <span class="keyword">int</span> key[<span class="number">64</span>];</span><br><span class="line">  <span class="keyword">int</span> l[<span class="number">17</span>][<span class="number">32</span>], r[<span class="number">17</span>][<span class="number">32</span>];</span><br><span class="line"></span><br><span class="line">  CharToBit(input, chartobit, <span class="number">8</span>);</span><br><span class="line">  IP_Init_Rep(chartobit, ip, IP_Init_Table);</span><br><span class="line">  CharToBit(inKey, key, <span class="number">8</span>);</span><br><span class="line">  subKey_fun(key, subKeys);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">    l[<span class="number">0</span>][i] = ip[i];</span><br><span class="line">    r[<span class="number">0</span>][i] = ip[<span class="number">32</span> + i];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; <span class="number">16</span>; j++)  <span class="comment">//  15 轮迭代</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; <span class="number">32</span>; k++) &#123;</span><br><span class="line">      l[j][k] = r[j - <span class="number">1</span>][k];</span><br><span class="line">    &#125;</span><br><span class="line">    F_func(r[j - <span class="number">1</span>], r[j], subKeys[j - <span class="number">1</span>]);</span><br><span class="line">    Xor(r[j], l[j - <span class="number">1</span>], <span class="number">32</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> t = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (t = <span class="number">0</span>; t &lt; <span class="number">32</span>; t++)  <span class="comment">//  第 16 轮迭代</span></span><br><span class="line">  &#123;</span><br><span class="line">    r[<span class="number">16</span>][t] = r[<span class="number">15</span>][t];</span><br><span class="line">  &#125;</span><br><span class="line">  F_func(r[<span class="number">15</span>], l[<span class="number">16</span>], subKeys[<span class="number">15</span>]);</span><br><span class="line">  Xor(l[<span class="number">16</span>], l[<span class="number">15</span>], <span class="number">32</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (t = <span class="number">0</span>; t &lt; <span class="number">32</span>; t++) &#123;</span><br><span class="line">    output_1[t] = l[<span class="number">16</span>][t];</span><br><span class="line">    output_1[<span class="number">32</span> + t] = r[<span class="number">16</span>][t];</span><br><span class="line">  &#125;</span><br><span class="line">  IP_Inv_Rep(output_1, output_2, IPR_Table);</span><br><span class="line">  BitToChar(output_2, output, <span class="number">8</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *  DES 解密函数</span></span><br><span class="line"><span class="comment"> *  传入 64 位二进制密文 input 和密匙 inKey 获取明文 output</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DES_Dfun</span><span class="params">(<span class="keyword">char</span> cipher[<span class="number">64</span>], <span class="keyword">char</span> inKey[<span class="number">8</span>], <span class="keyword">char</span> output[<span class="number">8</span>])</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> ip[<span class="number">64</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">  <span class="keyword">int</span> output_1[<span class="number">64</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">  <span class="keyword">int</span> output_2[<span class="number">64</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">  <span class="keyword">int</span> subKeys[<span class="number">16</span>][<span class="number">48</span>];</span><br><span class="line">  <span class="keyword">int</span> key[<span class="number">64</span>];</span><br><span class="line">  <span class="keyword">int</span> l[<span class="number">17</span>][<span class="number">32</span>], r[<span class="number">17</span>][<span class="number">32</span>];</span><br><span class="line">  <span class="keyword">int</span> input[<span class="number">64</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">  CharToBit(cipher, input, <span class="number">8</span>);</span><br><span class="line">  IP_Init_Rep(input, ip, IP_Init_Table);</span><br><span class="line">  CharToBit(inKey, key, <span class="number">8</span>);</span><br><span class="line">  subKey_fun(key, subKeys);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">    l[<span class="number">0</span>][i] = ip[i];</span><br><span class="line">    r[<span class="number">0</span>][i] = ip[<span class="number">32</span> + i];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; <span class="number">16</span>; j++)  <span class="comment">//  15 轮迭代</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; <span class="number">32</span>; k++) &#123;</span><br><span class="line">      l[j][k] = r[j - <span class="number">1</span>][k];</span><br><span class="line">    &#125;</span><br><span class="line">    F_func(r[j - <span class="number">1</span>], r[j], subKeys[<span class="number">16</span> - j]);</span><br><span class="line">    Xor(r[j], l[j - <span class="number">1</span>], <span class="number">32</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> t = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (t = <span class="number">0</span>; t &lt; <span class="number">32</span>; t++)  <span class="comment">//  第 16 轮迭代</span></span><br><span class="line">  &#123;</span><br><span class="line">    r[<span class="number">16</span>][t] = r[<span class="number">15</span>][t];</span><br><span class="line">  &#125;</span><br><span class="line">  F_func(r[<span class="number">15</span>], l[<span class="number">16</span>], subKeys[<span class="number">0</span>]);</span><br><span class="line">  Xor(l[<span class="number">16</span>], l[<span class="number">15</span>], <span class="number">32</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (t = <span class="number">0</span>; t &lt; <span class="number">32</span>; t++) &#123;</span><br><span class="line">    output_1[t] = l[<span class="number">16</span>][t];</span><br><span class="line">    output_1[<span class="number">32</span> + t] = r[<span class="number">16</span>][t];</span><br><span class="line">  &#125;</span><br><span class="line">  IP_Inv_Rep(output_1, output_2, IPR_Table);</span><br><span class="line">  BitToChar(output_2, output, <span class="number">8</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//  DES_Efun(plain, key, cipher);</span></span><br><span class="line"><span class="comment">//  DES_Dfun(cipher, key, plain);</span></span><br><span class="line"><span class="keyword">char</span> plain[<span class="number">9</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="keyword">char</span> cipher[<span class="number">9</span>] = &#123;<span class="number">0x96</span>, <span class="number">0xd0</span>, <span class="number">0x02</span>, <span class="number">0x88</span>, <span class="number">0x78</span>, <span class="number">0xd5</span>, <span class="number">0x8c</span>, <span class="number">0x89</span>&#125;;</span><br><span class="line"><span class="keyword">char</span> key[<span class="number">9</span>] = <span class="string">"12345678"</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">char</span> a = <span class="string">'0'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"0.encrypt,1.decrypt"</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">"%c"</span>, &amp;a);</span><br><span class="line">  <span class="keyword">if</span> (a == <span class="string">'0'</span>) &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"input plain (8Bytes)"</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%s"</span>, plain);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"input key (8Bytes)"</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%s"</span>, key);</span><br><span class="line">    DES_Efun(plain, key, cipher);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"%.2x"</span>, (<span class="keyword">unsigned</span> <span class="keyword">char</span>)cipher[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">""</span>);</span><br><span class="line">    <span class="built_in">puts</span>(cipher);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (a == <span class="string">'1'</span>) &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"input cipher (8Bytes)"</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"such as 96 d0 02 88 78 d5 8c 89"</span>);</span><br><span class="line">    <span class="comment">//   scanf("%s",cipher);</span></span><br><span class="line">    <span class="keyword">int</span> cipherhex[<span class="number">8</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line">      <span class="built_in">scanf</span>(<span class="string">"%x"</span>, &amp;cipherhex[i]);</span><br><span class="line">      cipher[i] = (<span class="keyword">char</span>)cipherhex[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"input key (8Bytes)"</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%s"</span>, key);</span><br><span class="line">    DES_Dfun(cipher, key, plain);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"%.2x"</span>, (<span class="keyword">unsigned</span> <span class="keyword">char</span>)plain[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">""</span>);</span><br><span class="line">    <span class="built_in">puts</span>(plain);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// DES_Efun(plain, key, cipher);</span></span><br><span class="line">    <span class="comment">// puts("cipher:");</span></span><br><span class="line">    <span class="comment">// for (size_t i = 0; i &lt; 8; i++) &#123;</span></span><br><span class="line">    <span class="comment">//   printf("%.2x", (unsigned char)cipher[i]);</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="comment">// puts("");</span></span><br><span class="line">    <span class="comment">// puts(cipher);</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"plain:"</span>);</span><br><span class="line">    DES_Dfun(cipher, key, plain);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"%.2x"</span>, (<span class="keyword">unsigned</span> <span class="keyword">char</span>)plain[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">""</span>);</span><br><span class="line">    <span class="built_in">puts</span>(plain);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="DES的扩展3-DES"><a href="#DES的扩展3-DES" class="headerlink" title="DES的扩展3-DES"></a>DES的扩展3-DES</h4><blockquote>
<p>3DES使用“密钥包”，其包含3个DES密钥，K1，K2和K3，均为56位（除去奇偶校验位）。加密算法为：</p>
<p>也就是说，使用K1为密钥进行DES加密，再用K2为密钥进行DES“解密”，最后以K3进行DES加密。</p>
<p>而解密则为其反过程：</p>
<p>即以K3解密，以K2“加密”，最后以K1解密。</p>
<p>每次加密操作都只处理64位数据，称为一块。</p>
<p>无论是加密还是解密，中间一步都是前后两步的逆。这种做法提高了使用密钥选项2时的算法强度，并在使用密钥选项3时与DES兼容。</p>
<ul>
<li>密钥选项1：三个密钥是独立的。</li>
<li>密钥选项2：K1和K2是独立的，而K3=K1</li>
<li>密钥选项3：三个密钥均相等，即K1=K2=K3</li>
</ul>
</blockquote>
<h3 id="AES"><a href="#AES" class="headerlink" title="AES"></a>AES</h3><h4 id="关于AES"><a href="#关于AES" class="headerlink" title="关于AES"></a>关于AES</h4><blockquote>
<p><strong>AES</strong>（<strong>A</strong>dvanced <strong>E</strong>ncryption <strong>S</strong>tandard），是一种对称密钥块密码算法，分组大小为128位，密钥长度为128，192或256位</p>
</blockquote>
<h4 id="算法原理-1"><a href="#算法原理-1" class="headerlink" title="算法原理"></a>算法原理</h4><h4 id="加解密实现"><a href="#加解密实现" class="headerlink" title="加解密实现"></a>加解密实现</h4><p>from <a href="https://github.com/dhuertas/AES" target="_blank" rel="noopener">https://github.com/dhuertas/AES</a></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Advanced Encryption Standard</span></span><br><span class="line"><span class="comment"> * @author Dani Huertas</span></span><br><span class="line"><span class="comment"> * @email huertas.dani@gmail.com</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Based on the document FIPS PUB 197</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stddef.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line">*<span class="function">Addition in <span class="title">GF</span><span class="params">(<span class="number">2</span> ^ <span class="number">8</span>)</span> *</span></span><br><span class="line"><span class="function">    http :  <span class="comment">// en.wikipedia.org/wiki/Finite_field_arithmetic</span></span></span><br><span class="line">            * /</span><br><span class="line">             * http:<span class="comment">//en.wikipedia.org/wiki/Finite_field_arithmetic</span></span><br><span class="line"> */</span><br><span class="line"><span class="function"><span class="keyword">uint8_t</span> <span class="title">gadd</span><span class="params">(<span class="keyword">uint8_t</span> a, <span class="keyword">uint8_t</span> b)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a ^ b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Subtraction in GF(2^8)</span></span><br><span class="line"><span class="comment"> * http://en.wikipedia.org/wiki/Finite_field_arithmetic</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">uint8_t</span> <span class="title">gsub</span><span class="params">(<span class="keyword">uint8_t</span> a, <span class="keyword">uint8_t</span> b)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a ^ b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Multiplication in GF(2^8)</span></span><br><span class="line"><span class="comment"> * http://en.wikipedia.org/wiki/Finite_field_arithmetic</span></span><br><span class="line"><span class="comment"> * Irreducible polynomial m(x) = x8 + x4 + x3 + x + 1</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">NOTE:</span> This function can be easily replaced with a look up table for a speed</span></span><br><span class="line"><span class="comment"> *       boost, at the expense of an increase in memory size (around 65 KB).</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">uint8_t</span> <span class="title">gmult</span><span class="params">(<span class="keyword">uint8_t</span> a, <span class="keyword">uint8_t</span> b)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">uint8_t</span> p = <span class="number">0</span>, i = <span class="number">0</span>, hbs = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (b &amp; <span class="number">1</span>) &#123;</span><br><span class="line">      p ^= a;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    hbs = a &amp; <span class="number">0x80</span>;</span><br><span class="line">    a &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (hbs)</span><br><span class="line">      a ^= <span class="number">0x1b</span>;  <span class="comment">// 0000 0001 0001 1011</span></span><br><span class="line">    b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (<span class="keyword">uint8_t</span>)p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Addition of 4 byte words</span></span><br><span class="line"><span class="comment"> * m(x) = x4+1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">coef_add</span><span class="params">(<span class="keyword">uint8_t</span> a[], <span class="keyword">uint8_t</span> b[], <span class="keyword">uint8_t</span> d[])</span> </span>&#123;</span><br><span class="line">  d[<span class="number">0</span>] = a[<span class="number">0</span>] ^ b[<span class="number">0</span>];</span><br><span class="line">  d[<span class="number">1</span>] = a[<span class="number">1</span>] ^ b[<span class="number">1</span>];</span><br><span class="line">  d[<span class="number">2</span>] = a[<span class="number">2</span>] ^ b[<span class="number">2</span>];</span><br><span class="line">  d[<span class="number">3</span>] = a[<span class="number">3</span>] ^ b[<span class="number">3</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Multiplication of 4 byte words</span></span><br><span class="line"><span class="comment"> * m(x) = x4+1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">coef_mult</span><span class="params">(<span class="keyword">uint8_t</span>* a, <span class="keyword">uint8_t</span>* b, <span class="keyword">uint8_t</span>* d)</span> </span>&#123;</span><br><span class="line">  d[<span class="number">0</span>] = gmult(a[<span class="number">0</span>], b[<span class="number">0</span>]) ^ gmult(a[<span class="number">3</span>], b[<span class="number">1</span>]) ^ gmult(a[<span class="number">2</span>], b[<span class="number">2</span>]) ^</span><br><span class="line">         gmult(a[<span class="number">1</span>], b[<span class="number">3</span>]);</span><br><span class="line">  d[<span class="number">1</span>] = gmult(a[<span class="number">1</span>], b[<span class="number">0</span>]) ^ gmult(a[<span class="number">0</span>], b[<span class="number">1</span>]) ^ gmult(a[<span class="number">3</span>], b[<span class="number">2</span>]) ^</span><br><span class="line">         gmult(a[<span class="number">2</span>], b[<span class="number">3</span>]);</span><br><span class="line">  d[<span class="number">2</span>] = gmult(a[<span class="number">2</span>], b[<span class="number">0</span>]) ^ gmult(a[<span class="number">1</span>], b[<span class="number">1</span>]) ^ gmult(a[<span class="number">0</span>], b[<span class="number">2</span>]) ^</span><br><span class="line">         gmult(a[<span class="number">3</span>], b[<span class="number">3</span>]);</span><br><span class="line">  d[<span class="number">3</span>] = gmult(a[<span class="number">3</span>], b[<span class="number">0</span>]) ^ gmult(a[<span class="number">2</span>], b[<span class="number">1</span>]) ^ gmult(a[<span class="number">1</span>], b[<span class="number">2</span>]) ^</span><br><span class="line">         gmult(a[<span class="number">0</span>], b[<span class="number">3</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * The cipher Key.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> K;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Number of columns (32-bit words) comprising the State. For this</span></span><br><span class="line"><span class="comment"> * standard, Nb = 4.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> Nb = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Number of 32-bit words comprising the Cipher Key. For this</span></span><br><span class="line"><span class="comment"> * standard, Nk = 4, 6, or 8.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> Nk;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Number of rounds, which is a function of  Nk  and  Nb (which is</span></span><br><span class="line"><span class="comment"> * fixed). For this standard, Nr = 10, 12, or 14.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> Nr;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * S-box transformation table</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">uint8_t</span> s_box[<span class="number">256</span>] = &#123;</span><br><span class="line">    <span class="comment">// 0     1     2     3     4     5     6     7     8     9     a     b     c</span></span><br><span class="line">    <span class="comment">// d     e     f</span></span><br><span class="line">    <span class="number">0x63</span>, <span class="number">0x7c</span>, <span class="number">0x77</span>, <span class="number">0x7b</span>, <span class="number">0xf2</span>, <span class="number">0x6b</span>, <span class="number">0x6f</span>, <span class="number">0xc5</span>,</span><br><span class="line">    <span class="number">0x30</span>, <span class="number">0x01</span>, <span class="number">0x67</span>, <span class="number">0x2b</span>, <span class="number">0xfe</span>, <span class="number">0xd7</span>, <span class="number">0xab</span>, <span class="number">0x76</span>,  <span class="comment">// 0</span></span><br><span class="line">    <span class="number">0xca</span>, <span class="number">0x82</span>, <span class="number">0xc9</span>, <span class="number">0x7d</span>, <span class="number">0xfa</span>, <span class="number">0x59</span>, <span class="number">0x47</span>, <span class="number">0xf0</span>,</span><br><span class="line">    <span class="number">0xad</span>, <span class="number">0xd4</span>, <span class="number">0xa2</span>, <span class="number">0xaf</span>, <span class="number">0x9c</span>, <span class="number">0xa4</span>, <span class="number">0x72</span>, <span class="number">0xc0</span>,  <span class="comment">// 1</span></span><br><span class="line">    <span class="number">0xb7</span>, <span class="number">0xfd</span>, <span class="number">0x93</span>, <span class="number">0x26</span>, <span class="number">0x36</span>, <span class="number">0x3f</span>, <span class="number">0xf7</span>, <span class="number">0xcc</span>,</span><br><span class="line">    <span class="number">0x34</span>, <span class="number">0xa5</span>, <span class="number">0xe5</span>, <span class="number">0xf1</span>, <span class="number">0x71</span>, <span class="number">0xd8</span>, <span class="number">0x31</span>, <span class="number">0x15</span>,  <span class="comment">// 2</span></span><br><span class="line">    <span class="number">0x04</span>, <span class="number">0xc7</span>, <span class="number">0x23</span>, <span class="number">0xc3</span>, <span class="number">0x18</span>, <span class="number">0x96</span>, <span class="number">0x05</span>, <span class="number">0x9a</span>,</span><br><span class="line">    <span class="number">0x07</span>, <span class="number">0x12</span>, <span class="number">0x80</span>, <span class="number">0xe2</span>, <span class="number">0xeb</span>, <span class="number">0x27</span>, <span class="number">0xb2</span>, <span class="number">0x75</span>,  <span class="comment">// 3</span></span><br><span class="line">    <span class="number">0x09</span>, <span class="number">0x83</span>, <span class="number">0x2c</span>, <span class="number">0x1a</span>, <span class="number">0x1b</span>, <span class="number">0x6e</span>, <span class="number">0x5a</span>, <span class="number">0xa0</span>,</span><br><span class="line">    <span class="number">0x52</span>, <span class="number">0x3b</span>, <span class="number">0xd6</span>, <span class="number">0xb3</span>, <span class="number">0x29</span>, <span class="number">0xe3</span>, <span class="number">0x2f</span>, <span class="number">0x84</span>,  <span class="comment">// 4</span></span><br><span class="line">    <span class="number">0x53</span>, <span class="number">0xd1</span>, <span class="number">0x00</span>, <span class="number">0xed</span>, <span class="number">0x20</span>, <span class="number">0xfc</span>, <span class="number">0xb1</span>, <span class="number">0x5b</span>,</span><br><span class="line">    <span class="number">0x6a</span>, <span class="number">0xcb</span>, <span class="number">0xbe</span>, <span class="number">0x39</span>, <span class="number">0x4a</span>, <span class="number">0x4c</span>, <span class="number">0x58</span>, <span class="number">0xcf</span>,  <span class="comment">// 5</span></span><br><span class="line">    <span class="number">0xd0</span>, <span class="number">0xef</span>, <span class="number">0xaa</span>, <span class="number">0xfb</span>, <span class="number">0x43</span>, <span class="number">0x4d</span>, <span class="number">0x33</span>, <span class="number">0x85</span>,</span><br><span class="line">    <span class="number">0x45</span>, <span class="number">0xf9</span>, <span class="number">0x02</span>, <span class="number">0x7f</span>, <span class="number">0x50</span>, <span class="number">0x3c</span>, <span class="number">0x9f</span>, <span class="number">0xa8</span>,  <span class="comment">// 6</span></span><br><span class="line">    <span class="number">0x51</span>, <span class="number">0xa3</span>, <span class="number">0x40</span>, <span class="number">0x8f</span>, <span class="number">0x92</span>, <span class="number">0x9d</span>, <span class="number">0x38</span>, <span class="number">0xf5</span>,</span><br><span class="line">    <span class="number">0xbc</span>, <span class="number">0xb6</span>, <span class="number">0xda</span>, <span class="number">0x21</span>, <span class="number">0x10</span>, <span class="number">0xff</span>, <span class="number">0xf3</span>, <span class="number">0xd2</span>,  <span class="comment">// 7</span></span><br><span class="line">    <span class="number">0xcd</span>, <span class="number">0x0c</span>, <span class="number">0x13</span>, <span class="number">0xec</span>, <span class="number">0x5f</span>, <span class="number">0x97</span>, <span class="number">0x44</span>, <span class="number">0x17</span>,</span><br><span class="line">    <span class="number">0xc4</span>, <span class="number">0xa7</span>, <span class="number">0x7e</span>, <span class="number">0x3d</span>, <span class="number">0x64</span>, <span class="number">0x5d</span>, <span class="number">0x19</span>, <span class="number">0x73</span>,  <span class="comment">// 8</span></span><br><span class="line">    <span class="number">0x60</span>, <span class="number">0x81</span>, <span class="number">0x4f</span>, <span class="number">0xdc</span>, <span class="number">0x22</span>, <span class="number">0x2a</span>, <span class="number">0x90</span>, <span class="number">0x88</span>,</span><br><span class="line">    <span class="number">0x46</span>, <span class="number">0xee</span>, <span class="number">0xb8</span>, <span class="number">0x14</span>, <span class="number">0xde</span>, <span class="number">0x5e</span>, <span class="number">0x0b</span>, <span class="number">0xdb</span>,  <span class="comment">// 9</span></span><br><span class="line">    <span class="number">0xe0</span>, <span class="number">0x32</span>, <span class="number">0x3a</span>, <span class="number">0x0a</span>, <span class="number">0x49</span>, <span class="number">0x06</span>, <span class="number">0x24</span>, <span class="number">0x5c</span>,</span><br><span class="line">    <span class="number">0xc2</span>, <span class="number">0xd3</span>, <span class="number">0xac</span>, <span class="number">0x62</span>, <span class="number">0x91</span>, <span class="number">0x95</span>, <span class="number">0xe4</span>, <span class="number">0x79</span>,  <span class="comment">// a</span></span><br><span class="line">    <span class="number">0xe7</span>, <span class="number">0xc8</span>, <span class="number">0x37</span>, <span class="number">0x6d</span>, <span class="number">0x8d</span>, <span class="number">0xd5</span>, <span class="number">0x4e</span>, <span class="number">0xa9</span>,</span><br><span class="line">    <span class="number">0x6c</span>, <span class="number">0x56</span>, <span class="number">0xf4</span>, <span class="number">0xea</span>, <span class="number">0x65</span>, <span class="number">0x7a</span>, <span class="number">0xae</span>, <span class="number">0x08</span>,  <span class="comment">// b</span></span><br><span class="line">    <span class="number">0xba</span>, <span class="number">0x78</span>, <span class="number">0x25</span>, <span class="number">0x2e</span>, <span class="number">0x1c</span>, <span class="number">0xa6</span>, <span class="number">0xb4</span>, <span class="number">0xc6</span>,</span><br><span class="line">    <span class="number">0xe8</span>, <span class="number">0xdd</span>, <span class="number">0x74</span>, <span class="number">0x1f</span>, <span class="number">0x4b</span>, <span class="number">0xbd</span>, <span class="number">0x8b</span>, <span class="number">0x8a</span>,  <span class="comment">// c</span></span><br><span class="line">    <span class="number">0x70</span>, <span class="number">0x3e</span>, <span class="number">0xb5</span>, <span class="number">0x66</span>, <span class="number">0x48</span>, <span class="number">0x03</span>, <span class="number">0xf6</span>, <span class="number">0x0e</span>,</span><br><span class="line">    <span class="number">0x61</span>, <span class="number">0x35</span>, <span class="number">0x57</span>, <span class="number">0xb9</span>, <span class="number">0x86</span>, <span class="number">0xc1</span>, <span class="number">0x1d</span>, <span class="number">0x9e</span>,  <span class="comment">// d</span></span><br><span class="line">    <span class="number">0xe1</span>, <span class="number">0xf8</span>, <span class="number">0x98</span>, <span class="number">0x11</span>, <span class="number">0x69</span>, <span class="number">0xd9</span>, <span class="number">0x8e</span>, <span class="number">0x94</span>,</span><br><span class="line">    <span class="number">0x9b</span>, <span class="number">0x1e</span>, <span class="number">0x87</span>, <span class="number">0xe9</span>, <span class="number">0xce</span>, <span class="number">0x55</span>, <span class="number">0x28</span>, <span class="number">0xdf</span>,  <span class="comment">// e</span></span><br><span class="line">    <span class="number">0x8c</span>, <span class="number">0xa1</span>, <span class="number">0x89</span>, <span class="number">0x0d</span>, <span class="number">0xbf</span>, <span class="number">0xe6</span>, <span class="number">0x42</span>, <span class="number">0x68</span>,</span><br><span class="line">    <span class="number">0x41</span>, <span class="number">0x99</span>, <span class="number">0x2d</span>, <span class="number">0x0f</span>, <span class="number">0xb0</span>, <span class="number">0x54</span>, <span class="number">0xbb</span>, <span class="number">0x16</span>&#125;;  <span class="comment">// f</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Inverse S-box transformation table</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">uint8_t</span> inv_s_box[<span class="number">256</span>] = &#123;</span><br><span class="line">    <span class="comment">// 0     1     2     3     4     5     6     7     8     9     a     b     c</span></span><br><span class="line">    <span class="comment">// d     e     f</span></span><br><span class="line">    <span class="number">0x52</span>, <span class="number">0x09</span>, <span class="number">0x6a</span>, <span class="number">0xd5</span>, <span class="number">0x30</span>, <span class="number">0x36</span>, <span class="number">0xa5</span>, <span class="number">0x38</span>,</span><br><span class="line">    <span class="number">0xbf</span>, <span class="number">0x40</span>, <span class="number">0xa3</span>, <span class="number">0x9e</span>, <span class="number">0x81</span>, <span class="number">0xf3</span>, <span class="number">0xd7</span>, <span class="number">0xfb</span>,  <span class="comment">// 0</span></span><br><span class="line">    <span class="number">0x7c</span>, <span class="number">0xe3</span>, <span class="number">0x39</span>, <span class="number">0x82</span>, <span class="number">0x9b</span>, <span class="number">0x2f</span>, <span class="number">0xff</span>, <span class="number">0x87</span>,</span><br><span class="line">    <span class="number">0x34</span>, <span class="number">0x8e</span>, <span class="number">0x43</span>, <span class="number">0x44</span>, <span class="number">0xc4</span>, <span class="number">0xde</span>, <span class="number">0xe9</span>, <span class="number">0xcb</span>,  <span class="comment">// 1</span></span><br><span class="line">    <span class="number">0x54</span>, <span class="number">0x7b</span>, <span class="number">0x94</span>, <span class="number">0x32</span>, <span class="number">0xa6</span>, <span class="number">0xc2</span>, <span class="number">0x23</span>, <span class="number">0x3d</span>,</span><br><span class="line">    <span class="number">0xee</span>, <span class="number">0x4c</span>, <span class="number">0x95</span>, <span class="number">0x0b</span>, <span class="number">0x42</span>, <span class="number">0xfa</span>, <span class="number">0xc3</span>, <span class="number">0x4e</span>,  <span class="comment">// 2</span></span><br><span class="line">    <span class="number">0x08</span>, <span class="number">0x2e</span>, <span class="number">0xa1</span>, <span class="number">0x66</span>, <span class="number">0x28</span>, <span class="number">0xd9</span>, <span class="number">0x24</span>, <span class="number">0xb2</span>,</span><br><span class="line">    <span class="number">0x76</span>, <span class="number">0x5b</span>, <span class="number">0xa2</span>, <span class="number">0x49</span>, <span class="number">0x6d</span>, <span class="number">0x8b</span>, <span class="number">0xd1</span>, <span class="number">0x25</span>,  <span class="comment">// 3</span></span><br><span class="line">    <span class="number">0x72</span>, <span class="number">0xf8</span>, <span class="number">0xf6</span>, <span class="number">0x64</span>, <span class="number">0x86</span>, <span class="number">0x68</span>, <span class="number">0x98</span>, <span class="number">0x16</span>,</span><br><span class="line">    <span class="number">0xd4</span>, <span class="number">0xa4</span>, <span class="number">0x5c</span>, <span class="number">0xcc</span>, <span class="number">0x5d</span>, <span class="number">0x65</span>, <span class="number">0xb6</span>, <span class="number">0x92</span>,  <span class="comment">// 4</span></span><br><span class="line">    <span class="number">0x6c</span>, <span class="number">0x70</span>, <span class="number">0x48</span>, <span class="number">0x50</span>, <span class="number">0xfd</span>, <span class="number">0xed</span>, <span class="number">0xb9</span>, <span class="number">0xda</span>,</span><br><span class="line">    <span class="number">0x5e</span>, <span class="number">0x15</span>, <span class="number">0x46</span>, <span class="number">0x57</span>, <span class="number">0xa7</span>, <span class="number">0x8d</span>, <span class="number">0x9d</span>, <span class="number">0x84</span>,  <span class="comment">// 5</span></span><br><span class="line">    <span class="number">0x90</span>, <span class="number">0xd8</span>, <span class="number">0xab</span>, <span class="number">0x00</span>, <span class="number">0x8c</span>, <span class="number">0xbc</span>, <span class="number">0xd3</span>, <span class="number">0x0a</span>,</span><br><span class="line">    <span class="number">0xf7</span>, <span class="number">0xe4</span>, <span class="number">0x58</span>, <span class="number">0x05</span>, <span class="number">0xb8</span>, <span class="number">0xb3</span>, <span class="number">0x45</span>, <span class="number">0x06</span>,  <span class="comment">// 6</span></span><br><span class="line">    <span class="number">0xd0</span>, <span class="number">0x2c</span>, <span class="number">0x1e</span>, <span class="number">0x8f</span>, <span class="number">0xca</span>, <span class="number">0x3f</span>, <span class="number">0x0f</span>, <span class="number">0x02</span>,</span><br><span class="line">    <span class="number">0xc1</span>, <span class="number">0xaf</span>, <span class="number">0xbd</span>, <span class="number">0x03</span>, <span class="number">0x01</span>, <span class="number">0x13</span>, <span class="number">0x8a</span>, <span class="number">0x6b</span>,  <span class="comment">// 7</span></span><br><span class="line">    <span class="number">0x3a</span>, <span class="number">0x91</span>, <span class="number">0x11</span>, <span class="number">0x41</span>, <span class="number">0x4f</span>, <span class="number">0x67</span>, <span class="number">0xdc</span>, <span class="number">0xea</span>,</span><br><span class="line">    <span class="number">0x97</span>, <span class="number">0xf2</span>, <span class="number">0xcf</span>, <span class="number">0xce</span>, <span class="number">0xf0</span>, <span class="number">0xb4</span>, <span class="number">0xe6</span>, <span class="number">0x73</span>,  <span class="comment">// 8</span></span><br><span class="line">    <span class="number">0x96</span>, <span class="number">0xac</span>, <span class="number">0x74</span>, <span class="number">0x22</span>, <span class="number">0xe7</span>, <span class="number">0xad</span>, <span class="number">0x35</span>, <span class="number">0x85</span>,</span><br><span class="line">    <span class="number">0xe2</span>, <span class="number">0xf9</span>, <span class="number">0x37</span>, <span class="number">0xe8</span>, <span class="number">0x1c</span>, <span class="number">0x75</span>, <span class="number">0xdf</span>, <span class="number">0x6e</span>,  <span class="comment">// 9</span></span><br><span class="line">    <span class="number">0x47</span>, <span class="number">0xf1</span>, <span class="number">0x1a</span>, <span class="number">0x71</span>, <span class="number">0x1d</span>, <span class="number">0x29</span>, <span class="number">0xc5</span>, <span class="number">0x89</span>,</span><br><span class="line">    <span class="number">0x6f</span>, <span class="number">0xb7</span>, <span class="number">0x62</span>, <span class="number">0x0e</span>, <span class="number">0xaa</span>, <span class="number">0x18</span>, <span class="number">0xbe</span>, <span class="number">0x1b</span>,  <span class="comment">// a</span></span><br><span class="line">    <span class="number">0xfc</span>, <span class="number">0x56</span>, <span class="number">0x3e</span>, <span class="number">0x4b</span>, <span class="number">0xc6</span>, <span class="number">0xd2</span>, <span class="number">0x79</span>, <span class="number">0x20</span>,</span><br><span class="line">    <span class="number">0x9a</span>, <span class="number">0xdb</span>, <span class="number">0xc0</span>, <span class="number">0xfe</span>, <span class="number">0x78</span>, <span class="number">0xcd</span>, <span class="number">0x5a</span>, <span class="number">0xf4</span>,  <span class="comment">// b</span></span><br><span class="line">    <span class="number">0x1f</span>, <span class="number">0xdd</span>, <span class="number">0xa8</span>, <span class="number">0x33</span>, <span class="number">0x88</span>, <span class="number">0x07</span>, <span class="number">0xc7</span>, <span class="number">0x31</span>,</span><br><span class="line">    <span class="number">0xb1</span>, <span class="number">0x12</span>, <span class="number">0x10</span>, <span class="number">0x59</span>, <span class="number">0x27</span>, <span class="number">0x80</span>, <span class="number">0xec</span>, <span class="number">0x5f</span>,  <span class="comment">// c</span></span><br><span class="line">    <span class="number">0x60</span>, <span class="number">0x51</span>, <span class="number">0x7f</span>, <span class="number">0xa9</span>, <span class="number">0x19</span>, <span class="number">0xb5</span>, <span class="number">0x4a</span>, <span class="number">0x0d</span>,</span><br><span class="line">    <span class="number">0x2d</span>, <span class="number">0xe5</span>, <span class="number">0x7a</span>, <span class="number">0x9f</span>, <span class="number">0x93</span>, <span class="number">0xc9</span>, <span class="number">0x9c</span>, <span class="number">0xef</span>,  <span class="comment">// d</span></span><br><span class="line">    <span class="number">0xa0</span>, <span class="number">0xe0</span>, <span class="number">0x3b</span>, <span class="number">0x4d</span>, <span class="number">0xae</span>, <span class="number">0x2a</span>, <span class="number">0xf5</span>, <span class="number">0xb0</span>,</span><br><span class="line">    <span class="number">0xc8</span>, <span class="number">0xeb</span>, <span class="number">0xbb</span>, <span class="number">0x3c</span>, <span class="number">0x83</span>, <span class="number">0x53</span>, <span class="number">0x99</span>, <span class="number">0x61</span>,  <span class="comment">// e</span></span><br><span class="line">    <span class="number">0x17</span>, <span class="number">0x2b</span>, <span class="number">0x04</span>, <span class="number">0x7e</span>, <span class="number">0xba</span>, <span class="number">0x77</span>, <span class="number">0xd6</span>, <span class="number">0x26</span>,</span><br><span class="line">    <span class="number">0xe1</span>, <span class="number">0x69</span>, <span class="number">0x14</span>, <span class="number">0x63</span>, <span class="number">0x55</span>, <span class="number">0x21</span>, <span class="number">0x0c</span>, <span class="number">0x7d</span>&#125;;  <span class="comment">// f</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Generates the round constant Rcon[i]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">uint8_t</span> R[] = &#123;<span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">uint8_t</span>* <span class="title">Rcon</span><span class="params">(<span class="keyword">uint8_t</span> i)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (i == <span class="number">1</span>) &#123;</span><br><span class="line">    R[<span class="number">0</span>] = <span class="number">0x01</span>;  <span class="comment">// x^(1-1) = x^0 = 1</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (i &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    R[<span class="number">0</span>] = <span class="number">0x02</span>;</span><br><span class="line">    i--;</span><br><span class="line">    <span class="keyword">while</span> (i - <span class="number">1</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      R[<span class="number">0</span>] = gmult(R[<span class="number">0</span>], <span class="number">0x02</span>);</span><br><span class="line">      i--;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> R;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Transformation in the Cipher and Inverse Cipher in which a Round</span></span><br><span class="line"><span class="comment"> * Key is added to the State using an XOR operation. The length of a</span></span><br><span class="line"><span class="comment"> * Round Key equals the size of the State (i.e., for Nb = 4, the Round</span></span><br><span class="line"><span class="comment"> * Key length equals 128 bits/16 bytes).</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add_round_key</span><span class="params">(<span class="keyword">uint8_t</span>* state, <span class="keyword">uint8_t</span>* w, <span class="keyword">uint8_t</span> r)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">uint8_t</span> c;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (c = <span class="number">0</span>; c &lt; Nb; c++) &#123;</span><br><span class="line">    state[Nb * <span class="number">0</span> + c] =</span><br><span class="line">        state[Nb * <span class="number">0</span> + c] ^</span><br><span class="line">        w[<span class="number">4</span> * Nb * r + <span class="number">4</span> * c + <span class="number">0</span>];  <span class="comment">// debug, so it works for Nb !=4</span></span><br><span class="line">    state[Nb * <span class="number">1</span> + c] = state[Nb * <span class="number">1</span> + c] ^ w[<span class="number">4</span> * Nb * r + <span class="number">4</span> * c + <span class="number">1</span>];</span><br><span class="line">    state[Nb * <span class="number">2</span> + c] = state[Nb * <span class="number">2</span> + c] ^ w[<span class="number">4</span> * Nb * r + <span class="number">4</span> * c + <span class="number">2</span>];</span><br><span class="line">    state[Nb * <span class="number">3</span> + c] = state[Nb * <span class="number">3</span> + c] ^ w[<span class="number">4</span> * Nb * r + <span class="number">4</span> * c + <span class="number">3</span>];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Transformation in the Cipher that takes all of the columns of the</span></span><br><span class="line"><span class="comment"> * State and mixes their data (independently of one another) to</span></span><br><span class="line"><span class="comment"> * produce new columns.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mix_columns</span><span class="params">(<span class="keyword">uint8_t</span>* state)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">uint8_t</span> a[] = &#123;<span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x01</span>,</span><br><span class="line">                 <span class="number">0x03</span>&#125;;  <span class="comment">// a(x) = &#123;02&#125; + &#123;01&#125;x + &#123;01&#125;x2 + &#123;03&#125;x3</span></span><br><span class="line">  <span class="keyword">uint8_t</span> i, j, col[<span class="number">4</span>], res[<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; Nb; j++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">      col[i] = state[Nb * i + j];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    coef_mult(a, col, res);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">      state[Nb * i + j] = res[i];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Transformation in the Inverse Cipher that is the inverse of</span></span><br><span class="line"><span class="comment"> * MixColumns().</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">inv_mix_columns</span><span class="params">(<span class="keyword">uint8_t</span>* state)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">uint8_t</span> a[] = &#123;<span class="number">0x0e</span>, <span class="number">0x09</span>, <span class="number">0x0d</span>,</span><br><span class="line">                 <span class="number">0x0b</span>&#125;;  <span class="comment">// a(x) = &#123;0e&#125; + &#123;09&#125;x + &#123;0d&#125;x2 + &#123;0b&#125;x3</span></span><br><span class="line">  <span class="keyword">uint8_t</span> i, j, col[<span class="number">4</span>], res[<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; Nb; j++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">      col[i] = state[Nb * i + j];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    coef_mult(a, col, res);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">      state[Nb * i + j] = res[i];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Transformation in the Cipher that processes the State by cyclically</span></span><br><span class="line"><span class="comment"> * shifting the last three rows of the State by different offsets.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">shift_rows</span><span class="params">(<span class="keyword">uint8_t</span>* state)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">uint8_t</span> i, k, s, tmp;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">    <span class="comment">// shift(1,4)=1; shift(2,4)=2; shift(3,4)=3</span></span><br><span class="line">    <span class="comment">// shift(r, 4) = r;</span></span><br><span class="line">    s = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (s &lt; i) &#123;</span><br><span class="line">      tmp = state[Nb * i + <span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> (k = <span class="number">1</span>; k &lt; Nb; k++) &#123;</span><br><span class="line">        state[Nb * i + k - <span class="number">1</span>] = state[Nb * i + k];</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      state[Nb * i + Nb - <span class="number">1</span>] = tmp;</span><br><span class="line">      s++;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Transformation in the Inverse Cipher that is the inverse of</span></span><br><span class="line"><span class="comment"> * ShiftRows().</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">inv_shift_rows</span><span class="params">(<span class="keyword">uint8_t</span>* state)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">uint8_t</span> i, k, s, tmp;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">    s = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (s &lt; i) &#123;</span><br><span class="line">      tmp = state[Nb * i + Nb - <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> (k = Nb - <span class="number">1</span>; k &gt; <span class="number">0</span>; k--) &#123;</span><br><span class="line">        state[Nb * i + k] = state[Nb * i + k - <span class="number">1</span>];</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      state[Nb * i + <span class="number">0</span>] = tmp;</span><br><span class="line">      s++;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Transformation in the Cipher that processes the State using a non­</span></span><br><span class="line"><span class="comment"> * linear byte substitution table (S-box) that operates on each of the</span></span><br><span class="line"><span class="comment"> * State bytes independently.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sub_bytes</span><span class="params">(<span class="keyword">uint8_t</span>* state)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">uint8_t</span> i, j;</span><br><span class="line">  <span class="keyword">uint8_t</span> row, col;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; Nb; j++) &#123;</span><br><span class="line">      row = (state[Nb * i + j] &amp; <span class="number">0xf0</span>) &gt;&gt; <span class="number">4</span>;</span><br><span class="line">      col = state[Nb * i + j] &amp; <span class="number">0x0f</span>;</span><br><span class="line">      state[Nb * i + j] = s_box[<span class="number">16</span> * row + col];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Transformation in the Inverse Cipher that is the inverse of</span></span><br><span class="line"><span class="comment"> * SubBytes().</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">inv_sub_bytes</span><span class="params">(<span class="keyword">uint8_t</span>* state)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">uint8_t</span> i, j;</span><br><span class="line">  <span class="keyword">uint8_t</span> row, col;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; Nb; j++) &#123;</span><br><span class="line">      row = (state[Nb * i + j] &amp; <span class="number">0xf0</span>) &gt;&gt; <span class="number">4</span>;</span><br><span class="line">      col = state[Nb * i + j] &amp; <span class="number">0x0f</span>;</span><br><span class="line">      state[Nb * i + j] = inv_s_box[<span class="number">16</span> * row + col];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Function used in the Key Expansion routine that takes a four-byte</span></span><br><span class="line"><span class="comment"> * input word and applies an S-box to each of the four bytes to</span></span><br><span class="line"><span class="comment"> * produce an output word.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sub_word</span><span class="params">(<span class="keyword">uint8_t</span>* w)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">uint8_t</span> i;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">    w[i] = s_box[<span class="number">16</span> * ((w[i] &amp; <span class="number">0xf0</span>) &gt;&gt; <span class="number">4</span>) + (w[i] &amp; <span class="number">0x0f</span>)];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Function used in the Key Expansion routine that takes a four-byte</span></span><br><span class="line"><span class="comment"> * word and performs a cyclic permutation.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">rot_word</span><span class="params">(<span class="keyword">uint8_t</span>* w)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">uint8_t</span> tmp;</span><br><span class="line">  <span class="keyword">uint8_t</span> i;</span><br><span class="line"></span><br><span class="line">  tmp = w[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">    w[i] = w[i + <span class="number">1</span>];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  w[<span class="number">3</span>] = tmp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Key Expansion</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">aes_key_expansion</span><span class="params">(<span class="keyword">uint8_t</span>* key, <span class="keyword">uint8_t</span>* w)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">uint8_t</span> tmp[<span class="number">4</span>];</span><br><span class="line">  <span class="keyword">uint8_t</span> i, j;</span><br><span class="line">  <span class="keyword">uint8_t</span> len = Nb * (Nr + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; Nk; i++) &#123;</span><br><span class="line">    w[<span class="number">4</span> * i + <span class="number">0</span>] = key[<span class="number">4</span> * i + <span class="number">0</span>];</span><br><span class="line">    w[<span class="number">4</span> * i + <span class="number">1</span>] = key[<span class="number">4</span> * i + <span class="number">1</span>];</span><br><span class="line">    w[<span class="number">4</span> * i + <span class="number">2</span>] = key[<span class="number">4</span> * i + <span class="number">2</span>];</span><br><span class="line">    w[<span class="number">4</span> * i + <span class="number">3</span>] = key[<span class="number">4</span> * i + <span class="number">3</span>];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i = Nk; i &lt; len; i++) &#123;</span><br><span class="line">    tmp[<span class="number">0</span>] = w[<span class="number">4</span> * (i - <span class="number">1</span>) + <span class="number">0</span>];</span><br><span class="line">    tmp[<span class="number">1</span>] = w[<span class="number">4</span> * (i - <span class="number">1</span>) + <span class="number">1</span>];</span><br><span class="line">    tmp[<span class="number">2</span>] = w[<span class="number">4</span> * (i - <span class="number">1</span>) + <span class="number">2</span>];</span><br><span class="line">    tmp[<span class="number">3</span>] = w[<span class="number">4</span> * (i - <span class="number">1</span>) + <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (i % Nk == <span class="number">0</span>) &#123;</span><br><span class="line">      rot_word(tmp);</span><br><span class="line">      sub_word(tmp);</span><br><span class="line">      coef_add(tmp, Rcon(i / Nk), tmp);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (Nk &gt; <span class="number">6</span> &amp;&amp; i % Nk == <span class="number">4</span>) &#123;</span><br><span class="line">      sub_word(tmp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    w[<span class="number">4</span> * i + <span class="number">0</span>] = w[<span class="number">4</span> * (i - Nk) + <span class="number">0</span>] ^ tmp[<span class="number">0</span>];</span><br><span class="line">    w[<span class="number">4</span> * i + <span class="number">1</span>] = w[<span class="number">4</span> * (i - Nk) + <span class="number">1</span>] ^ tmp[<span class="number">1</span>];</span><br><span class="line">    w[<span class="number">4</span> * i + <span class="number">2</span>] = w[<span class="number">4</span> * (i - Nk) + <span class="number">2</span>] ^ tmp[<span class="number">2</span>];</span><br><span class="line">    w[<span class="number">4</span> * i + <span class="number">3</span>] = w[<span class="number">4</span> * (i - Nk) + <span class="number">3</span>] ^ tmp[<span class="number">3</span>];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Initialize AES variables and allocate memory for expanded key</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">uint8_t</span>* <span class="title">aes_init</span><span class="params">(<span class="keyword">size_t</span> key_size)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (key_size) &#123;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="number">16</span>:</span><br><span class="line">      Nk = <span class="number">4</span>;</span><br><span class="line">      Nr = <span class="number">10</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">24</span>:</span><br><span class="line">      Nk = <span class="number">6</span>;</span><br><span class="line">      Nr = <span class="number">12</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">32</span>:</span><br><span class="line">      Nk = <span class="number">8</span>;</span><br><span class="line">      Nr = <span class="number">14</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">malloc</span>(Nb * (Nr + <span class="number">1</span>) * <span class="number">4</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Performs the AES cipher operation</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">aes_cipher</span><span class="params">(<span class="keyword">uint8_t</span>* in, <span class="keyword">uint8_t</span>* out, <span class="keyword">uint8_t</span>* w)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">uint8_t</span> state[<span class="number">4</span> * Nb];</span><br><span class="line">  <span class="keyword">uint8_t</span> r, i, j;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; Nb; j++) &#123;</span><br><span class="line">      state[Nb * i + j] = in[i + <span class="number">4</span> * j];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  add_round_key(state, w, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (r = <span class="number">1</span>; r &lt; Nr; r++) &#123;</span><br><span class="line">    sub_bytes(state);</span><br><span class="line">    shift_rows(state);</span><br><span class="line">    mix_columns(state);</span><br><span class="line">    add_round_key(state, w, r);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  sub_bytes(state);</span><br><span class="line">  shift_rows(state);</span><br><span class="line">  add_round_key(state, w, Nr);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; Nb; j++) &#123;</span><br><span class="line">      out[i + <span class="number">4</span> * j] = state[Nb * i + j];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Performs the AES inverse cipher operation</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">aes_inv_cipher</span><span class="params">(<span class="keyword">uint8_t</span>* in, <span class="keyword">uint8_t</span>* out, <span class="keyword">uint8_t</span>* w)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">uint8_t</span> state[<span class="number">4</span> * Nb];</span><br><span class="line">  <span class="keyword">uint8_t</span> r, i, j;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; Nb; j++) &#123;</span><br><span class="line">      state[Nb * i + j] = in[i + <span class="number">4</span> * j];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  add_round_key(state, w, Nr);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (r = Nr - <span class="number">1</span>; r &gt;= <span class="number">1</span>; r--) &#123;</span><br><span class="line">    inv_shift_rows(state);</span><br><span class="line">    inv_sub_bytes(state);</span><br><span class="line">    add_round_key(state, w, r);</span><br><span class="line">    inv_mix_columns(state);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  inv_shift_rows(state);</span><br><span class="line">  inv_sub_bytes(state);</span><br><span class="line">  add_round_key(state, w, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; Nb; j++) &#123;</span><br><span class="line">      out[i + <span class="number">4</span> * j] = state[Nb * i + j];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span> </span>&#123;</span><br><span class="line">  <span class="keyword">uint8_t</span> i;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">   * Appendix A - Key Expansion Examples</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* 128 bits */</span></span><br><span class="line">  <span class="comment">/* uint8_t key[] = &#123;</span></span><br><span class="line"><span class="comment">          0x2b, 0x7e, 0x15, 0x16,</span></span><br><span class="line"><span class="comment">          0x28, 0xae, 0xd2, 0xa6,</span></span><br><span class="line"><span class="comment">          0xab, 0xf7, 0x15, 0x88,</span></span><br><span class="line"><span class="comment">          0x09, 0xcf, 0x4f, 0x3c&#125;; */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* 192 bits */</span></span><br><span class="line">  <span class="comment">/* uint8_t key[] = &#123;</span></span><br><span class="line"><span class="comment">          0x8e, 0x73, 0xb0, 0xf7,</span></span><br><span class="line"><span class="comment">          0xda, 0x0e, 0x64, 0x52,</span></span><br><span class="line"><span class="comment">          0xc8, 0x10, 0xf3, 0x2b,</span></span><br><span class="line"><span class="comment">          0x80, 0x90, 0x79, 0xe5,</span></span><br><span class="line"><span class="comment">          0x62, 0xf8, 0xea, 0xd2,</span></span><br><span class="line"><span class="comment">          0x52, 0x2c, 0x6b, 0x7b&#125;; */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* 256 bits */</span></span><br><span class="line">  <span class="comment">/* uint8_t key[] = &#123;</span></span><br><span class="line"><span class="comment">          0x60, 0x3d, 0xeb, 0x10,</span></span><br><span class="line"><span class="comment">          0x15, 0xca, 0x71, 0xbe,</span></span><br><span class="line"><span class="comment">          0x2b, 0x73, 0xae, 0xf0,</span></span><br><span class="line"><span class="comment">          0x85, 0x7d, 0x77, 0x81,</span></span><br><span class="line"><span class="comment">          0x1f, 0x35, 0x2c, 0x07,</span></span><br><span class="line"><span class="comment">          0x3b, 0x61, 0x08, 0xd7,</span></span><br><span class="line"><span class="comment">          0x2d, 0x98, 0x10, 0xa3,</span></span><br><span class="line"><span class="comment">          0x09, 0x14, 0xdf, 0xf4&#125;;</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* uint8_t in[] = &#123;</span></span><br><span class="line"><span class="comment">          0x32, 0x43, 0xf6, 0xa8,</span></span><br><span class="line"><span class="comment">          0x88, 0x5a, 0x30, 0x8d,</span></span><br><span class="line"><span class="comment">          0x31, 0x31, 0x98, 0xa2,</span></span><br><span class="line"><span class="comment">          0xe0, 0x37, 0x07, 0x34&#125;; // 128</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">uint8_t</span> key[] = &#123;<span class="number">0x00</span>, <span class="number">0x11</span>, <span class="number">0x22</span>, <span class="number">0x33</span>, <span class="number">0x44</span>, <span class="number">0x55</span>, <span class="number">0x66</span>, <span class="number">0x77</span>,</span><br><span class="line">                   <span class="number">0x88</span>, <span class="number">0x99</span>, <span class="number">0xaa</span>, <span class="number">0xbb</span>, <span class="number">0xcc</span>, <span class="number">0xdd</span>, <span class="number">0xee</span>, <span class="number">0xff</span>&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">uint8_t</span> in[] = &#123;<span class="number">0x00</span>, <span class="number">0x11</span>, <span class="number">0x22</span>, <span class="number">0x33</span>, <span class="number">0x44</span>, <span class="number">0x55</span>, <span class="number">0x66</span>, <span class="number">0x77</span>,</span><br><span class="line">                  <span class="number">0x88</span>, <span class="number">0x99</span>, <span class="number">0xaa</span>, <span class="number">0xbb</span>, <span class="number">0xcc</span>, <span class="number">0xdd</span>, <span class="number">0xee</span>, <span class="number">0xff</span>&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">uint8_t</span> out[<span class="number">16</span>];  <span class="comment">// 128</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">uint8_t</span>* w;  <span class="comment">// expanded key</span></span><br><span class="line"></span><br><span class="line">  w = aes_init(<span class="keyword">sizeof</span>(key));</span><br><span class="line"></span><br><span class="line">  aes_key_expansion(key, w);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Plaintext message:\n"</span>);</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%x %x %x %x "</span>, in[<span class="number">4</span> * i + <span class="number">0</span>], in[<span class="number">4</span> * i + <span class="number">1</span>], in[<span class="number">4</span> * i + <span class="number">2</span>],</span><br><span class="line">           in[<span class="number">4</span> * i + <span class="number">3</span>]);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line"></span><br><span class="line">  aes_cipher(in <span class="comment">/* in */</span>, out <span class="comment">/* out */</span>, w <span class="comment">/* expanded key */</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Ciphered message:\n"</span>);</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%x %x %x %x "</span>, out[<span class="number">4</span> * i + <span class="number">0</span>], out[<span class="number">4</span> * i + <span class="number">1</span>], out[<span class="number">4</span> * i + <span class="number">2</span>],</span><br><span class="line">           out[<span class="number">4</span> * i + <span class="number">3</span>]);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line"></span><br><span class="line">  aes_inv_cipher(out, in, w);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Original message (after inv cipher):\n"</span>);</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%x %x %x %x "</span>, in[<span class="number">4</span> * i + <span class="number">0</span>], in[<span class="number">4</span> * i + <span class="number">1</span>], in[<span class="number">4</span> * i + <span class="number">2</span>],</span><br><span class="line">           in[<span class="number">4</span> * i + <span class="number">3</span>]);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">free</span>(w);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="IDEA"><a href="#IDEA" class="headerlink" title="IDEA"></a>IDEA</h3><h4 id="关于IDEA"><a href="#关于IDEA" class="headerlink" title="关于IDEA"></a>关于IDEA</h4><blockquote>
<p>国际数据加密算法（IDEA）是来学嘉与James Massey联合提出的。这种算法是在DES算法的基础上发展出来的，类似于三重DES。分组长度为64位，密钥长度为128位，算法使用3种不同代数群操作。</p>
</blockquote>
<h4 id="算法原理-2"><a href="#算法原理-2" class="headerlink" title="算法原理"></a>算法原理</h4><h5 id="子密钥生成-1"><a href="#子密钥生成-1" class="headerlink" title="子密钥生成"></a>子密钥生成</h5><p><strong>IDEA密钥长度为128位，子密钥长度为16位共52个</strong></p>
<p>a.128位密钥分为8个16位分组，直接作为前八个子密钥</p>
<p>b.128位密钥循环<strong>左移</strong>25位，生成的128位密钥分为8个16位分组，作为接下来的8个子密钥</p>
<p>c.继续执行步骤b，直至52个子密钥全部生成完毕</p>
<h5 id="IDEA加密"><a href="#IDEA加密" class="headerlink" title="IDEA加密"></a>IDEA加密</h5><p>64为明文被分成4个16位分组。每一轮加密都需要6个子密钥，最后的输出变换只需要4个子密钥，所以共需8*6+4=52个子密钥。一轮加密中，4个16位子密钥分别通过2个模2^16+1（65537）乘法和2个模2^16(65536)加法运算与明文混合，并用2个16位子密钥按位异或对结果进行处理，前一轮加密结果作为后一轮加密的输入。总共进行8轮加密，最后用4个子密钥变换输出最终的密文。</p>
<h5 id="IDEA解密"><a href="#IDEA解密" class="headerlink" title="IDEA解密"></a>IDEA解密</h5><p>解密过程同加密过程，唯一不同的是子密钥不同。</p>
<p>解密所需的52个子密钥是加密子密钥相对于不同操作运输的逆元，且解密时子密钥使用顺序相反。（乘法逆元可以通过扩展欧几里得算法求出）</p>
<h4 id="加解密实现-1"><a href="#加解密实现-1" class="headerlink" title="加解密实现"></a>加解密实现</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// https://github.com/razvanalex/IDEA-encryption-algorithm</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">__uint32_t</span> <span class="keyword">uint32_t</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">__int32_t</span> <span class="keyword">int32_t</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">__uint16_t</span> <span class="keyword">uint16_t</span>;</span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(*idea_gen_key)</span><span class="params">(<span class="keyword">uint16_t</span>[<span class="number">52</span>], <span class="keyword">uint16_t</span>[<span class="number">8</span>])</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">uint16_t</span> <span class="title">mulMod65537</span><span class="params">(<span class="keyword">uint16_t</span> a, <span class="keyword">uint16_t</span> b)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">uint32_t</span> c;</span><br><span class="line">  <span class="keyword">uint16_t</span> hi, lo;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (a == <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> -b + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> (b == <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> -a + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  c = (<span class="keyword">uint32_t</span>)a * (<span class="keyword">uint32_t</span>)b;</span><br><span class="line">  hi = c &gt;&gt; <span class="number">16</span>;</span><br><span class="line">  lo = c;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (lo &gt; hi)</span><br><span class="line">    <span class="keyword">return</span> lo - hi;</span><br><span class="line">  <span class="keyword">return</span> lo - hi + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">modInverse</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> m)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> m0 = m, t, q;</span><br><span class="line">  <span class="keyword">int</span> x0 = <span class="number">0</span>, x1 = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (m == <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (a &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="comment">// q is quotient</span></span><br><span class="line">    q = a / m;</span><br><span class="line">    t = m;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// m is remainder now, process same as</span></span><br><span class="line">    <span class="comment">// Euclid's algo</span></span><br><span class="line">    m = a % m;</span><br><span class="line">    a = t;</span><br><span class="line"></span><br><span class="line">    t = x0;</span><br><span class="line">    x0 = x1 - q * x0;</span><br><span class="line">    x1 = t;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Make x1 positive</span></span><br><span class="line">  <span class="keyword">if</span> (x1 &lt; <span class="number">0</span>)</span><br><span class="line">    x1 += m0;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> x1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">encrypt</span><span class="params">(<span class="keyword">uint16_t</span> subKey[<span class="number">52</span>], <span class="keyword">uint16_t</span> key[<span class="number">8</span>])</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Generate encryption keys</span></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">52</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (i &lt; <span class="number">8</span>)</span><br><span class="line">      subKey[i] = key[i];</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (i % <span class="number">8</span> == <span class="number">6</span>)</span><br><span class="line">      subKey[i] = (subKey[i - <span class="number">7</span>] &lt;&lt; <span class="number">9</span>) | (subKey[i - <span class="number">14</span>] &gt;&gt; <span class="number">7</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (i % <span class="number">8</span> == <span class="number">7</span>)</span><br><span class="line">      subKey[i] = (subKey[i - <span class="number">15</span>] &lt;&lt; <span class="number">9</span>) | (subKey[i - <span class="number">14</span>] &gt;&gt; <span class="number">7</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      subKey[i] = (subKey[i - <span class="number">7</span>] &lt;&lt; <span class="number">9</span>) | (subKey[i - <span class="number">6</span>] &gt;&gt; <span class="number">7</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">decrypt</span><span class="params">(<span class="keyword">uint16_t</span> subKey[<span class="number">52</span>], <span class="keyword">uint16_t</span> key[<span class="number">8</span>])</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i;</span><br><span class="line">  <span class="keyword">uint16_t</span> K[<span class="number">52</span>];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Compute encryption keys</span></span><br><span class="line">  encrypt(K, key);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Generate dencryption keys</span></span><br><span class="line">  subKey[<span class="number">0</span>] = modInverse(K[<span class="number">48</span>], <span class="number">65537</span>);</span><br><span class="line">  subKey[<span class="number">1</span>] = -K[<span class="number">49</span>];</span><br><span class="line">  subKey[<span class="number">2</span>] = -K[<span class="number">50</span>];</span><br><span class="line">  subKey[<span class="number">3</span>] = modInverse(K[<span class="number">51</span>], <span class="number">65537</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Keys: %04X %04X %04X %04X\n"</span>, subKey[<span class="number">0</span>], subKey[<span class="number">1</span>], subKey[<span class="number">2</span>],</span><br><span class="line">         subKey[<span class="number">3</span>]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">4</span>; i &lt; <span class="number">52</span>; i += <span class="number">6</span>) &#123;</span><br><span class="line">    subKey[i + <span class="number">0</span>] = K[<span class="number">52</span> - i - <span class="number">2</span>];</span><br><span class="line">    subKey[i + <span class="number">1</span>] = K[<span class="number">52</span> - i - <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    subKey[i + <span class="number">2</span>] = modInverse(K[<span class="number">52</span> - i - <span class="number">6</span>], <span class="number">65537</span>);</span><br><span class="line">    <span class="keyword">if</span> (i == <span class="number">46</span>) &#123;</span><br><span class="line">      subKey[i + <span class="number">3</span>] = -K[<span class="number">52</span> - i - <span class="number">5</span>];</span><br><span class="line">      subKey[i + <span class="number">4</span>] = -K[<span class="number">52</span> - i - <span class="number">4</span>];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      subKey[i + <span class="number">3</span>] = -K[<span class="number">52</span> - i - <span class="number">4</span>];</span><br><span class="line">      subKey[i + <span class="number">4</span>] = -K[<span class="number">52</span> - i - <span class="number">5</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    subKey[i + <span class="number">5</span>] = modInverse(K[<span class="number">52</span> - i - <span class="number">3</span>], <span class="number">65537</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Keys: %04X %04X %04X %04X %04X %04X\n"</span>, subKey[i], subKey[i + <span class="number">1</span>],</span><br><span class="line">           subKey[i + <span class="number">2</span>], subKey[i + <span class="number">3</span>], subKey[i + <span class="number">4</span>], subKey[i + <span class="number">5</span>]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">IDEA</span><span class="params">(<span class="keyword">uint16_t</span> data[<span class="number">4</span>], <span class="keyword">uint16_t</span> key[<span class="number">8</span>], idea_gen_key func)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i;</span><br><span class="line">  <span class="keyword">uint16_t</span> subKey[<span class="number">52</span>];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Generate keys</span></span><br><span class="line">  func(subKey, key);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">uint16_t</span> X0 = data[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">uint16_t</span> X1 = data[<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">uint16_t</span> X2 = data[<span class="number">2</span>];</span><br><span class="line">  <span class="keyword">uint16_t</span> X3 = data[<span class="number">3</span>];</span><br><span class="line">  <span class="keyword">uint16_t</span> tmp1, tmp2;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Apply 8 rounds</span></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d:   %04X %04X %04X %04X\n"</span>, i, X0, X1, X2, X3);</span><br><span class="line"></span><br><span class="line">    X0 = mulMod65537(X0, subKey[<span class="number">6</span> * i + <span class="number">0</span>]);  <span class="comment">// Step 1</span></span><br><span class="line">    X1 += subKey[<span class="number">6</span> * i + <span class="number">1</span>];                  <span class="comment">// Step 2</span></span><br><span class="line">    X2 += subKey[<span class="number">6</span> * i + <span class="number">2</span>];                  <span class="comment">// Step 3</span></span><br><span class="line">    X3 = mulMod65537(X3, subKey[<span class="number">6</span> * i + <span class="number">3</span>]);  <span class="comment">// Step 4</span></span><br><span class="line"></span><br><span class="line">    tmp1 = X0 ^ X2;  <span class="comment">// Step 5</span></span><br><span class="line">    tmp2 = X1 ^ X3;  <span class="comment">// Step 6</span></span><br><span class="line"></span><br><span class="line">    tmp1 = mulMod65537(tmp1, subKey[<span class="number">6</span> * i + <span class="number">4</span>]);  <span class="comment">// Step 7</span></span><br><span class="line">    tmp2 += tmp1;                                 <span class="comment">// Step 8</span></span><br><span class="line">    tmp2 = mulMod65537(tmp2, subKey[<span class="number">6</span> * i + <span class="number">5</span>]);  <span class="comment">// Step 9</span></span><br><span class="line">    tmp1 += tmp2;                                 <span class="comment">// Step 10</span></span><br><span class="line"></span><br><span class="line">    X0 ^= tmp2;</span><br><span class="line">    X1 ^= tmp1;</span><br><span class="line">    X2 ^= tmp2;</span><br><span class="line">    X3 ^= tmp1;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Swap X1 and X2</span></span><br><span class="line">    tmp1 = X1;</span><br><span class="line">    X1 = X2;</span><br><span class="line">    X2 = tmp1;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  tmp1 = X1;</span><br><span class="line">  tmp2 = X2;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Apply the half round</span></span><br><span class="line">  data[<span class="number">0</span>] = mulMod65537(X0, subKey[<span class="number">6</span> * i + <span class="number">0</span>]);</span><br><span class="line">  data[<span class="number">1</span>] = tmp2 + subKey[<span class="number">6</span> * i + <span class="number">1</span>];</span><br><span class="line">  data[<span class="number">2</span>] = tmp1 + subKey[<span class="number">6</span> * i + <span class="number">2</span>];</span><br><span class="line">  data[<span class="number">3</span>] = mulMod65537(X3, subKey[<span class="number">6</span> * i + <span class="number">3</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">uint16_t</span> <span class="title">binToInt</span><span class="params">(<span class="keyword">char</span>* str)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i;</span><br><span class="line">  <span class="keyword">uint16_t</span> <span class="built_in">size</span> = <span class="built_in">strlen</span>(str);</span><br><span class="line">  <span class="keyword">uint16_t</span> result = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">uint16_t</span> <span class="built_in">pow</span> = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="built_in">size</span> - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">    <span class="keyword">if</span> (str[i] == <span class="string">'1'</span>)</span><br><span class="line">      result += <span class="built_in">pow</span>;</span><br><span class="line">    <span class="built_in">pow</span> *= <span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">convertStringToBin</span><span class="params">(<span class="keyword">char</span>* str, <span class="keyword">uint16_t</span>* data, <span class="keyword">uint16_t</span> <span class="built_in">size</span>)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i, j = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">int</span> sizeBlock = <span class="keyword">sizeof</span>(<span class="keyword">uint16_t</span>) * <span class="number">8</span>;</span><br><span class="line">  <span class="keyword">char</span> block[sizeBlock + <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(str) &amp;&amp; i &lt; <span class="built_in">size</span> * <span class="keyword">sizeof</span>(<span class="keyword">uint16_t</span>);</span><br><span class="line">       i += <span class="keyword">sizeof</span>(<span class="keyword">uint16_t</span>)) &#123;</span><br><span class="line">    <span class="built_in">strncpy</span>(block, str, sizeBlock);</span><br><span class="line">    block[sizeBlock] = <span class="string">'\0'</span>;</span><br><span class="line"></span><br><span class="line">    data[j++] = binToInt(block);</span><br><span class="line">    str += sizeBlock;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">char</span> Data[<span class="number">64</span>] =</span><br><span class="line">      <span class="string">"0000010100110010000010100110010000010100110010000001100111111010"</span>;</span><br><span class="line">  <span class="keyword">char</span> Key[<span class="number">128</span>] =</span><br><span class="line">      <span class="string">"000000000110010000000000110010000000000100101100000000011001000000000001"</span></span><br><span class="line">      <span class="string">"11110100000000100101100000000010101111000000001100100000"</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">uint16_t</span> data[<span class="number">4</span>];</span><br><span class="line">  <span class="keyword">uint16_t</span> key[<span class="number">8</span>];</span><br><span class="line"></span><br><span class="line">  convertStringToBin(Data, data, <span class="number">4</span>);</span><br><span class="line">  convertStringToBin(Key, key, <span class="number">8</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Print initial data</span></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Initial data:   %04X %04X %04X %04X\n"</span>, data[<span class="number">0</span>], data[<span class="number">1</span>], data[<span class="number">2</span>],</span><br><span class="line">         data[<span class="number">3</span>]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Encrypt data</span></span><br><span class="line">  IDEA(data, key, encrypt);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Encrypted data: %04X %04X %04X %04X\n"</span>, data[<span class="number">0</span>], data[<span class="number">1</span>], data[<span class="number">2</span>],</span><br><span class="line">         data[<span class="number">3</span>]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Decrypt data</span></span><br><span class="line">  IDEA(data, key, decrypt);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Decrypted data: %04X %04X %04X %04X\n"</span>, data[<span class="number">0</span>], data[<span class="number">1</span>], data[<span class="number">2</span>],</span><br><span class="line">         data[<span class="number">3</span>]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="SM4"><a href="#SM4" class="headerlink" title="SM4"></a>SM4</h3><h4 id="关于SM4"><a href="#关于SM4" class="headerlink" title="关于SM4"></a>关于SM4</h4><blockquote>
<p>SM4是一个具有128块大小和128位密钥的分组密码算法。加密算法和密钥扩展算法采用32轮线性非迭代结构，S盒输入为8bits，输出也为8bits。</p>
</blockquote>
<h4 id="算法原理-3"><a href="#算法原理-3" class="headerlink" title="算法原理"></a>算法原理</h4><p><a href="https://drive.google.com/file/d/0B0o25hRlUdXcbzdjT0hrYkkwUjg/view" target="_blank" rel="noopener">参考文档</a></p>
<h5 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h5><p><strong>F函数</strong></p>
<p><em>F(X0, X1, X2, X3, rk) = X0 ⊕ T(X1 ⊕ X2 ⊕ X3 ⊕ rk)</em></p>
<p><strong>合成置换T</strong></p>
<p>由非线性变换τ 和线性变换L复合合成 <em>T(x)=L(τ(x))</em></p>
<p><strong>非线性变换τ</strong></p>
<p>τ由四个并行的S-box组成（S-box为16*16 * 8bits，输入8bits，输出8bits）</p>
<p>若输出为<em>A(A0, A1, A2, A3)<em>，输出为</em>B(B0, B1, B2, B3)</em></p>
<p>则<em>B(B0, B1, B2, B3) = τ(A) = (S-box(A0), S-box(A1), S-box(A2), S-box(A3)</em></p>
<p><strong>线性变换L</strong></p>
<p>线性变换L的输入是非线性变换τ的输出</p>
<p>输出<em>C = L(B) = B ⊕ (B &lt;&lt;&lt; 2) ⊕ (B &lt;&lt;&lt; 10) ⊕ (B &lt;&lt;&lt; 18) ⊕ (B &lt;&lt;&lt; 24)</em></p>
<p><strong>T’变换</strong></p>
<p><em>T’(x)=L’(τ(x))</em></p>
<p><strong>L’变换</strong></p>
<p><em>C = L(B) = B ⊕ (B &lt;&lt;&lt; 13) ⊕ (B &lt;&lt;&lt; 23)</em></p>
<p>反序变换<em>R(A0, A1, A2, A3) = (A3, A2, A1, A0)</em></p>
<h5 id="密钥扩展算法"><a href="#密钥扩展算法" class="headerlink" title="密钥扩展算法"></a>密钥扩展算法</h5><p>加密密钥128位为 <em>MK(MK0, MK1, MK2, MK3)</em></p>
<p>子密钥128位，共32个为<em>rk0, rk1 , … , rk31</em></p>
<p>系统参数<strong>FKi</strong>取值为FK[4] = {0xa3b1bac6, 0x56aa3350, 0x677d9197, 0xb27022dc}</p>
<p>固定参数<strong>CKi</strong>取值为 CK[32] = {</p>
<p>​    0x00070e15, 0x1c232a31, 0x383f464d, 0x545b6269, 0x70777e85, 0x8c939aa1,</p>
<p>​    0xa8afb6bd, 0xc4cbd2d9, 0xe0e7eef5, 0xfc030a11, 0x181f262d, 0x343b4249,</p>
<p>​    0x50575e65, 0x6c737a81, 0x888f969d, 0xa4abb2b9, 0xc0c7ced5, 0xdce3eaf1,</p>
<p>​    0xf8ff060d, 0x141b2229, 0x30373e45, 0x4c535a61, 0x686f767d, 0x848b9299,</p>
<p>​    0xa0a7aeb5, 0xbcc3cad1, 0xd8dfe6ed, 0xf4fb0209, 0x10171e25, 0x2c333a41,</p>
<p>​    0x484f565d, 0x646b7279};</p>
<p><strong>子密钥生成算法如下</strong></p>
<p><em>(K0,K1,K2,K3)=(MK0 ⊕ FK0, MK1⊕FK1, MK2⊕FK2, MK3⊕FK3)</em></p>
<p><em>rki = K(i+4) = Ki ⊕ T’(K(i+1) ⊕ K(i+2) ⊕ K(i+3) ⊕ CKi)</em> <em>(i = 0 ,1 , … , 31)</em></p>
<h5 id="加密算法"><a href="#加密算法" class="headerlink" title="加密算法"></a>加密算法</h5><p>明文输入为<em>X(X0, X1, X2, X3)<em>，密文输出为</em>Y(Y0, Y1, Y2, Y3)</em></p>
<p><em>Xi+4 = F(Xi, Xi+1, Xi+2, Xi+3, rki) = Xi ⊕ T(Xi+1 ⊕ Xi+2 ⊕ Xi+3 ⊕ rki)</em> <em>(i = 0 ,1 , … , 31)</em></p>
<p><em>Y(Y0, Y1, Y2, Y3) = R(X32, X33, X34, X35) = (X35, X34, X33, X32)</em></p>
<h5 id="解密算法"><a href="#解密算法" class="headerlink" title="解密算法"></a>解密算法</h5><p>解密算法和加密算法相同，唯一区别是密钥使用顺序要<strong>逆序</strong>使用</p>
<h4 id="加解密实现-2"><a href="#加解密实现-2" class="headerlink" title="加解密实现"></a>加解密实现</h4><p>from <a href="https://zhuanlan.zhihu.com/p/43951432" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/43951432</a></p>
<p><strong>sm4.c</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*************************************************************************</span></span><br><span class="line"><span class="comment">       &gt; File Name: run_sm4.c</span></span><br><span class="line"><span class="comment">       &gt; Author:yangkefeng</span></span><br><span class="line"><span class="comment">       &gt; E-mail:muyidixin2006@126.com</span></span><br><span class="line"><span class="comment">       &gt; Created Time: Thu July 13 23:55:50 2018</span></span><br><span class="line"><span class="comment">************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sm4.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> mode = <span class="number">0</span>, flag = <span class="number">1</span>, format_res;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> iv[<span class="number">16</span>] = &#123;<span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x2</span>, <span class="number">0x3</span>, <span class="number">0x4</span>, <span class="number">0x5</span>, <span class="number">0x6</span>, <span class="number">0x7</span>,</span><br><span class="line">                          <span class="number">0x8</span>, <span class="number">0x9</span>, <span class="number">0xa</span>, <span class="number">0xb</span>, <span class="number">0xc</span>, <span class="number">0xd</span>, <span class="number">0xe</span>, <span class="number">0xf</span>&#125;;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> output[<span class="number">16</span>];</span><br><span class="line">  <span class="keyword">long</span> i;</span><br><span class="line">  <span class="comment">// SM4 mode:SM4_ECB 0,SM4_CBC 1,SM4_CFB 2,SM4_OFB 3,SM4_CTR 4</span></span><br><span class="line">  <span class="comment">// SM4 flag:encrypt=1/decrypt=0</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> input[<span class="number">16</span>] = &#123;<span class="number">0x01</span>, <span class="number">0x23</span>, <span class="number">0x45</span>, <span class="number">0x67</span>, <span class="number">0x89</span>, <span class="number">0xab</span>, <span class="number">0xcd</span>, <span class="number">0xef</span>,</span><br><span class="line">                             <span class="number">0xfe</span>, <span class="number">0xdc</span>, <span class="number">0xba</span>, <span class="number">0x98</span>, <span class="number">0x76</span>, <span class="number">0x54</span>, <span class="number">0x32</span>, <span class="number">0x10</span>&#125;;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> key[<span class="number">16</span>] = &#123;<span class="number">0x01</span>, <span class="number">0x23</span>, <span class="number">0x45</span>, <span class="number">0x67</span>, <span class="number">0x89</span>, <span class="number">0xab</span>, <span class="number">0xcd</span>, <span class="number">0xef</span>,</span><br><span class="line">                           <span class="number">0xfe</span>, <span class="number">0xdc</span>, <span class="number">0xba</span>, <span class="number">0x98</span>, <span class="number">0x76</span>, <span class="number">0x54</span>, <span class="number">0x32</span>, <span class="number">0x10</span>&#125;;</span><br><span class="line">  flag = <span class="number">1</span>;</span><br><span class="line">  mode = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  sm4(key, mode, flag, <span class="number">16</span>, iv, input, output);</span><br><span class="line">  <span class="comment">// SM4 输出</span></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%02x"</span>, output[i]);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// int mode = 0, flag = 1, format_res;</span></span><br><span class="line">  <span class="comment">// unsigned char key[16];</span></span><br><span class="line">  <span class="comment">// unsigned char iv[16] = &#123;0x0, 0x1, 0x2, 0x3, 0x4, 0x5, 0x6, 0x7,</span></span><br><span class="line">  <span class="comment">//                         0x8, 0x9, 0xa, 0xb, 0xc, 0xd, 0xe, 0xf&#125;;</span></span><br><span class="line">  <span class="comment">// unsigned char input[16];</span></span><br><span class="line">  <span class="comment">// unsigned char output[16];</span></span><br><span class="line">  <span class="comment">// long i;</span></span><br><span class="line">  <span class="comment">// // SM4 input 读取</span></span><br><span class="line">  <span class="comment">// format_res = format_park_input(argv[1], input);</span></span><br><span class="line">  <span class="comment">// if (format_res == 0) &#123;</span></span><br><span class="line">  <span class="comment">//   printf("明文/密文必须是32位16进制的数(0-F)\n");</span></span><br><span class="line">  <span class="comment">//   return 0;</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line">  <span class="comment">// // SM4 key 读取</span></span><br><span class="line">  <span class="comment">// format_res = format_park_input(argv[2], key);</span></span><br><span class="line">  <span class="comment">// if (format_res == 0) &#123;</span></span><br><span class="line">  <span class="comment">//   printf("密钥必须是32位16进制的数(0-F)\n");</span></span><br><span class="line">  <span class="comment">//   return 0;</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line">  <span class="comment">// // SM4 mode:SM4_ECB 0,SM4_CBC 1,SM4_CFB 2,SM4_OFB 3,SM4_CTR 4</span></span><br><span class="line">  <span class="comment">// mode = atoi(argv[3]);</span></span><br><span class="line">  <span class="comment">// // SM4 flag:encrypt=1/decrypt=0</span></span><br><span class="line">  <span class="comment">// flag = atoi(argv[4]);</span></span><br><span class="line">  <span class="comment">// sm4(key, mode, flag, 16, iv, input, output);</span></span><br><span class="line">  <span class="comment">// // SM4 输出</span></span><br><span class="line">  <span class="comment">// for (i = 0; i &lt; 16; i++)</span></span><br><span class="line">  <span class="comment">//   printf("%02x", output[i]);</span></span><br><span class="line">  <span class="comment">// printf("\n");</span></span><br><span class="line">  <span class="comment">// return 0;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>sm4.h</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*************************************************************************</span></span><br><span class="line"><span class="comment">       &gt; File Name: run_sm4.c</span></span><br><span class="line"><span class="comment">       &gt; Author:yangkefeng</span></span><br><span class="line"><span class="comment">       &gt; E-mail:muyidixin2006@126.com</span></span><br><span class="line"><span class="comment">       &gt; Created Time: Thu July 13 23:55:50 2018</span></span><br><span class="line"><span class="comment">************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> XYSSL_SM4_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> XYSSL_SM4_H</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> *sm4 select encrypt/decrypt by flag</span></span><br><span class="line"><span class="comment"> ***/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SM4_ENCRYPT 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SM4_DECRYPT 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> *sm4 select mode by mode</span></span><br><span class="line"><span class="comment"> ***/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SM4_ECB 0</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SM4_CBC 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SM4_CFB 2</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SM4_OFB 3</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SM4_CTR 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * \brief          SM4 context structure</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> mode;             <span class="comment">/*!&lt;  encrypt/decrypt   */</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">long</span> sk[<span class="number">32</span>]; <span class="comment">/*!&lt;  SM4 subkeys       */</span></span><br><span class="line">&#125; sm4_context;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * \brief          SM4 key schedule (128-bit, encryption)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * \param ctx      SM4 context to be initialized</span></span><br><span class="line"><span class="comment"> * \param key      16-byte secret key</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sm4_setkey_enc</span><span class="params">(sm4_context* ctx, <span class="keyword">unsigned</span> <span class="keyword">char</span> key[<span class="number">16</span>])</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * \brief          SM4 key schedule (128-bit, decryption)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * \param ctx      SM4 context to be initialized</span></span><br><span class="line"><span class="comment"> * \param key      16-byte secret key</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sm4_setkey_dec</span><span class="params">(sm4_context* ctx, <span class="keyword">unsigned</span> <span class="keyword">char</span> key[<span class="number">16</span>])</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * \brief          SM4-ECB block encryption/decryption</span></span><br><span class="line"><span class="comment"> * \param ctx      SM4 context</span></span><br><span class="line"><span class="comment"> * \param flag     SM4_ENCRYPT or SM4_DECRYPT</span></span><br><span class="line"><span class="comment"> * \param length   length of the input data</span></span><br><span class="line"><span class="comment"> * \param input    input block</span></span><br><span class="line"><span class="comment"> * \param output   output block</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sm4_crypt_ecb</span><span class="params">(sm4_context* ctx,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">int</span> flag,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">int</span> length,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">unsigned</span> <span class="keyword">char</span>* input,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">unsigned</span> <span class="keyword">char</span>* output)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * \brief          SM4-CBC buffer encryption/decryption</span></span><br><span class="line"><span class="comment"> * \param ctx      SM4 context</span></span><br><span class="line"><span class="comment"> * \param flag     SM4_ENCRYPT or SM4_DECRYPT</span></span><br><span class="line"><span class="comment"> * \param length   length of the input data</span></span><br><span class="line"><span class="comment"> * \param iv       initialization vector (updated after use)</span></span><br><span class="line"><span class="comment"> * \param input    buffer holding the input data</span></span><br><span class="line"><span class="comment"> * \param output   buffer holding the output data</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sm4_crypt_cbc</span><span class="params">(sm4_context* ctx,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">int</span> flag,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">int</span> length,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">unsigned</span> <span class="keyword">char</span> iv[<span class="number">16</span>],</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">unsigned</span> <span class="keyword">char</span>* input,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">unsigned</span> <span class="keyword">char</span>* output)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * \brief          SM4-CFB encryption/decryption</span></span><br><span class="line"><span class="comment"> * \param ctx      SM4 context</span></span><br><span class="line"><span class="comment"> * \param flag     SM4_ENCRYPT or SM4_DECRYPT</span></span><br><span class="line"><span class="comment"> * \param length   length of the input data</span></span><br><span class="line"><span class="comment"> * \param iv       initialization vector (updated after use)</span></span><br><span class="line"><span class="comment"> * \param input    buffer holding the input data</span></span><br><span class="line"><span class="comment"> * \param output   buffer holding the output data</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sm4_crypt_cfb</span><span class="params">(sm4_context* ctx,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">int</span> flag,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">int</span> length,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">unsigned</span> <span class="keyword">char</span> iv[<span class="number">16</span>],</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">unsigned</span> <span class="keyword">char</span>* input,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">unsigned</span> <span class="keyword">char</span>* output)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * \brief          SM4-OFB encryption/decryption</span></span><br><span class="line"><span class="comment"> * \param ctx      SM4 context</span></span><br><span class="line"><span class="comment"> * \param flag     SM4_ENCRYPT or SM4_DECRYPT</span></span><br><span class="line"><span class="comment"> * \param length   length of the input data</span></span><br><span class="line"><span class="comment"> * \param iv       initialization vector (updated after use)</span></span><br><span class="line"><span class="comment"> * \param input    buffer holding the input data</span></span><br><span class="line"><span class="comment"> * \param output   buffer holding the output data</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sm4_crypt_ofb</span><span class="params">(sm4_context* ctx,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">int</span> flag,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">int</span> length,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">unsigned</span> <span class="keyword">char</span> iv[<span class="number">16</span>],</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">unsigned</span> <span class="keyword">char</span>* input,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">unsigned</span> <span class="keyword">char</span>* output)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * \brief          SM4-CTR encryption/decryption</span></span><br><span class="line"><span class="comment"> * \param ctx      SM4 context</span></span><br><span class="line"><span class="comment"> * \param flag     SM4_ENCRYPT or SM4_DECRYPT</span></span><br><span class="line"><span class="comment"> * \param length   length of the input data</span></span><br><span class="line"><span class="comment"> * \param iv       initialization vector (updated after use)</span></span><br><span class="line"><span class="comment"> * \param input    buffer holding the input data</span></span><br><span class="line"><span class="comment"> * \param output   buffer holding the output data</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sm4_crypt_ctr</span><span class="params">(sm4_context* ctx,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">int</span> flag,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">int</span> length,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">unsigned</span> <span class="keyword">char</span> iv[<span class="number">16</span>],</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">unsigned</span> <span class="keyword">char</span>* input,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">unsigned</span> <span class="keyword">char</span>* output)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * \brief          SM4 encryption/decryption</span></span><br><span class="line"><span class="comment"> * \param key      SM4 key</span></span><br><span class="line"><span class="comment"> * \param flag     SM4_ENCRYPT or SM4_DECRYPT</span></span><br><span class="line"><span class="comment"> * \param length   length of the input data</span></span><br><span class="line"><span class="comment"> * \param iv       initialization vector (updated after use)</span></span><br><span class="line"><span class="comment"> * \param input    buffer holding the input data</span></span><br><span class="line"><span class="comment"> * \param output   buffer holding the output data</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sm4</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> key[<span class="number">16</span>],</span></span></span><br><span class="line"><span class="function"><span class="params">         <span class="keyword">int</span> mode,</span></span></span><br><span class="line"><span class="function"><span class="params">         <span class="keyword">int</span> flag,</span></span></span><br><span class="line"><span class="function"><span class="params">         <span class="keyword">int</span> length,</span></span></span><br><span class="line"><span class="function"><span class="params">         <span class="keyword">unsigned</span> <span class="keyword">char</span> iv[<span class="number">16</span>],</span></span></span><br><span class="line"><span class="function"><span class="params">         <span class="keyword">unsigned</span> <span class="keyword">char</span>* input,</span></span></span><br><span class="line"><span class="function"><span class="params">         <span class="keyword">unsigned</span> <span class="keyword">char</span>* output)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * \brief          SM4 parameter format hex</span></span><br><span class="line"><span class="comment"> * \param input    buffer holding the input data</span></span><br><span class="line"><span class="comment"> * \param output   buffer holding the output data</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">format_park_input</span><span class="params">(<span class="keyword">char</span>* input, <span class="keyword">unsigned</span> <span class="keyword">char</span>* output)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* sm4.h */</span></span></span><br></pre></td></tr></table></figure>

<p><strong>sm4_code.c</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*************************************************************************</span></span><br><span class="line"><span class="comment">       &gt; File Name: run_sm4.c</span></span><br><span class="line"><span class="comment">       &gt; Author:yangkefeng</span></span><br><span class="line"><span class="comment">       &gt; E-mail:muyidixin2006@126.com</span></span><br><span class="line"><span class="comment">       &gt; Created Time: Thu July 13 23:55:50 2018</span></span><br><span class="line"><span class="comment">************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sm4.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 32-bit integer manipulation macros (big endian)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> GET_ULONG_BE</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> GET_ULONG_BE(n, b, i)                                                 \</span></span><br><span class="line">  &#123;                                                                           \</span><br><span class="line">    (n) = ((<span class="keyword">unsigned</span> <span class="keyword">long</span>)(b)[(i)] &lt;&lt; <span class="number">24</span>) |                                   \</span><br><span class="line">          ((<span class="keyword">unsigned</span> <span class="keyword">long</span>)(b)[(i) + <span class="number">1</span>] &lt;&lt; <span class="number">16</span>) |                               \</span><br><span class="line">          ((<span class="keyword">unsigned</span> <span class="keyword">long</span>)(b)[(i) + <span class="number">2</span>] &lt;&lt; <span class="number">8</span>) | ((<span class="keyword">unsigned</span> <span class="keyword">long</span>)(b)[(i) + <span class="number">3</span>]); \</span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> PUT_ULONG_BE</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PUT_ULONG_BE(n, b, i)                  \</span></span><br><span class="line">  &#123;                                            \</span><br><span class="line">    (b)[(i)] = (<span class="keyword">unsigned</span> <span class="keyword">char</span>)((n) &gt;&gt; <span class="number">24</span>);     \</span><br><span class="line">    (b)[(i) + <span class="number">1</span>] = (<span class="keyword">unsigned</span> <span class="keyword">char</span>)((n) &gt;&gt; <span class="number">16</span>); \</span><br><span class="line">    (b)[(i) + <span class="number">2</span>] = (<span class="keyword">unsigned</span> <span class="keyword">char</span>)((n) &gt;&gt; <span class="number">8</span>);  \</span><br><span class="line">    (b)[(i) + <span class="number">3</span>] = (<span class="keyword">unsigned</span> <span class="keyword">char</span>)((n));       \</span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *rotate shift left marco definition</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SHL(x, n) (((x)&amp;0xFFFFFFFF) &lt;&lt; n)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ROTL(x, n) (SHL((x), n) | ((x) &gt;&gt; (32 - n)))</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SWAP(a, b)       \</span></span><br><span class="line">  &#123;                      \</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> t = a; \</span><br><span class="line">    a = b;               \</span><br><span class="line">    b = t;               \</span><br><span class="line">    t = <span class="number">0</span>;               \</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Expanded SM4 S-boxes</span></span><br><span class="line"><span class="comment"> /* Sbox table: 8bits input convert to 8 bits output*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> SboxTable[<span class="number">16</span>][<span class="number">16</span>] = &#123;</span><br><span class="line">    &#123;<span class="number">0xd6</span>, <span class="number">0x90</span>, <span class="number">0xe9</span>, <span class="number">0xfe</span>, <span class="number">0xcc</span>, <span class="number">0xe1</span>, <span class="number">0x3d</span>, <span class="number">0xb7</span>, <span class="number">0x16</span>, <span class="number">0xb6</span>, <span class="number">0x14</span>, <span class="number">0xc2</span>,</span><br><span class="line">     <span class="number">0x28</span>, <span class="number">0xfb</span>, <span class="number">0x2c</span>, <span class="number">0x05</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0x2b</span>, <span class="number">0x67</span>, <span class="number">0x9a</span>, <span class="number">0x76</span>, <span class="number">0x2a</span>, <span class="number">0xbe</span>, <span class="number">0x04</span>, <span class="number">0xc3</span>, <span class="number">0xaa</span>, <span class="number">0x44</span>, <span class="number">0x13</span>, <span class="number">0x26</span>,</span><br><span class="line">     <span class="number">0x49</span>, <span class="number">0x86</span>, <span class="number">0x06</span>, <span class="number">0x99</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0x9c</span>, <span class="number">0x42</span>, <span class="number">0x50</span>, <span class="number">0xf4</span>, <span class="number">0x91</span>, <span class="number">0xef</span>, <span class="number">0x98</span>, <span class="number">0x7a</span>, <span class="number">0x33</span>, <span class="number">0x54</span>, <span class="number">0x0b</span>, <span class="number">0x43</span>,</span><br><span class="line">     <span class="number">0xed</span>, <span class="number">0xcf</span>, <span class="number">0xac</span>, <span class="number">0x62</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0xe4</span>, <span class="number">0xb3</span>, <span class="number">0x1c</span>, <span class="number">0xa9</span>, <span class="number">0xc9</span>, <span class="number">0x08</span>, <span class="number">0xe8</span>, <span class="number">0x95</span>, <span class="number">0x80</span>, <span class="number">0xdf</span>, <span class="number">0x94</span>, <span class="number">0xfa</span>,</span><br><span class="line">     <span class="number">0x75</span>, <span class="number">0x8f</span>, <span class="number">0x3f</span>, <span class="number">0xa6</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0x47</span>, <span class="number">0x07</span>, <span class="number">0xa7</span>, <span class="number">0xfc</span>, <span class="number">0xf3</span>, <span class="number">0x73</span>, <span class="number">0x17</span>, <span class="number">0xba</span>, <span class="number">0x83</span>, <span class="number">0x59</span>, <span class="number">0x3c</span>, <span class="number">0x19</span>,</span><br><span class="line">     <span class="number">0xe6</span>, <span class="number">0x85</span>, <span class="number">0x4f</span>, <span class="number">0xa8</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0x68</span>, <span class="number">0x6b</span>, <span class="number">0x81</span>, <span class="number">0xb2</span>, <span class="number">0x71</span>, <span class="number">0x64</span>, <span class="number">0xda</span>, <span class="number">0x8b</span>, <span class="number">0xf8</span>, <span class="number">0xeb</span>, <span class="number">0x0f</span>, <span class="number">0x4b</span>,</span><br><span class="line">     <span class="number">0x70</span>, <span class="number">0x56</span>, <span class="number">0x9d</span>, <span class="number">0x35</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0x1e</span>, <span class="number">0x24</span>, <span class="number">0x0e</span>, <span class="number">0x5e</span>, <span class="number">0x63</span>, <span class="number">0x58</span>, <span class="number">0xd1</span>, <span class="number">0xa2</span>, <span class="number">0x25</span>, <span class="number">0x22</span>, <span class="number">0x7c</span>, <span class="number">0x3b</span>,</span><br><span class="line">     <span class="number">0x01</span>, <span class="number">0x21</span>, <span class="number">0x78</span>, <span class="number">0x87</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0xd4</span>, <span class="number">0x00</span>, <span class="number">0x46</span>, <span class="number">0x57</span>, <span class="number">0x9f</span>, <span class="number">0xd3</span>, <span class="number">0x27</span>, <span class="number">0x52</span>, <span class="number">0x4c</span>, <span class="number">0x36</span>, <span class="number">0x02</span>, <span class="number">0xe7</span>,</span><br><span class="line">     <span class="number">0xa0</span>, <span class="number">0xc4</span>, <span class="number">0xc8</span>, <span class="number">0x9e</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0xea</span>, <span class="number">0xbf</span>, <span class="number">0x8a</span>, <span class="number">0xd2</span>, <span class="number">0x40</span>, <span class="number">0xc7</span>, <span class="number">0x38</span>, <span class="number">0xb5</span>, <span class="number">0xa3</span>, <span class="number">0xf7</span>, <span class="number">0xf2</span>, <span class="number">0xce</span>,</span><br><span class="line">     <span class="number">0xf9</span>, <span class="number">0x61</span>, <span class="number">0x15</span>, <span class="number">0xa1</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0xe0</span>, <span class="number">0xae</span>, <span class="number">0x5d</span>, <span class="number">0xa4</span>, <span class="number">0x9b</span>, <span class="number">0x34</span>, <span class="number">0x1a</span>, <span class="number">0x55</span>, <span class="number">0xad</span>, <span class="number">0x93</span>, <span class="number">0x32</span>, <span class="number">0x30</span>,</span><br><span class="line">     <span class="number">0xf5</span>, <span class="number">0x8c</span>, <span class="number">0xb1</span>, <span class="number">0xe3</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0x1d</span>, <span class="number">0xf6</span>, <span class="number">0xe2</span>, <span class="number">0x2e</span>, <span class="number">0x82</span>, <span class="number">0x66</span>, <span class="number">0xca</span>, <span class="number">0x60</span>, <span class="number">0xc0</span>, <span class="number">0x29</span>, <span class="number">0x23</span>, <span class="number">0xab</span>,</span><br><span class="line">     <span class="number">0x0d</span>, <span class="number">0x53</span>, <span class="number">0x4e</span>, <span class="number">0x6f</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0xd5</span>, <span class="number">0xdb</span>, <span class="number">0x37</span>, <span class="number">0x45</span>, <span class="number">0xde</span>, <span class="number">0xfd</span>, <span class="number">0x8e</span>, <span class="number">0x2f</span>, <span class="number">0x03</span>, <span class="number">0xff</span>, <span class="number">0x6a</span>, <span class="number">0x72</span>,</span><br><span class="line">     <span class="number">0x6d</span>, <span class="number">0x6c</span>, <span class="number">0x5b</span>, <span class="number">0x51</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0x8d</span>, <span class="number">0x1b</span>, <span class="number">0xaf</span>, <span class="number">0x92</span>, <span class="number">0xbb</span>, <span class="number">0xdd</span>, <span class="number">0xbc</span>, <span class="number">0x7f</span>, <span class="number">0x11</span>, <span class="number">0xd9</span>, <span class="number">0x5c</span>, <span class="number">0x41</span>,</span><br><span class="line">     <span class="number">0x1f</span>, <span class="number">0x10</span>, <span class="number">0x5a</span>, <span class="number">0xd8</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0x0a</span>, <span class="number">0xc1</span>, <span class="number">0x31</span>, <span class="number">0x88</span>, <span class="number">0xa5</span>, <span class="number">0xcd</span>, <span class="number">0x7b</span>, <span class="number">0xbd</span>, <span class="number">0x2d</span>, <span class="number">0x74</span>, <span class="number">0xd0</span>, <span class="number">0x12</span>,</span><br><span class="line">     <span class="number">0xb8</span>, <span class="number">0xe5</span>, <span class="number">0xb4</span>, <span class="number">0xb0</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0x89</span>, <span class="number">0x69</span>, <span class="number">0x97</span>, <span class="number">0x4a</span>, <span class="number">0x0c</span>, <span class="number">0x96</span>, <span class="number">0x77</span>, <span class="number">0x7e</span>, <span class="number">0x65</span>, <span class="number">0xb9</span>, <span class="number">0xf1</span>, <span class="number">0x09</span>,</span><br><span class="line">     <span class="number">0xc5</span>, <span class="number">0x6e</span>, <span class="number">0xc6</span>, <span class="number">0x84</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0x18</span>, <span class="number">0xf0</span>, <span class="number">0x7d</span>, <span class="number">0xec</span>, <span class="number">0x3a</span>, <span class="number">0xdc</span>, <span class="number">0x4d</span>, <span class="number">0x20</span>, <span class="number">0x79</span>, <span class="number">0xee</span>, <span class="number">0x5f</span>, <span class="number">0x3e</span>,</span><br><span class="line">     <span class="number">0xd7</span>, <span class="number">0xcb</span>, <span class="number">0x39</span>, <span class="number">0x48</span>&#125;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* System parameter */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> FK[<span class="number">4</span>] = &#123;<span class="number">0xa3b1bac6</span>, <span class="number">0x56aa3350</span>, <span class="number">0x677d9197</span>,</span><br><span class="line">                                    <span class="number">0xb27022dc</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* fixed parameter */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> CK[<span class="number">32</span>] = &#123;</span><br><span class="line">    <span class="number">0x00070e15</span>, <span class="number">0x1c232a31</span>, <span class="number">0x383f464d</span>, <span class="number">0x545b6269</span>, <span class="number">0x70777e85</span>, <span class="number">0x8c939aa1</span>,</span><br><span class="line">    <span class="number">0xa8afb6bd</span>, <span class="number">0xc4cbd2d9</span>, <span class="number">0xe0e7eef5</span>, <span class="number">0xfc030a11</span>, <span class="number">0x181f262d</span>, <span class="number">0x343b4249</span>,</span><br><span class="line">    <span class="number">0x50575e65</span>, <span class="number">0x6c737a81</span>, <span class="number">0x888f969d</span>, <span class="number">0xa4abb2b9</span>, <span class="number">0xc0c7ced5</span>, <span class="number">0xdce3eaf1</span>,</span><br><span class="line">    <span class="number">0xf8ff060d</span>, <span class="number">0x141b2229</span>, <span class="number">0x30373e45</span>, <span class="number">0x4c535a61</span>, <span class="number">0x686f767d</span>, <span class="number">0x848b9299</span>,</span><br><span class="line">    <span class="number">0xa0a7aeb5</span>, <span class="number">0xbcc3cad1</span>, <span class="number">0xd8dfe6ed</span>, <span class="number">0xf4fb0209</span>, <span class="number">0x10171e25</span>, <span class="number">0x2c333a41</span>,</span><br><span class="line">    <span class="number">0x484f565d</span>, <span class="number">0x646b7279</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * private function:</span></span><br><span class="line"><span class="comment"> * look up in SboxTable and get the related value.</span></span><br><span class="line"><span class="comment"> * args:    [in] inch: 0x00~0xFF (8 bits unsigned value).</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> <span class="title">sm4Sbox</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> inch)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span>* pTable = (<span class="keyword">unsigned</span> <span class="keyword">char</span>*)SboxTable;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> retVal = (<span class="keyword">unsigned</span> <span class="keyword">char</span>)(pTable[inch]);</span><br><span class="line">  <span class="keyword">return</span> retVal;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * private F(Lt) function:</span></span><br><span class="line"><span class="comment"> * "T algorithm" == "L algorithm" + "t algorithm".</span></span><br><span class="line"><span class="comment"> * args:    [in] a: a is a 32 bits unsigned value;</span></span><br><span class="line"><span class="comment"> * return: c: c is calculated with line algorithm "L" and nonline algorithm "t"</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="title">sm4Lt</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">long</span> ka)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">long</span> bb = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">long</span> c = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> a[<span class="number">4</span>];</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> b[<span class="number">4</span>];</span><br><span class="line">  PUT_ULONG_BE(ka, a, <span class="number">0</span>)</span><br><span class="line">  b[<span class="number">0</span>] = sm4Sbox(a[<span class="number">0</span>]);</span><br><span class="line">  b[<span class="number">1</span>] = sm4Sbox(a[<span class="number">1</span>]);</span><br><span class="line">  b[<span class="number">2</span>] = sm4Sbox(a[<span class="number">2</span>]);</span><br><span class="line">  b[<span class="number">3</span>] = sm4Sbox(a[<span class="number">3</span>]);</span><br><span class="line">  GET_ULONG_BE(bb, b, <span class="number">0</span>)</span><br><span class="line">  c = bb ^ (ROTL(bb, <span class="number">2</span>)) ^ (ROTL(bb, <span class="number">10</span>)) ^ (ROTL(bb, <span class="number">18</span>)) ^ (ROTL(bb, <span class="number">24</span>));</span><br><span class="line">  <span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * private F function:</span></span><br><span class="line"><span class="comment"> * Calculating and getting encryption/decryption contents.</span></span><br><span class="line"><span class="comment"> * args:    [in] x0: original contents;</span></span><br><span class="line"><span class="comment"> * args:    [in] x1: original contents;</span></span><br><span class="line"><span class="comment"> * args:    [in] x2: original contents;</span></span><br><span class="line"><span class="comment"> * args:    [in] x3: original contents;</span></span><br><span class="line"><span class="comment"> * args:    [in] rk: encryption/decryption key;</span></span><br><span class="line"><span class="comment"> * return the contents of encryption/decryption contents.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="title">sm4F</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">long</span> x0,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">unsigned</span> <span class="keyword">long</span> x1,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">unsigned</span> <span class="keyword">long</span> x2,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">unsigned</span> <span class="keyword">long</span> x3,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">unsigned</span> <span class="keyword">long</span> rk)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (x0 ^ sm4Lt(x1 ^ x2 ^ x3 ^ rk));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* private function:</span></span><br><span class="line"><span class="comment"> * Calculating round encryption key.</span></span><br><span class="line"><span class="comment"> * args:    [in] a: a is a 32 bits unsigned value;</span></span><br><span class="line"><span class="comment"> * return: sk[i]: i&#123;0,1,2,3,...31&#125;.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="title">sm4CalciRK</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">long</span> ka)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">long</span> bb = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">long</span> rk = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> a[<span class="number">4</span>];</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> b[<span class="number">4</span>];</span><br><span class="line">  PUT_ULONG_BE(ka, a, <span class="number">0</span>)</span><br><span class="line">  b[<span class="number">0</span>] = sm4Sbox(a[<span class="number">0</span>]);</span><br><span class="line">  b[<span class="number">1</span>] = sm4Sbox(a[<span class="number">1</span>]);</span><br><span class="line">  b[<span class="number">2</span>] = sm4Sbox(a[<span class="number">2</span>]);</span><br><span class="line">  b[<span class="number">3</span>] = sm4Sbox(a[<span class="number">3</span>]);</span><br><span class="line">  GET_ULONG_BE(bb, b, <span class="number">0</span>)</span><br><span class="line">  rk = bb ^ (ROTL(bb, <span class="number">13</span>)) ^ (ROTL(bb, <span class="number">23</span>));</span><br><span class="line">  <span class="keyword">return</span> rk;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sm4_setkey</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">long</span> SK[<span class="number">32</span>], <span class="keyword">unsigned</span> <span class="keyword">char</span> key[<span class="number">16</span>])</span> </span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">long</span> MK[<span class="number">4</span>];</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">long</span> k[<span class="number">36</span>];</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">long</span> i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  GET_ULONG_BE(MK[<span class="number">0</span>], key, <span class="number">0</span>);</span><br><span class="line">  GET_ULONG_BE(MK[<span class="number">1</span>], key, <span class="number">4</span>);</span><br><span class="line">  GET_ULONG_BE(MK[<span class="number">2</span>], key, <span class="number">8</span>);</span><br><span class="line">  GET_ULONG_BE(MK[<span class="number">3</span>], key, <span class="number">12</span>);</span><br><span class="line">  k[<span class="number">0</span>] = MK[<span class="number">0</span>] ^ FK[<span class="number">0</span>];</span><br><span class="line">  k[<span class="number">1</span>] = MK[<span class="number">1</span>] ^ FK[<span class="number">1</span>];</span><br><span class="line">  k[<span class="number">2</span>] = MK[<span class="number">2</span>] ^ FK[<span class="number">2</span>];</span><br><span class="line">  k[<span class="number">3</span>] = MK[<span class="number">3</span>] ^ FK[<span class="number">3</span>];</span><br><span class="line">  <span class="keyword">for</span> (; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">    k[i + <span class="number">4</span>] = k[i] ^ (sm4CalciRK(k[i + <span class="number">1</span>] ^ k[i + <span class="number">2</span>] ^ k[i + <span class="number">3</span>] ^ CK[i]));</span><br><span class="line">    SK[i] = k[i + <span class="number">4</span>];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * SM4 standard one round processing</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sm4_one_round</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">long</span> sk[<span class="number">32</span>],</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">unsigned</span> <span class="keyword">char</span> input[<span class="number">16</span>],</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">unsigned</span> <span class="keyword">char</span> output[<span class="number">16</span>])</span> </span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">long</span> i = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">long</span> ulbuf[<span class="number">36</span>];</span><br><span class="line">  <span class="built_in">memset</span>(ulbuf, <span class="number">0</span>, <span class="keyword">sizeof</span>(ulbuf));</span><br><span class="line">  GET_ULONG_BE(ulbuf[<span class="number">0</span>], input, <span class="number">0</span>)</span><br><span class="line">  GET_ULONG_BE(ulbuf[<span class="number">1</span>], input, <span class="number">4</span>)</span><br><span class="line">  GET_ULONG_BE(ulbuf[<span class="number">2</span>], input, <span class="number">8</span>)</span><br><span class="line">  GET_ULONG_BE(ulbuf[<span class="number">3</span>], input, <span class="number">12</span>)</span><br><span class="line">  <span class="keyword">while</span> (i &lt; <span class="number">32</span>) &#123;</span><br><span class="line">    ulbuf[i + <span class="number">4</span>] =</span><br><span class="line">        sm4F(ulbuf[i], ulbuf[i + <span class="number">1</span>], ulbuf[i + <span class="number">2</span>], ulbuf[i + <span class="number">3</span>], sk[i]);</span><br><span class="line">    <span class="comment">// #ifdef _DEBUG</span></span><br><span class="line">    <span class="comment">//        	printf("rk(%02d) = 0x%08x,  X(%02d) = 0x%08x \n",i,sk[i], i,</span></span><br><span class="line">    <span class="comment">//        ulbuf[i+4] );</span></span><br><span class="line">    <span class="comment">// #endif</span></span><br><span class="line">    i++;</span><br><span class="line">  &#125;</span><br><span class="line">  PUT_ULONG_BE(ulbuf[<span class="number">35</span>], output, <span class="number">0</span>);</span><br><span class="line">  PUT_ULONG_BE(ulbuf[<span class="number">34</span>], output, <span class="number">4</span>);</span><br><span class="line">  PUT_ULONG_BE(ulbuf[<span class="number">33</span>], output, <span class="number">8</span>);</span><br><span class="line">  PUT_ULONG_BE(ulbuf[<span class="number">32</span>], output, <span class="number">12</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * SM4 key schedule (128-bit, encryption)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sm4_setkey_enc</span><span class="params">(sm4_context* ctx, <span class="keyword">unsigned</span> <span class="keyword">char</span> key[<span class="number">16</span>])</span> </span>&#123;</span><br><span class="line">  ctx-&gt;mode = SM4_ENCRYPT;</span><br><span class="line">  sm4_setkey(ctx-&gt;sk, key);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * SM4 key schedule (128-bit, decryption)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sm4_setkey_dec</span><span class="params">(sm4_context* ctx, <span class="keyword">unsigned</span> <span class="keyword">char</span> key[<span class="number">16</span>])</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i;</span><br><span class="line">  ctx-&gt;mode = SM4_DECRYPT;</span><br><span class="line">  sm4_setkey(ctx-&gt;sk, key);</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++) &#123;</span><br><span class="line">    SWAP(ctx-&gt;sk[i], ctx-&gt;sk[<span class="number">31</span> - i]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * SM4 key schedule (128-bit, decryption)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">is_hex</span><span class="params">(<span class="keyword">char</span>* input)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i, len, isHex = <span class="number">1</span>;</span><br><span class="line">  len = <span class="built_in">strlen</span>(input);</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i += <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">isxdigit</span>(input[i]) == <span class="number">0</span>) &#123;</span><br><span class="line">      isHex = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> isHex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * SM4 key schedule (128-bit, decryption)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">hex2ds</span><span class="params">(<span class="keyword">char</span>* s)</span>  <span class="comment">// 16进制转10进制</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i, m, temp = <span class="number">0</span>, n;</span><br><span class="line">  m = <span class="built_in">strlen</span>(s);  <span class="comment">//十六进制是按字符串传进来的，所以要获得他的长度</span></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (s[i] &gt;= <span class="string">'A'</span> &amp;&amp;</span><br><span class="line">        s[i] &lt;= <span class="string">'F'</span>)  <span class="comment">//十六进制还要判断他是不是在A-F或者a-f之间a=10。&#123;</span></span><br><span class="line">    &#123;</span><br><span class="line">      n = s[i] - <span class="string">'A'</span> + <span class="number">10</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (s[i] &gt;= <span class="string">'a'</span> &amp;&amp; s[i] &lt;= <span class="string">'f'</span>) &#123;</span><br><span class="line">      n = s[i] - <span class="string">'a'</span> + <span class="number">10</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      n = s[i] - <span class="string">'0'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    temp = temp * <span class="number">16</span> + n;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 2位为单位处理转换成ASCII后再输出为字符保存在output</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">char2hex</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span>* input, <span class="keyword">unsigned</span> <span class="keyword">char</span>* output, <span class="keyword">int</span> len)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> a[<span class="number">3</span>];</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> res;</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i += <span class="number">2</span>) &#123;</span><br><span class="line">    a[<span class="number">0</span>] = input[i];</span><br><span class="line">    a[<span class="number">1</span>] = input[i + <span class="number">1</span>];</span><br><span class="line">    a[<span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">    res = hex2ds(a);</span><br><span class="line">    output[i / <span class="number">2</span>] = res;</span><br><span class="line">  &#125;</span><br><span class="line">  output[len / <span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">format_park_input</span><span class="params">(<span class="keyword">char</span>* input, <span class="keyword">unsigned</span> <span class="keyword">char</span>* output)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line">  len = <span class="built_in">strlen</span>(input);</span><br><span class="line">  <span class="keyword">if</span> (len != <span class="number">32</span> || is_hex(input) == <span class="number">0</span>)  <span class="comment">//判断是否为双数位</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    char2hex(input, output, len);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * SM4-ECB block encryption/decryption</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sm4_crypt_ecb</span><span class="params">(sm4_context* ctx,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">int</span> flag,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">int</span> length,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">unsigned</span> <span class="keyword">char</span>* input,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">unsigned</span> <span class="keyword">char</span>* output)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">while</span> (length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    sm4_one_round(ctx-&gt;sk, input, output);</span><br><span class="line">    input += <span class="number">16</span>;</span><br><span class="line">    output += <span class="number">16</span>;</span><br><span class="line">    length -= <span class="number">16</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * SM4-CBC buffer encryption/decryption</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sm4_crypt_cbc</span><span class="params">(sm4_context* ctx,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">int</span> flag,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">int</span> length,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">unsigned</span> <span class="keyword">char</span> iv[<span class="number">16</span>],</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">unsigned</span> <span class="keyword">char</span>* input,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">unsigned</span> <span class="keyword">char</span>* output)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> temp[<span class="number">16</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (flag == SM4_ENCRYPT) &#123;</span><br><span class="line">    <span class="keyword">while</span> (length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">        output[i] = (<span class="keyword">unsigned</span> <span class="keyword">char</span>)(input[i] ^ iv[i]);</span><br><span class="line"></span><br><span class="line">      sm4_one_round(ctx-&gt;sk, output, output);</span><br><span class="line">      <span class="built_in">memcpy</span>(iv, output, <span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">      input += <span class="number">16</span>;</span><br><span class="line">      output += <span class="number">16</span>;</span><br><span class="line">      length -= <span class="number">16</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="comment">/* SM4_DECRYPT */</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> (length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="built_in">memcpy</span>(temp, input, <span class="number">16</span>);</span><br><span class="line">      sm4_one_round(ctx-&gt;sk, input, output);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">        output[i] = (<span class="keyword">unsigned</span> <span class="keyword">char</span>)(output[i] ^ iv[i]);</span><br><span class="line"></span><br><span class="line">      <span class="built_in">memcpy</span>(iv, temp, <span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">      input += <span class="number">16</span>;</span><br><span class="line">      output += <span class="number">16</span>;</span><br><span class="line">      length -= <span class="number">16</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * SM4 cfb mode</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sm4_crypt_cfb</span><span class="params">(sm4_context* ctx,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">int</span> flag,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">int</span> length,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">unsigned</span> <span class="keyword">char</span> iv[<span class="number">16</span>],</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">unsigned</span> <span class="keyword">char</span>* input,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">unsigned</span> <span class="keyword">char</span>* output)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> temp[<span class="number">16</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (flag == SM4_ENCRYPT) &#123;</span><br><span class="line">    <span class="keyword">while</span> (length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      sm4_one_round(ctx-&gt;sk, iv, temp);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">        output[i] = (<span class="keyword">unsigned</span> <span class="keyword">char</span>)(temp[i] ^ input[i]);</span><br><span class="line">      <span class="built_in">memcpy</span>(iv, output, <span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">      input += <span class="number">16</span>;</span><br><span class="line">      output += <span class="number">16</span>;</span><br><span class="line">      length -= <span class="number">16</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="comment">/* SM4_DECRYPT */</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> (length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      sm4_one_round(ctx-&gt;sk, iv, temp);</span><br><span class="line">      <span class="built_in">memcpy</span>(iv, input, <span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">        output[i] = (<span class="keyword">unsigned</span> <span class="keyword">char</span>)(temp[i] ^ input[i]);</span><br><span class="line"></span><br><span class="line">      input += <span class="number">16</span>;</span><br><span class="line">      output += <span class="number">16</span>;</span><br><span class="line">      length -= <span class="number">16</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * SM4 ofb mode</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sm4_crypt_ofb</span><span class="params">(sm4_context* ctx,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">int</span> flag,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">int</span> length,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">unsigned</span> <span class="keyword">char</span> iv[<span class="number">16</span>],</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">unsigned</span> <span class="keyword">char</span>* input,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">unsigned</span> <span class="keyword">char</span>* output)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> temp[<span class="number">16</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (flag == SM4_ENCRYPT) &#123;</span><br><span class="line">    <span class="keyword">while</span> (length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      sm4_one_round(ctx-&gt;sk, iv, temp);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">        output[i] = (<span class="keyword">unsigned</span> <span class="keyword">char</span>)(temp[i] ^ input[i]);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++) &#123;</span><br><span class="line">        iv[i]++;</span><br><span class="line">        <span class="keyword">if</span> (iv[i] != <span class="number">0</span>)</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      input += <span class="number">16</span>;</span><br><span class="line">      output += <span class="number">16</span>;</span><br><span class="line">      length -= <span class="number">16</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="comment">/* SM4_DECRYPT */</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> (length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      sm4_one_round(ctx-&gt;sk, iv, temp);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">        output[i] = (<span class="keyword">unsigned</span> <span class="keyword">char</span>)(temp[i] ^ input[i]);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++) &#123;</span><br><span class="line">        iv[i]++;</span><br><span class="line">        <span class="keyword">if</span> (iv[i] != <span class="number">0</span>)</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      input += <span class="number">16</span>;</span><br><span class="line">      output += <span class="number">16</span>;</span><br><span class="line">      length -= <span class="number">16</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * SM4 ctr mode</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sm4_crypt_ctr</span><span class="params">(sm4_context* ctx,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">int</span> flag,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">int</span> length,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">unsigned</span> <span class="keyword">char</span> iv[<span class="number">16</span>],</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">unsigned</span> <span class="keyword">char</span>* input,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">unsigned</span> <span class="keyword">char</span>* output)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> temp[<span class="number">16</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (flag == SM4_ENCRYPT) &#123;</span><br><span class="line">    <span class="keyword">while</span> (length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">        output[i] = (<span class="keyword">unsigned</span> <span class="keyword">char</span>)(input[i] ^ iv[i]);</span><br><span class="line"></span><br><span class="line">      sm4_one_round(ctx-&gt;sk, output, output);</span><br><span class="line">      <span class="built_in">memcpy</span>(iv, output, <span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">      input += <span class="number">16</span>;</span><br><span class="line">      output += <span class="number">16</span>;</span><br><span class="line">      length -= <span class="number">16</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="comment">/* SM4_DECRYPT */</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> (length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="built_in">memcpy</span>(temp, input, <span class="number">16</span>);</span><br><span class="line">      sm4_one_round(ctx-&gt;sk, input, output);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">        output[i] = (<span class="keyword">unsigned</span> <span class="keyword">char</span>)(output[i] ^ iv[i]);</span><br><span class="line"></span><br><span class="line">      <span class="built_in">memcpy</span>(iv, temp, <span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">      input += <span class="number">16</span>;</span><br><span class="line">      output += <span class="number">16</span>;</span><br><span class="line">      length -= <span class="number">16</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sm4</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> key[<span class="number">16</span>],</span></span></span><br><span class="line"><span class="function"><span class="params">         <span class="keyword">int</span> mode,</span></span></span><br><span class="line"><span class="function"><span class="params">         <span class="keyword">int</span> flag,</span></span></span><br><span class="line"><span class="function"><span class="params">         <span class="keyword">int</span> length,</span></span></span><br><span class="line"><span class="function"><span class="params">         <span class="keyword">unsigned</span> <span class="keyword">char</span> iv[<span class="number">16</span>],</span></span></span><br><span class="line"><span class="function"><span class="params">         <span class="keyword">unsigned</span> <span class="keyword">char</span>* input,</span></span></span><br><span class="line"><span class="function"><span class="params">         <span class="keyword">unsigned</span> <span class="keyword">char</span>* output)</span> </span>&#123;</span><br><span class="line">  sm4_context ctx;</span><br><span class="line">  <span class="keyword">if</span> (flag == SM4_ENCRYPT) &#123;</span><br><span class="line">    sm4_setkey_enc(&amp;ctx, key);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    sm4_setkey_dec(&amp;ctx, key);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">switch</span> (mode) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">      sm4_crypt_ecb(&amp;ctx, flag, length, input, output);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">      sm4_crypt_cbc(&amp;ctx, flag, length, iv, input, output);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">      sm4_crypt_cfb(&amp;ctx, flag, length, iv, input, output);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">      sm4_crypt_ofb(&amp;ctx, flag, length, iv, input, output);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">      sm4_crypt_ctr(&amp;ctx, flag, length, iv, input, output);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      sm4_crypt_ecb(&amp;ctx, flag, length, input, output);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="BlowFish"><a href="#BlowFish" class="headerlink" title="BlowFish"></a>BlowFish</h3><h4 id="关于BlowFish算法"><a href="#关于BlowFish算法" class="headerlink" title="关于BlowFish算法"></a>关于BlowFish算法</h4><blockquote>
<p>BlowFish是一个具有64位块大小和可变密钥长度（32位到448位）的分组密码算法。它是一个16轮Feistel密码，使用大型密钥相关的S盒。</p>
</blockquote>
<h4 id="算法原理-4"><a href="#算法原理-4" class="headerlink" title="算法原理"></a>算法原理</h4><h5 id="子密钥生成-2"><a href="#子密钥生成-2" class="headerlink" title="子密钥生成"></a>子密钥生成</h5><p>子密钥生成使用了由18个32位字组成的<strong>P数组</strong></p>
<p>4个8*32的包含1024个32位字的S-box</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">uint32_t</span> P[<span class="number">18</span>];</span><br><span class="line"><span class="keyword">uint32_t</span> S[<span class="number">4</span>][<span class="number">256</span>];</span><br></pre></td></tr></table></figure>

<p><strong>步骤：</strong></p>
<p>1.按顺序使用常数Π的小数部分初始化P数组和S-box</p>
<p>2.对P数组和密钥进行逐位异或，必要时重用密钥</p>
<p>3.使用当前的P数组和S-box对全0的64位分组使用BlowFish算法进行加密，用输出代替P[1]、P[2]</p>
<p>4.重复以上步骤使用当前的P数组和S-box对上一步输出进行加密，并用输出代替P[3]、P[4]，直到按顺序替代所有的P数组和S-box中的元素为止</p>
<h5 id="加密"><a href="#加密" class="headerlink" title="加密"></a>加密</h5><p>f函数输入是一个32位双字，共4个字节，分别作为4个S-box的索引，取出相应的S-box的值然后进行模2^32加运算</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">F(x) &#x3D; F(a, b, c, d) &#x3D; ((S1[a] + S2[b]) ^ S3[c]) + S4[d]</span><br><span class="line">&#x2F;&#x2F; x &#x3D; a &lt;&lt; 24 + b &lt;&lt; 16 + c &lt;&lt; 8 + d</span><br></pre></td></tr></table></figure>

<p>加密是由16轮的Feistel网络组成</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">encrypt</span> <span class="params">(<span class="keyword">uint32_t</span> &amp; L, <span class="keyword">uint32_t</span> &amp; R)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span> ; i&lt;<span class="number">16</span> ; i += <span class="number">2</span>) &#123;</span><br><span class="line">      L ^= P[i];</span><br><span class="line">      R ^= f(L);</span><br><span class="line">      R ^= P[i+<span class="number">1</span>];</span><br><span class="line">      L ^= f(R);</span><br><span class="line">   &#125;</span><br><span class="line">   L ^= P[<span class="number">16</span>];</span><br><span class="line">   R ^= P[<span class="number">17</span>];</span><br><span class="line">   swap (L, R);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="解密-1"><a href="#解密-1" class="headerlink" title="解密"></a>解密</h5><p>解密方法与加密方法相同，只是P数组要逆序使用</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">decrypt</span> <span class="params">(<span class="keyword">uint32_t</span> &amp; L, <span class="keyword">uint32_t</span> &amp; R)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">16</span> ; i &gt; <span class="number">0</span> ; i -= <span class="number">2</span>) &#123;</span><br><span class="line">      L ^= P[i+<span class="number">1</span>];</span><br><span class="line">      R ^= f(L);</span><br><span class="line">      R ^= P[i];</span><br><span class="line">      L ^= f(R);</span><br><span class="line">   &#125;</span><br><span class="line">   L ^= P[<span class="number">1</span>];</span><br><span class="line">   R ^= P[<span class="number">0</span>];</span><br><span class="line">   swap (L, R);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="加解密实现-3"><a href="#加解密实现-3" class="headerlink" title="加解密实现"></a>加解密实现</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create by feng on August 1, 2019</span></span><br><span class="line"><span class="comment">// This is a simple encryption and decryption program for Blowfish </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="comment">// P array</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> P[<span class="number">18</span>] = &#123;<span class="number">0x243F6A88</span>L, <span class="number">0x85A308D3</span>L, <span class="number">0x13198A2E</span>L, <span class="number">0x03707344</span>L,</span><br><span class="line">                      <span class="number">0xA4093822</span>L, <span class="number">0x299F31D0</span>L, <span class="number">0x082EFA98</span>L, <span class="number">0xEC4E6C89</span>L,</span><br><span class="line">                      <span class="number">0x452821E6</span>L, <span class="number">0x38D01377</span>L, <span class="number">0xBE5466CF</span>L, <span class="number">0x34E90C6C</span>L,</span><br><span class="line">                      <span class="number">0xC0AC29B7</span>L, <span class="number">0xC97C50DD</span>L, <span class="number">0x3F84D5B5</span>L, <span class="number">0xB5470917</span>L,</span><br><span class="line">                      <span class="number">0x9216D5D9</span>L, <span class="number">0x8979FB1B</span>L&#125;;</span><br><span class="line"><span class="comment">// S-box</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> S[<span class="number">4</span>][<span class="number">256</span>] = &#123;</span><br><span class="line">    &#123;<span class="number">0xD1310BA6</span>L, <span class="number">0x98DFB5AC</span>L, <span class="number">0x2FFD72DB</span>L, <span class="number">0xD01ADFB7</span>L, <span class="number">0xB8E1AFED</span>L,</span><br><span class="line">     <span class="number">0x6A267E96</span>L, <span class="number">0xBA7C9045</span>L, <span class="number">0xF12C7F99</span>L, <span class="number">0x24A19947</span>L, <span class="number">0xB3916CF7</span>L,</span><br><span class="line">     <span class="number">0x0801F2E2</span>L, <span class="number">0x858EFC16</span>L, <span class="number">0x636920D8</span>L, <span class="number">0x71574E69</span>L, <span class="number">0xA458FEA3</span>L,</span><br><span class="line">     <span class="number">0xF4933D7E</span>L, <span class="number">0x0D95748F</span>L, <span class="number">0x728EB658</span>L, <span class="number">0x718BCD58</span>L, <span class="number">0x82154AEE</span>L,</span><br><span class="line">     <span class="number">0x7B54A41D</span>L, <span class="number">0xC25A59B5</span>L, <span class="number">0x9C30D539</span>L, <span class="number">0x2AF26013</span>L, <span class="number">0xC5D1B023</span>L,</span><br><span class="line">     <span class="number">0x286085F0</span>L, <span class="number">0xCA417918</span>L, <span class="number">0xB8DB38EF</span>L, <span class="number">0x8E79DCB0</span>L, <span class="number">0x603A180E</span>L,</span><br><span class="line">     <span class="number">0x6C9E0E8B</span>L, <span class="number">0xB01E8A3E</span>L, <span class="number">0xD71577C1</span>L, <span class="number">0xBD314B27</span>L, <span class="number">0x78AF2FDA</span>L,</span><br><span class="line">     <span class="number">0x55605C60</span>L, <span class="number">0xE65525F3</span>L, <span class="number">0xAA55AB94</span>L, <span class="number">0x57489862</span>L, <span class="number">0x63E81440</span>L,</span><br><span class="line">     <span class="number">0x55CA396A</span>L, <span class="number">0x2AAB10B6</span>L, <span class="number">0xB4CC5C34</span>L, <span class="number">0x1141E8CE</span>L, <span class="number">0xA15486AF</span>L,</span><br><span class="line">     <span class="number">0x7C72E993</span>L, <span class="number">0xB3EE1411</span>L, <span class="number">0x636FBC2A</span>L, <span class="number">0x2BA9C55D</span>L, <span class="number">0x741831F6</span>L,</span><br><span class="line">     <span class="number">0xCE5C3E16</span>L, <span class="number">0x9B87931E</span>L, <span class="number">0xAFD6BA33</span>L, <span class="number">0x6C24CF5C</span>L, <span class="number">0x7A325381</span>L,</span><br><span class="line">     <span class="number">0x28958677</span>L, <span class="number">0x3B8F4898</span>L, <span class="number">0x6B4BB9AF</span>L, <span class="number">0xC4BFE81B</span>L, <span class="number">0x66282193</span>L,</span><br><span class="line">     <span class="number">0x61D809CC</span>L, <span class="number">0xFB21A991</span>L, <span class="number">0x487CAC60</span>L, <span class="number">0x5DEC8032</span>L, <span class="number">0xEF845D5D</span>L,</span><br><span class="line">     <span class="number">0xE98575B1</span>L, <span class="number">0xDC262302</span>L, <span class="number">0xEB651B88</span>L, <span class="number">0x23893E81</span>L, <span class="number">0xD396ACC5</span>L,</span><br><span class="line">     <span class="number">0x0F6D6FF3</span>L, <span class="number">0x83F44239</span>L, <span class="number">0x2E0B4482</span>L, <span class="number">0xA4842004</span>L, <span class="number">0x69C8F04A</span>L,</span><br><span class="line">     <span class="number">0x9E1F9B5E</span>L, <span class="number">0x21C66842</span>L, <span class="number">0xF6E96C9A</span>L, <span class="number">0x670C9C61</span>L, <span class="number">0xABD388F0</span>L,</span><br><span class="line">     <span class="number">0x6A51A0D2</span>L, <span class="number">0xD8542F68</span>L, <span class="number">0x960FA728</span>L, <span class="number">0xAB5133A3</span>L, <span class="number">0x6EEF0B6C</span>L,</span><br><span class="line">     <span class="number">0x137A3BE4</span>L, <span class="number">0xBA3BF050</span>L, <span class="number">0x7EFB2A98</span>L, <span class="number">0xA1F1651D</span>L, <span class="number">0x39AF0176</span>L,</span><br><span class="line">     <span class="number">0x66CA593E</span>L, <span class="number">0x82430E88</span>L, <span class="number">0x8CEE8619</span>L, <span class="number">0x456F9FB4</span>L, <span class="number">0x7D84A5C3</span>L,</span><br><span class="line">     <span class="number">0x3B8B5EBE</span>L, <span class="number">0xE06F75D8</span>L, <span class="number">0x85C12073</span>L, <span class="number">0x401A449F</span>L, <span class="number">0x56C16AA6</span>L,</span><br><span class="line">     <span class="number">0x4ED3AA62</span>L, <span class="number">0x363F7706</span>L, <span class="number">0x1BFEDF72</span>L, <span class="number">0x429B023D</span>L, <span class="number">0x37D0D724</span>L,</span><br><span class="line">     <span class="number">0xD00A1248</span>L, <span class="number">0xDB0FEAD3</span>L, <span class="number">0x49F1C09B</span>L, <span class="number">0x075372C9</span>L, <span class="number">0x80991B7B</span>L,</span><br><span class="line">     <span class="number">0x25D479D8</span>L, <span class="number">0xF6E8DEF7</span>L, <span class="number">0xE3FE501A</span>L, <span class="number">0xB6794C3B</span>L, <span class="number">0x976CE0BD</span>L,</span><br><span class="line">     <span class="number">0x04C006BA</span>L, <span class="number">0xC1A94FB6</span>L, <span class="number">0x409F60C4</span>L, <span class="number">0x5E5C9EC2</span>L, <span class="number">0x196A2463</span>L,</span><br><span class="line">     <span class="number">0x68FB6FAF</span>L, <span class="number">0x3E6C53B5</span>L, <span class="number">0x1339B2EB</span>L, <span class="number">0x3B52EC6F</span>L, <span class="number">0x6DFC511F</span>L,</span><br><span class="line">     <span class="number">0x9B30952C</span>L, <span class="number">0xCC814544</span>L, <span class="number">0xAF5EBD09</span>L, <span class="number">0xBEE3D004</span>L, <span class="number">0xDE334AFD</span>L,</span><br><span class="line">     <span class="number">0x660F2807</span>L, <span class="number">0x192E4BB3</span>L, <span class="number">0xC0CBA857</span>L, <span class="number">0x45C8740F</span>L, <span class="number">0xD20B5F39</span>L,</span><br><span class="line">     <span class="number">0xB9D3FBDB</span>L, <span class="number">0x5579C0BD</span>L, <span class="number">0x1A60320A</span>L, <span class="number">0xD6A100C6</span>L, <span class="number">0x402C7279</span>L,</span><br><span class="line">     <span class="number">0x679F25FE</span>L, <span class="number">0xFB1FA3CC</span>L, <span class="number">0x8EA5E9F8</span>L, <span class="number">0xDB3222F8</span>L, <span class="number">0x3C7516DF</span>L,</span><br><span class="line">     <span class="number">0xFD616B15</span>L, <span class="number">0x2F501EC8</span>L, <span class="number">0xAD0552AB</span>L, <span class="number">0x323DB5FA</span>L, <span class="number">0xFD238760</span>L,</span><br><span class="line">     <span class="number">0x53317B48</span>L, <span class="number">0x3E00DF82</span>L, <span class="number">0x9E5C57BB</span>L, <span class="number">0xCA6F8CA0</span>L, <span class="number">0x1A87562E</span>L,</span><br><span class="line">     <span class="number">0xDF1769DB</span>L, <span class="number">0xD542A8F6</span>L, <span class="number">0x287EFFC3</span>L, <span class="number">0xAC6732C6</span>L, <span class="number">0x8C4F5573</span>L,</span><br><span class="line">     <span class="number">0x695B27B0</span>L, <span class="number">0xBBCA58C8</span>L, <span class="number">0xE1FFA35D</span>L, <span class="number">0xB8F011A0</span>L, <span class="number">0x10FA3D98</span>L,</span><br><span class="line">     <span class="number">0xFD2183B8</span>L, <span class="number">0x4AFCB56C</span>L, <span class="number">0x2DD1D35B</span>L, <span class="number">0x9A53E479</span>L, <span class="number">0xB6F84565</span>L,</span><br><span class="line">     <span class="number">0xD28E49BC</span>L, <span class="number">0x4BFB9790</span>L, <span class="number">0xE1DDF2DA</span>L, <span class="number">0xA4CB7E33</span>L, <span class="number">0x62FB1341</span>L,</span><br><span class="line">     <span class="number">0xCEE4C6E8</span>L, <span class="number">0xEF20CADA</span>L, <span class="number">0x36774C01</span>L, <span class="number">0xD07E9EFE</span>L, <span class="number">0x2BF11FB4</span>L,</span><br><span class="line">     <span class="number">0x95DBDA4D</span>L, <span class="number">0xAE909198</span>L, <span class="number">0xEAAD8E71</span>L, <span class="number">0x6B93D5A0</span>L, <span class="number">0xD08ED1D0</span>L,</span><br><span class="line">     <span class="number">0xAFC725E0</span>L, <span class="number">0x8E3C5B2F</span>L, <span class="number">0x8E7594B7</span>L, <span class="number">0x8FF6E2FB</span>L, <span class="number">0xF2122B64</span>L,</span><br><span class="line">     <span class="number">0x8888B812</span>L, <span class="number">0x900DF01C</span>L, <span class="number">0x4FAD5EA0</span>L, <span class="number">0x688FC31C</span>L, <span class="number">0xD1CFF191</span>L,</span><br><span class="line">     <span class="number">0xB3A8C1AD</span>L, <span class="number">0x2F2F2218</span>L, <span class="number">0xBE0E1777</span>L, <span class="number">0xEA752DFE</span>L, <span class="number">0x8B021FA1</span>L,</span><br><span class="line">     <span class="number">0xE5A0CC0F</span>L, <span class="number">0xB56F74E8</span>L, <span class="number">0x18ACF3D6</span>L, <span class="number">0xCE89E299</span>L, <span class="number">0xB4A84FE0</span>L,</span><br><span class="line">     <span class="number">0xFD13E0B7</span>L, <span class="number">0x7CC43B81</span>L, <span class="number">0xD2ADA8D9</span>L, <span class="number">0x165FA266</span>L, <span class="number">0x80957705</span>L,</span><br><span class="line">     <span class="number">0x93CC7314</span>L, <span class="number">0x211A1477</span>L, <span class="number">0xE6AD2065</span>L, <span class="number">0x77B5FA86</span>L, <span class="number">0xC75442F5</span>L,</span><br><span class="line">     <span class="number">0xFB9D35CF</span>L, <span class="number">0xEBCDAF0C</span>L, <span class="number">0x7B3E89A0</span>L, <span class="number">0xD6411BD3</span>L, <span class="number">0xAE1E7E49</span>L,</span><br><span class="line">     <span class="number">0x00250E2D</span>L, <span class="number">0x2071B35E</span>L, <span class="number">0x226800BB</span>L, <span class="number">0x57B8E0AF</span>L, <span class="number">0x2464369B</span>L,</span><br><span class="line">     <span class="number">0xF009B91E</span>L, <span class="number">0x5563911D</span>L, <span class="number">0x59DFA6AA</span>L, <span class="number">0x78C14389</span>L, <span class="number">0xD95A537F</span>L,</span><br><span class="line">     <span class="number">0x207D5BA2</span>L, <span class="number">0x02E5B9C5</span>L, <span class="number">0x83260376</span>L, <span class="number">0x6295CFA9</span>L, <span class="number">0x11C81968</span>L,</span><br><span class="line">     <span class="number">0x4E734A41</span>L, <span class="number">0xB3472DCA</span>L, <span class="number">0x7B14A94A</span>L, <span class="number">0x1B510052</span>L, <span class="number">0x9A532915</span>L,</span><br><span class="line">     <span class="number">0xD60F573F</span>L, <span class="number">0xBC9BC6E4</span>L, <span class="number">0x2B60A476</span>L, <span class="number">0x81E67400</span>L, <span class="number">0x08BA6FB5</span>L,</span><br><span class="line">     <span class="number">0x571BE91F</span>L, <span class="number">0xF296EC6B</span>L, <span class="number">0x2A0DD915</span>L, <span class="number">0xB6636521</span>L, <span class="number">0xE7B9F9B6</span>L,</span><br><span class="line">     <span class="number">0xFF34052E</span>L, <span class="number">0xC5855664</span>L, <span class="number">0x53B02D5D</span>L, <span class="number">0xA99F8FA1</span>L, <span class="number">0x08BA4799</span>L,</span><br><span class="line">     <span class="number">0x6E85076A</span>L&#125;,</span><br><span class="line">    &#123;<span class="number">0x4B7A70E9</span>L, <span class="number">0xB5B32944</span>L, <span class="number">0xDB75092E</span>L, <span class="number">0xC4192623</span>L, <span class="number">0xAD6EA6B0</span>L,</span><br><span class="line">     <span class="number">0x49A7DF7D</span>L, <span class="number">0x9CEE60B8</span>L, <span class="number">0x8FEDB266</span>L, <span class="number">0xECAA8C71</span>L, <span class="number">0x699A17FF</span>L,</span><br><span class="line">     <span class="number">0x5664526C</span>L, <span class="number">0xC2B19EE1</span>L, <span class="number">0x193602A5</span>L, <span class="number">0x75094C29</span>L, <span class="number">0xA0591340</span>L,</span><br><span class="line">     <span class="number">0xE4183A3E</span>L, <span class="number">0x3F54989A</span>L, <span class="number">0x5B429D65</span>L, <span class="number">0x6B8FE4D6</span>L, <span class="number">0x99F73FD6</span>L,</span><br><span class="line">     <span class="number">0xA1D29C07</span>L, <span class="number">0xEFE830F5</span>L, <span class="number">0x4D2D38E6</span>L, <span class="number">0xF0255DC1</span>L, <span class="number">0x4CDD2086</span>L,</span><br><span class="line">     <span class="number">0x8470EB26</span>L, <span class="number">0x6382E9C6</span>L, <span class="number">0x021ECC5E</span>L, <span class="number">0x09686B3F</span>L, <span class="number">0x3EBAEFC9</span>L,</span><br><span class="line">     <span class="number">0x3C971814</span>L, <span class="number">0x6B6A70A1</span>L, <span class="number">0x687F3584</span>L, <span class="number">0x52A0E286</span>L, <span class="number">0xB79C5305</span>L,</span><br><span class="line">     <span class="number">0xAA500737</span>L, <span class="number">0x3E07841C</span>L, <span class="number">0x7FDEAE5C</span>L, <span class="number">0x8E7D44EC</span>L, <span class="number">0x5716F2B8</span>L,</span><br><span class="line">     <span class="number">0xB03ADA37</span>L, <span class="number">0xF0500C0D</span>L, <span class="number">0xF01C1F04</span>L, <span class="number">0x0200B3FF</span>L, <span class="number">0xAE0CF51A</span>L,</span><br><span class="line">     <span class="number">0x3CB574B2</span>L, <span class="number">0x25837A58</span>L, <span class="number">0xDC0921BD</span>L, <span class="number">0xD19113F9</span>L, <span class="number">0x7CA92FF6</span>L,</span><br><span class="line">     <span class="number">0x94324773</span>L, <span class="number">0x22F54701</span>L, <span class="number">0x3AE5E581</span>L, <span class="number">0x37C2DADC</span>L, <span class="number">0xC8B57634</span>L,</span><br><span class="line">     <span class="number">0x9AF3DDA7</span>L, <span class="number">0xA9446146</span>L, <span class="number">0x0FD0030E</span>L, <span class="number">0xECC8C73E</span>L, <span class="number">0xA4751E41</span>L,</span><br><span class="line">     <span class="number">0xE238CD99</span>L, <span class="number">0x3BEA0E2F</span>L, <span class="number">0x3280BBA1</span>L, <span class="number">0x183EB331</span>L, <span class="number">0x4E548B38</span>L,</span><br><span class="line">     <span class="number">0x4F6DB908</span>L, <span class="number">0x6F420D03</span>L, <span class="number">0xF60A04BF</span>L, <span class="number">0x2CB81290</span>L, <span class="number">0x24977C79</span>L,</span><br><span class="line">     <span class="number">0x5679B072</span>L, <span class="number">0xBCAF89AF</span>L, <span class="number">0xDE9A771F</span>L, <span class="number">0xD9930810</span>L, <span class="number">0xB38BAE12</span>L,</span><br><span class="line">     <span class="number">0xDCCF3F2E</span>L, <span class="number">0x5512721F</span>L, <span class="number">0x2E6B7124</span>L, <span class="number">0x501ADDE6</span>L, <span class="number">0x9F84CD87</span>L,</span><br><span class="line">     <span class="number">0x7A584718</span>L, <span class="number">0x7408DA17</span>L, <span class="number">0xBC9F9ABC</span>L, <span class="number">0xE94B7D8C</span>L, <span class="number">0xEC7AEC3A</span>L,</span><br><span class="line">     <span class="number">0xDB851DFA</span>L, <span class="number">0x63094366</span>L, <span class="number">0xC464C3D2</span>L, <span class="number">0xEF1C1847</span>L, <span class="number">0x3215D908</span>L,</span><br><span class="line">     <span class="number">0xDD433B37</span>L, <span class="number">0x24C2BA16</span>L, <span class="number">0x12A14D43</span>L, <span class="number">0x2A65C451</span>L, <span class="number">0x50940002</span>L,</span><br><span class="line">     <span class="number">0x133AE4DD</span>L, <span class="number">0x71DFF89E</span>L, <span class="number">0x10314E55</span>L, <span class="number">0x81AC77D6</span>L, <span class="number">0x5F11199B</span>L,</span><br><span class="line">     <span class="number">0x043556F1</span>L, <span class="number">0xD7A3C76B</span>L, <span class="number">0x3C11183B</span>L, <span class="number">0x5924A509</span>L, <span class="number">0xF28FE6ED</span>L,</span><br><span class="line">     <span class="number">0x97F1FBFA</span>L, <span class="number">0x9EBABF2C</span>L, <span class="number">0x1E153C6E</span>L, <span class="number">0x86E34570</span>L, <span class="number">0xEAE96FB1</span>L,</span><br><span class="line">     <span class="number">0x860E5E0A</span>L, <span class="number">0x5A3E2AB3</span>L, <span class="number">0x771FE71C</span>L, <span class="number">0x4E3D06FA</span>L, <span class="number">0x2965DCB9</span>L,</span><br><span class="line">     <span class="number">0x99E71D0F</span>L, <span class="number">0x803E89D6</span>L, <span class="number">0x5266C825</span>L, <span class="number">0x2E4CC978</span>L, <span class="number">0x9C10B36A</span>L,</span><br><span class="line">     <span class="number">0xC6150EBA</span>L, <span class="number">0x94E2EA78</span>L, <span class="number">0xA5FC3C53</span>L, <span class="number">0x1E0A2DF4</span>L, <span class="number">0xF2F74EA7</span>L,</span><br><span class="line">     <span class="number">0x361D2B3D</span>L, <span class="number">0x1939260F</span>L, <span class="number">0x19C27960</span>L, <span class="number">0x5223A708</span>L, <span class="number">0xF71312B6</span>L,</span><br><span class="line">     <span class="number">0xEBADFE6E</span>L, <span class="number">0xEAC31F66</span>L, <span class="number">0xE3BC4595</span>L, <span class="number">0xA67BC883</span>L, <span class="number">0xB17F37D1</span>L,</span><br><span class="line">     <span class="number">0x018CFF28</span>L, <span class="number">0xC332DDEF</span>L, <span class="number">0xBE6C5AA5</span>L, <span class="number">0x65582185</span>L, <span class="number">0x68AB9802</span>L,</span><br><span class="line">     <span class="number">0xEECEA50F</span>L, <span class="number">0xDB2F953B</span>L, <span class="number">0x2AEF7DAD</span>L, <span class="number">0x5B6E2F84</span>L, <span class="number">0x1521B628</span>L,</span><br><span class="line">     <span class="number">0x29076170</span>L, <span class="number">0xECDD4775</span>L, <span class="number">0x619F1510</span>L, <span class="number">0x13CCA830</span>L, <span class="number">0xEB61BD96</span>L,</span><br><span class="line">     <span class="number">0x0334FE1E</span>L, <span class="number">0xAA0363CF</span>L, <span class="number">0xB5735C90</span>L, <span class="number">0x4C70A239</span>L, <span class="number">0xD59E9E0B</span>L,</span><br><span class="line">     <span class="number">0xCBAADE14</span>L, <span class="number">0xEECC86BC</span>L, <span class="number">0x60622CA7</span>L, <span class="number">0x9CAB5CAB</span>L, <span class="number">0xB2F3846E</span>L,</span><br><span class="line">     <span class="number">0x648B1EAF</span>L, <span class="number">0x19BDF0CA</span>L, <span class="number">0xA02369B9</span>L, <span class="number">0x655ABB50</span>L, <span class="number">0x40685A32</span>L,</span><br><span class="line">     <span class="number">0x3C2AB4B3</span>L, <span class="number">0x319EE9D5</span>L, <span class="number">0xC021B8F7</span>L, <span class="number">0x9B540B19</span>L, <span class="number">0x875FA099</span>L,</span><br><span class="line">     <span class="number">0x95F7997E</span>L, <span class="number">0x623D7DA8</span>L, <span class="number">0xF837889A</span>L, <span class="number">0x97E32D77</span>L, <span class="number">0x11ED935F</span>L,</span><br><span class="line">     <span class="number">0x16681281</span>L, <span class="number">0x0E358829</span>L, <span class="number">0xC7E61FD6</span>L, <span class="number">0x96DEDFA1</span>L, <span class="number">0x7858BA99</span>L,</span><br><span class="line">     <span class="number">0x57F584A5</span>L, <span class="number">0x1B227263</span>L, <span class="number">0x9B83C3FF</span>L, <span class="number">0x1AC24696</span>L, <span class="number">0xCDB30AEB</span>L,</span><br><span class="line">     <span class="number">0x532E3054</span>L, <span class="number">0x8FD948E4</span>L, <span class="number">0x6DBC3128</span>L, <span class="number">0x58EBF2EF</span>L, <span class="number">0x34C6FFEA</span>L,</span><br><span class="line">     <span class="number">0xFE28ED61</span>L, <span class="number">0xEE7C3C73</span>L, <span class="number">0x5D4A14D9</span>L, <span class="number">0xE864B7E3</span>L, <span class="number">0x42105D14</span>L,</span><br><span class="line">     <span class="number">0x203E13E0</span>L, <span class="number">0x45EEE2B6</span>L, <span class="number">0xA3AAABEA</span>L, <span class="number">0xDB6C4F15</span>L, <span class="number">0xFACB4FD0</span>L,</span><br><span class="line">     <span class="number">0xC742F442</span>L, <span class="number">0xEF6ABBB5</span>L, <span class="number">0x654F3B1D</span>L, <span class="number">0x41CD2105</span>L, <span class="number">0xD81E799E</span>L,</span><br><span class="line">     <span class="number">0x86854DC7</span>L, <span class="number">0xE44B476A</span>L, <span class="number">0x3D816250</span>L, <span class="number">0xCF62A1F2</span>L, <span class="number">0x5B8D2646</span>L,</span><br><span class="line">     <span class="number">0xFC8883A0</span>L, <span class="number">0xC1C7B6A3</span>L, <span class="number">0x7F1524C3</span>L, <span class="number">0x69CB7492</span>L, <span class="number">0x47848A0B</span>L,</span><br><span class="line">     <span class="number">0x5692B285</span>L, <span class="number">0x095BBF00</span>L, <span class="number">0xAD19489D</span>L, <span class="number">0x1462B174</span>L, <span class="number">0x23820E00</span>L,</span><br><span class="line">     <span class="number">0x58428D2A</span>L, <span class="number">0x0C55F5EA</span>L, <span class="number">0x1DADF43E</span>L, <span class="number">0x233F7061</span>L, <span class="number">0x3372F092</span>L,</span><br><span class="line">     <span class="number">0x8D937E41</span>L, <span class="number">0xD65FECF1</span>L, <span class="number">0x6C223BDB</span>L, <span class="number">0x7CDE3759</span>L, <span class="number">0xCBEE7460</span>L,</span><br><span class="line">     <span class="number">0x4085F2A7</span>L, <span class="number">0xCE77326E</span>L, <span class="number">0xA6078084</span>L, <span class="number">0x19F8509E</span>L, <span class="number">0xE8EFD855</span>L,</span><br><span class="line">     <span class="number">0x61D99735</span>L, <span class="number">0xA969A7AA</span>L, <span class="number">0xC50C06C2</span>L, <span class="number">0x5A04ABFC</span>L, <span class="number">0x800BCADC</span>L,</span><br><span class="line">     <span class="number">0x9E447A2E</span>L, <span class="number">0xC3453484</span>L, <span class="number">0xFDD56705</span>L, <span class="number">0x0E1E9EC9</span>L, <span class="number">0xDB73DBD3</span>L,</span><br><span class="line">     <span class="number">0x105588CD</span>L, <span class="number">0x675FDA79</span>L, <span class="number">0xE3674340</span>L, <span class="number">0xC5C43465</span>L, <span class="number">0x713E38D8</span>L,</span><br><span class="line">     <span class="number">0x3D28F89E</span>L, <span class="number">0xF16DFF20</span>L, <span class="number">0x153E21E7</span>L, <span class="number">0x8FB03D4A</span>L, <span class="number">0xE6E39F2B</span>L,</span><br><span class="line">     <span class="number">0xDB83ADF7</span>L&#125;,</span><br><span class="line">    &#123;<span class="number">0xE93D5A68</span>L, <span class="number">0x948140F7</span>L, <span class="number">0xF64C261C</span>L, <span class="number">0x94692934</span>L, <span class="number">0x411520F7</span>L,</span><br><span class="line">     <span class="number">0x7602D4F7</span>L, <span class="number">0xBCF46B2E</span>L, <span class="number">0xD4A20068</span>L, <span class="number">0xD4082471</span>L, <span class="number">0x3320F46A</span>L,</span><br><span class="line">     <span class="number">0x43B7D4B7</span>L, <span class="number">0x500061AF</span>L, <span class="number">0x1E39F62E</span>L, <span class="number">0x97244546</span>L, <span class="number">0x14214F74</span>L,</span><br><span class="line">     <span class="number">0xBF8B8840</span>L, <span class="number">0x4D95FC1D</span>L, <span class="number">0x96B591AF</span>L, <span class="number">0x70F4DDD3</span>L, <span class="number">0x66A02F45</span>L,</span><br><span class="line">     <span class="number">0xBFBC09EC</span>L, <span class="number">0x03BD9785</span>L, <span class="number">0x7FAC6DD0</span>L, <span class="number">0x31CB8504</span>L, <span class="number">0x96EB27B3</span>L,</span><br><span class="line">     <span class="number">0x55FD3941</span>L, <span class="number">0xDA2547E6</span>L, <span class="number">0xABCA0A9A</span>L, <span class="number">0x28507825</span>L, <span class="number">0x530429F4</span>L,</span><br><span class="line">     <span class="number">0x0A2C86DA</span>L, <span class="number">0xE9B66DFB</span>L, <span class="number">0x68DC1462</span>L, <span class="number">0xD7486900</span>L, <span class="number">0x680EC0A4</span>L,</span><br><span class="line">     <span class="number">0x27A18DEE</span>L, <span class="number">0x4F3FFEA2</span>L, <span class="number">0xE887AD8C</span>L, <span class="number">0xB58CE006</span>L, <span class="number">0x7AF4D6B6</span>L,</span><br><span class="line">     <span class="number">0xAACE1E7C</span>L, <span class="number">0xD3375FEC</span>L, <span class="number">0xCE78A399</span>L, <span class="number">0x406B2A42</span>L, <span class="number">0x20FE9E35</span>L,</span><br><span class="line">     <span class="number">0xD9F385B9</span>L, <span class="number">0xEE39D7AB</span>L, <span class="number">0x3B124E8B</span>L, <span class="number">0x1DC9FAF7</span>L, <span class="number">0x4B6D1856</span>L,</span><br><span class="line">     <span class="number">0x26A36631</span>L, <span class="number">0xEAE397B2</span>L, <span class="number">0x3A6EFA74</span>L, <span class="number">0xDD5B4332</span>L, <span class="number">0x6841E7F7</span>L,</span><br><span class="line">     <span class="number">0xCA7820FB</span>L, <span class="number">0xFB0AF54E</span>L, <span class="number">0xD8FEB397</span>L, <span class="number">0x454056AC</span>L, <span class="number">0xBA489527</span>L,</span><br><span class="line">     <span class="number">0x55533A3A</span>L, <span class="number">0x20838D87</span>L, <span class="number">0xFE6BA9B7</span>L, <span class="number">0xD096954B</span>L, <span class="number">0x55A867BC</span>L,</span><br><span class="line">     <span class="number">0xA1159A58</span>L, <span class="number">0xCCA92963</span>L, <span class="number">0x99E1DB33</span>L, <span class="number">0xA62A4A56</span>L, <span class="number">0x3F3125F9</span>L,</span><br><span class="line">     <span class="number">0x5EF47E1C</span>L, <span class="number">0x9029317C</span>L, <span class="number">0xFDF8E802</span>L, <span class="number">0x04272F70</span>L, <span class="number">0x80BB155C</span>L,</span><br><span class="line">     <span class="number">0x05282CE3</span>L, <span class="number">0x95C11548</span>L, <span class="number">0xE4C66D22</span>L, <span class="number">0x48C1133F</span>L, <span class="number">0xC70F86DC</span>L,</span><br><span class="line">     <span class="number">0x07F9C9EE</span>L, <span class="number">0x41041F0F</span>L, <span class="number">0x404779A4</span>L, <span class="number">0x5D886E17</span>L, <span class="number">0x325F51EB</span>L,</span><br><span class="line">     <span class="number">0xD59BC0D1</span>L, <span class="number">0xF2BCC18F</span>L, <span class="number">0x41113564</span>L, <span class="number">0x257B7834</span>L, <span class="number">0x602A9C60</span>L,</span><br><span class="line">     <span class="number">0xDFF8E8A3</span>L, <span class="number">0x1F636C1B</span>L, <span class="number">0x0E12B4C2</span>L, <span class="number">0x02E1329E</span>L, <span class="number">0xAF664FD1</span>L,</span><br><span class="line">     <span class="number">0xCAD18115</span>L, <span class="number">0x6B2395E0</span>L, <span class="number">0x333E92E1</span>L, <span class="number">0x3B240B62</span>L, <span class="number">0xEEBEB922</span>L,</span><br><span class="line">     <span class="number">0x85B2A20E</span>L, <span class="number">0xE6BA0D99</span>L, <span class="number">0xDE720C8C</span>L, <span class="number">0x2DA2F728</span>L, <span class="number">0xD0127845</span>L,</span><br><span class="line">     <span class="number">0x95B794FD</span>L, <span class="number">0x647D0862</span>L, <span class="number">0xE7CCF5F0</span>L, <span class="number">0x5449A36F</span>L, <span class="number">0x877D48FA</span>L,</span><br><span class="line">     <span class="number">0xC39DFD27</span>L, <span class="number">0xF33E8D1E</span>L, <span class="number">0x0A476341</span>L, <span class="number">0x992EFF74</span>L, <span class="number">0x3A6F6EAB</span>L,</span><br><span class="line">     <span class="number">0xF4F8FD37</span>L, <span class="number">0xA812DC60</span>L, <span class="number">0xA1EBDDF8</span>L, <span class="number">0x991BE14C</span>L, <span class="number">0xDB6E6B0D</span>L,</span><br><span class="line">     <span class="number">0xC67B5510</span>L, <span class="number">0x6D672C37</span>L, <span class="number">0x2765D43B</span>L, <span class="number">0xDCD0E804</span>L, <span class="number">0xF1290DC7</span>L,</span><br><span class="line">     <span class="number">0xCC00FFA3</span>L, <span class="number">0xB5390F92</span>L, <span class="number">0x690FED0B</span>L, <span class="number">0x667B9FFB</span>L, <span class="number">0xCEDB7D9C</span>L,</span><br><span class="line">     <span class="number">0xA091CF0B</span>L, <span class="number">0xD9155EA3</span>L, <span class="number">0xBB132F88</span>L, <span class="number">0x515BAD24</span>L, <span class="number">0x7B9479BF</span>L,</span><br><span class="line">     <span class="number">0x763BD6EB</span>L, <span class="number">0x37392EB3</span>L, <span class="number">0xCC115979</span>L, <span class="number">0x8026E297</span>L, <span class="number">0xF42E312D</span>L,</span><br><span class="line">     <span class="number">0x6842ADA7</span>L, <span class="number">0xC66A2B3B</span>L, <span class="number">0x12754CCC</span>L, <span class="number">0x782EF11C</span>L, <span class="number">0x6A124237</span>L,</span><br><span class="line">     <span class="number">0xB79251E7</span>L, <span class="number">0x06A1BBE6</span>L, <span class="number">0x4BFB6350</span>L, <span class="number">0x1A6B1018</span>L, <span class="number">0x11CAEDFA</span>L,</span><br><span class="line">     <span class="number">0x3D25BDD8</span>L, <span class="number">0xE2E1C3C9</span>L, <span class="number">0x44421659</span>L, <span class="number">0x0A121386</span>L, <span class="number">0xD90CEC6E</span>L,</span><br><span class="line">     <span class="number">0xD5ABEA2A</span>L, <span class="number">0x64AF674E</span>L, <span class="number">0xDA86A85F</span>L, <span class="number">0xBEBFE988</span>L, <span class="number">0x64E4C3FE</span>L,</span><br><span class="line">     <span class="number">0x9DBC8057</span>L, <span class="number">0xF0F7C086</span>L, <span class="number">0x60787BF8</span>L, <span class="number">0x6003604D</span>L, <span class="number">0xD1FD8346</span>L,</span><br><span class="line">     <span class="number">0xF6381FB0</span>L, <span class="number">0x7745AE04</span>L, <span class="number">0xD736FCCC</span>L, <span class="number">0x83426B33</span>L, <span class="number">0xF01EAB71</span>L,</span><br><span class="line">     <span class="number">0xB0804187</span>L, <span class="number">0x3C005E5F</span>L, <span class="number">0x77A057BE</span>L, <span class="number">0xBDE8AE24</span>L, <span class="number">0x55464299</span>L,</span><br><span class="line">     <span class="number">0xBF582E61</span>L, <span class="number">0x4E58F48F</span>L, <span class="number">0xF2DDFDA2</span>L, <span class="number">0xF474EF38</span>L, <span class="number">0x8789BDC2</span>L,</span><br><span class="line">     <span class="number">0x5366F9C3</span>L, <span class="number">0xC8B38E74</span>L, <span class="number">0xB475F255</span>L, <span class="number">0x46FCD9B9</span>L, <span class="number">0x7AEB2661</span>L,</span><br><span class="line">     <span class="number">0x8B1DDF84</span>L, <span class="number">0x846A0E79</span>L, <span class="number">0x915F95E2</span>L, <span class="number">0x466E598E</span>L, <span class="number">0x20B45770</span>L,</span><br><span class="line">     <span class="number">0x8CD55591</span>L, <span class="number">0xC902DE4C</span>L, <span class="number">0xB90BACE1</span>L, <span class="number">0xBB8205D0</span>L, <span class="number">0x11A86248</span>L,</span><br><span class="line">     <span class="number">0x7574A99E</span>L, <span class="number">0xB77F19B6</span>L, <span class="number">0xE0A9DC09</span>L, <span class="number">0x662D09A1</span>L, <span class="number">0xC4324633</span>L,</span><br><span class="line">     <span class="number">0xE85A1F02</span>L, <span class="number">0x09F0BE8C</span>L, <span class="number">0x4A99A025</span>L, <span class="number">0x1D6EFE10</span>L, <span class="number">0x1AB93D1D</span>L,</span><br><span class="line">     <span class="number">0x0BA5A4DF</span>L, <span class="number">0xA186F20F</span>L, <span class="number">0x2868F169</span>L, <span class="number">0xDCB7DA83</span>L, <span class="number">0x573906FE</span>L,</span><br><span class="line">     <span class="number">0xA1E2CE9B</span>L, <span class="number">0x4FCD7F52</span>L, <span class="number">0x50115E01</span>L, <span class="number">0xA70683FA</span>L, <span class="number">0xA002B5C4</span>L,</span><br><span class="line">     <span class="number">0x0DE6D027</span>L, <span class="number">0x9AF88C27</span>L, <span class="number">0x773F8641</span>L, <span class="number">0xC3604C06</span>L, <span class="number">0x61A806B5</span>L,</span><br><span class="line">     <span class="number">0xF0177A28</span>L, <span class="number">0xC0F586E0</span>L, <span class="number">0x006058AA</span>L, <span class="number">0x30DC7D62</span>L, <span class="number">0x11E69ED7</span>L,</span><br><span class="line">     <span class="number">0x2338EA63</span>L, <span class="number">0x53C2DD94</span>L, <span class="number">0xC2C21634</span>L, <span class="number">0xBBCBEE56</span>L, <span class="number">0x90BCB6DE</span>L,</span><br><span class="line">     <span class="number">0xEBFC7DA1</span>L, <span class="number">0xCE591D76</span>L, <span class="number">0x6F05E409</span>L, <span class="number">0x4B7C0188</span>L, <span class="number">0x39720A3D</span>L,</span><br><span class="line">     <span class="number">0x7C927C24</span>L, <span class="number">0x86E3725F</span>L, <span class="number">0x724D9DB9</span>L, <span class="number">0x1AC15BB4</span>L, <span class="number">0xD39EB8FC</span>L,</span><br><span class="line">     <span class="number">0xED545578</span>L, <span class="number">0x08FCA5B5</span>L, <span class="number">0xD83D7CD3</span>L, <span class="number">0x4DAD0FC4</span>L, <span class="number">0x1E50EF5E</span>L,</span><br><span class="line">     <span class="number">0xB161E6F8</span>L, <span class="number">0xA28514D9</span>L, <span class="number">0x6C51133C</span>L, <span class="number">0x6FD5C7E7</span>L, <span class="number">0x56E14EC4</span>L,</span><br><span class="line">     <span class="number">0x362ABFCE</span>L, <span class="number">0xDDC6C837</span>L, <span class="number">0xD79A3234</span>L, <span class="number">0x92638212</span>L, <span class="number">0x670EFA8E</span>L,</span><br><span class="line">     <span class="number">0x406000E0</span>L&#125;,</span><br><span class="line">    &#123;<span class="number">0x3A39CE37</span>L, <span class="number">0xD3FAF5CF</span>L, <span class="number">0xABC27737</span>L, <span class="number">0x5AC52D1B</span>L, <span class="number">0x5CB0679E</span>L,</span><br><span class="line">     <span class="number">0x4FA33742</span>L, <span class="number">0xD3822740</span>L, <span class="number">0x99BC9BBE</span>L, <span class="number">0xD5118E9D</span>L, <span class="number">0xBF0F7315</span>L,</span><br><span class="line">     <span class="number">0xD62D1C7E</span>L, <span class="number">0xC700C47B</span>L, <span class="number">0xB78C1B6B</span>L, <span class="number">0x21A19045</span>L, <span class="number">0xB26EB1BE</span>L,</span><br><span class="line">     <span class="number">0x6A366EB4</span>L, <span class="number">0x5748AB2F</span>L, <span class="number">0xBC946E79</span>L, <span class="number">0xC6A376D2</span>L, <span class="number">0x6549C2C8</span>L,</span><br><span class="line">     <span class="number">0x530FF8EE</span>L, <span class="number">0x468DDE7D</span>L, <span class="number">0xD5730A1D</span>L, <span class="number">0x4CD04DC6</span>L, <span class="number">0x2939BBDB</span>L,</span><br><span class="line">     <span class="number">0xA9BA4650</span>L, <span class="number">0xAC9526E8</span>L, <span class="number">0xBE5EE304</span>L, <span class="number">0xA1FAD5F0</span>L, <span class="number">0x6A2D519A</span>L,</span><br><span class="line">     <span class="number">0x63EF8CE2</span>L, <span class="number">0x9A86EE22</span>L, <span class="number">0xC089C2B8</span>L, <span class="number">0x43242EF6</span>L, <span class="number">0xA51E03AA</span>L,</span><br><span class="line">     <span class="number">0x9CF2D0A4</span>L, <span class="number">0x83C061BA</span>L, <span class="number">0x9BE96A4D</span>L, <span class="number">0x8FE51550</span>L, <span class="number">0xBA645BD6</span>L,</span><br><span class="line">     <span class="number">0x2826A2F9</span>L, <span class="number">0xA73A3AE1</span>L, <span class="number">0x4BA99586</span>L, <span class="number">0xEF5562E9</span>L, <span class="number">0xC72FEFD3</span>L,</span><br><span class="line">     <span class="number">0xF752F7DA</span>L, <span class="number">0x3F046F69</span>L, <span class="number">0x77FA0A59</span>L, <span class="number">0x80E4A915</span>L, <span class="number">0x87B08601</span>L,</span><br><span class="line">     <span class="number">0x9B09E6AD</span>L, <span class="number">0x3B3EE593</span>L, <span class="number">0xE990FD5A</span>L, <span class="number">0x9E34D797</span>L, <span class="number">0x2CF0B7D9</span>L,</span><br><span class="line">     <span class="number">0x022B8B51</span>L, <span class="number">0x96D5AC3A</span>L, <span class="number">0x017DA67D</span>L, <span class="number">0xD1CF3ED6</span>L, <span class="number">0x7C7D2D28</span>L,</span><br><span class="line">     <span class="number">0x1F9F25CF</span>L, <span class="number">0xADF2B89B</span>L, <span class="number">0x5AD6B472</span>L, <span class="number">0x5A88F54C</span>L, <span class="number">0xE029AC71</span>L,</span><br><span class="line">     <span class="number">0xE019A5E6</span>L, <span class="number">0x47B0ACFD</span>L, <span class="number">0xED93FA9B</span>L, <span class="number">0xE8D3C48D</span>L, <span class="number">0x283B57CC</span>L,</span><br><span class="line">     <span class="number">0xF8D56629</span>L, <span class="number">0x79132E28</span>L, <span class="number">0x785F0191</span>L, <span class="number">0xED756055</span>L, <span class="number">0xF7960E44</span>L,</span><br><span class="line">     <span class="number">0xE3D35E8C</span>L, <span class="number">0x15056DD4</span>L, <span class="number">0x88F46DBA</span>L, <span class="number">0x03A16125</span>L, <span class="number">0x0564F0BD</span>L,</span><br><span class="line">     <span class="number">0xC3EB9E15</span>L, <span class="number">0x3C9057A2</span>L, <span class="number">0x97271AEC</span>L, <span class="number">0xA93A072A</span>L, <span class="number">0x1B3F6D9B</span>L,</span><br><span class="line">     <span class="number">0x1E6321F5</span>L, <span class="number">0xF59C66FB</span>L, <span class="number">0x26DCF319</span>L, <span class="number">0x7533D928</span>L, <span class="number">0xB155FDF5</span>L,</span><br><span class="line">     <span class="number">0x03563482</span>L, <span class="number">0x8ABA3CBB</span>L, <span class="number">0x28517711</span>L, <span class="number">0xC20AD9F8</span>L, <span class="number">0xABCC5167</span>L,</span><br><span class="line">     <span class="number">0xCCAD925F</span>L, <span class="number">0x4DE81751</span>L, <span class="number">0x3830DC8E</span>L, <span class="number">0x379D5862</span>L, <span class="number">0x9320F991</span>L,</span><br><span class="line">     <span class="number">0xEA7A90C2</span>L, <span class="number">0xFB3E7BCE</span>L, <span class="number">0x5121CE64</span>L, <span class="number">0x774FBE32</span>L, <span class="number">0xA8B6E37E</span>L,</span><br><span class="line">     <span class="number">0xC3293D46</span>L, <span class="number">0x48DE5369</span>L, <span class="number">0x6413E680</span>L, <span class="number">0xA2AE0810</span>L, <span class="number">0xDD6DB224</span>L,</span><br><span class="line">     <span class="number">0x69852DFD</span>L, <span class="number">0x09072166</span>L, <span class="number">0xB39A460A</span>L, <span class="number">0x6445C0DD</span>L, <span class="number">0x586CDECF</span>L,</span><br><span class="line">     <span class="number">0x1C20C8AE</span>L, <span class="number">0x5BBEF7DD</span>L, <span class="number">0x1B588D40</span>L, <span class="number">0xCCD2017F</span>L, <span class="number">0x6BB4E3BB</span>L,</span><br><span class="line">     <span class="number">0xDDA26A7E</span>L, <span class="number">0x3A59FF45</span>L, <span class="number">0x3E350A44</span>L, <span class="number">0xBCB4CDD5</span>L, <span class="number">0x72EACEA8</span>L,</span><br><span class="line">     <span class="number">0xFA6484BB</span>L, <span class="number">0x8D6612AE</span>L, <span class="number">0xBF3C6F47</span>L, <span class="number">0xD29BE463</span>L, <span class="number">0x542F5D9E</span>L,</span><br><span class="line">     <span class="number">0xAEC2771B</span>L, <span class="number">0xF64E6370</span>L, <span class="number">0x740E0D8D</span>L, <span class="number">0xE75B1357</span>L, <span class="number">0xF8721671</span>L,</span><br><span class="line">     <span class="number">0xAF537D5D</span>L, <span class="number">0x4040CB08</span>L, <span class="number">0x4EB4E2CC</span>L, <span class="number">0x34D2466A</span>L, <span class="number">0x0115AF84</span>L,</span><br><span class="line">     <span class="number">0xE1B00428</span>L, <span class="number">0x95983A1D</span>L, <span class="number">0x06B89FB4</span>L, <span class="number">0xCE6EA048</span>L, <span class="number">0x6F3F3B82</span>L,</span><br><span class="line">     <span class="number">0x3520AB82</span>L, <span class="number">0x011A1D4B</span>L, <span class="number">0x277227F8</span>L, <span class="number">0x611560B1</span>L, <span class="number">0xE7933FDC</span>L,</span><br><span class="line">     <span class="number">0xBB3A792B</span>L, <span class="number">0x344525BD</span>L, <span class="number">0xA08839E1</span>L, <span class="number">0x51CE794B</span>L, <span class="number">0x2F32C9B7</span>L,</span><br><span class="line">     <span class="number">0xA01FBAC9</span>L, <span class="number">0xE01CC87E</span>L, <span class="number">0xBCC7D1F6</span>L, <span class="number">0xCF0111C3</span>L, <span class="number">0xA1E8AAC7</span>L,</span><br><span class="line">     <span class="number">0x1A908749</span>L, <span class="number">0xD44FBD9A</span>L, <span class="number">0xD0DADECB</span>L, <span class="number">0xD50ADA38</span>L, <span class="number">0x0339C32A</span>L,</span><br><span class="line">     <span class="number">0xC6913667</span>L, <span class="number">0x8DF9317C</span>L, <span class="number">0xE0B12B4F</span>L, <span class="number">0xF79E59B7</span>L, <span class="number">0x43F5BB3A</span>L,</span><br><span class="line">     <span class="number">0xF2D519FF</span>L, <span class="number">0x27D9459C</span>L, <span class="number">0xBF97222C</span>L, <span class="number">0x15E6FC2A</span>L, <span class="number">0x0F91FC71</span>L,</span><br><span class="line">     <span class="number">0x9B941525</span>L, <span class="number">0xFAE59361</span>L, <span class="number">0xCEB69CEB</span>L, <span class="number">0xC2A86459</span>L, <span class="number">0x12BAA8D1</span>L,</span><br><span class="line">     <span class="number">0xB6C1075E</span>L, <span class="number">0xE3056A0C</span>L, <span class="number">0x10D25065</span>L, <span class="number">0xCB03A442</span>L, <span class="number">0xE0EC6E0E</span>L,</span><br><span class="line">     <span class="number">0x1698DB3B</span>L, <span class="number">0x4C98A0BE</span>L, <span class="number">0x3278E964</span>L, <span class="number">0x9F1F9532</span>L, <span class="number">0xE0D392DF</span>L,</span><br><span class="line">     <span class="number">0xD3A0342B</span>L, <span class="number">0x8971F21E</span>L, <span class="number">0x1B0A7441</span>L, <span class="number">0x4BA3348C</span>L, <span class="number">0xC5BE7120</span>L,</span><br><span class="line">     <span class="number">0xC37632D8</span>L, <span class="number">0xDF359F8D</span>L, <span class="number">0x9B992F2E</span>L, <span class="number">0xE60B6F47</span>L, <span class="number">0x0FE3F11D</span>L,</span><br><span class="line">     <span class="number">0xE54CDA54</span>L, <span class="number">0x1EDAD891</span>L, <span class="number">0xCE6279CF</span>L, <span class="number">0xCD3E7E6F</span>L, <span class="number">0x1618B166</span>L,</span><br><span class="line">     <span class="number">0xFD2C1D05</span>L, <span class="number">0x848FD2C5</span>L, <span class="number">0xF6FB2299</span>L, <span class="number">0xF523F357</span>L, <span class="number">0xA6327623</span>L,</span><br><span class="line">     <span class="number">0x93A83531</span>L, <span class="number">0x56CCCD02</span>L, <span class="number">0xACF08162</span>L, <span class="number">0x5A75EBB5</span>L, <span class="number">0x6E163697</span>L,</span><br><span class="line">     <span class="number">0x88D273CC</span>L, <span class="number">0xDE966292</span>L, <span class="number">0x81B949D0</span>L, <span class="number">0x4C50901B</span>L, <span class="number">0x71C65614</span>L,</span><br><span class="line">     <span class="number">0xE6C6C7BD</span>L, <span class="number">0x327A140A</span>L, <span class="number">0x45E1D006</span>L, <span class="number">0xC3F27B9A</span>L, <span class="number">0xC9AA53FD</span>L,</span><br><span class="line">     <span class="number">0x62A80F00</span>L, <span class="number">0xBB25BFE2</span>L, <span class="number">0x35BDD2F6</span>L, <span class="number">0x71126905</span>L, <span class="number">0xB2040222</span>L,</span><br><span class="line">     <span class="number">0xB6CBCF7C</span>L, <span class="number">0xCD769C2B</span>L, <span class="number">0x53113EC0</span>L, <span class="number">0x1640E3D3</span>L, <span class="number">0x38ABBD60</span>L,</span><br><span class="line">     <span class="number">0x2547ADF0</span>L, <span class="number">0xBA38209C</span>L, <span class="number">0xF746CE76</span>L, <span class="number">0x77AFA1C5</span>L, <span class="number">0x20756060</span>L,</span><br><span class="line">     <span class="number">0x85CBFE4E</span>L, <span class="number">0x8AE88DD8</span>L, <span class="number">0x7AAAF9B0</span>L, <span class="number">0x4CF9AA7E</span>L, <span class="number">0x1948C25C</span>L,</span><br><span class="line">     <span class="number">0x02FB8A8C</span>L, <span class="number">0x01C36AE4</span>L, <span class="number">0xD6EBE1F9</span>L, <span class="number">0x90D4F869</span>L, <span class="number">0xA65CDEA0</span>L,</span><br><span class="line">     <span class="number">0x3F09252D</span>L, <span class="number">0xC208E69F</span>L, <span class="number">0xB74E6132</span>L, <span class="number">0xCE77E25B</span>L, <span class="number">0x578FDFE3</span>L,</span><br><span class="line">     <span class="number">0x3AC372E6</span>L&#125;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// f函数</span></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">f</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> res;</span><br><span class="line">  res = S[<span class="number">0</span>][(x &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xff</span>];</span><br><span class="line">  res += S[<span class="number">1</span>][(x &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>];</span><br><span class="line">  res ^= S[<span class="number">2</span>][(x &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>];</span><br><span class="line">  res += S[<span class="number">3</span>][x &amp; <span class="number">0xff</span>];</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">encrypt</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span>* L, <span class="keyword">unsigned</span> <span class="keyword">int</span>* R)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i += <span class="number">2</span>) &#123;</span><br><span class="line">    *L ^= P[i];</span><br><span class="line">    *R ^= f(*L);</span><br><span class="line">    *R ^= P[i + <span class="number">1</span>];</span><br><span class="line">    *L ^= f(*R);</span><br><span class="line">  &#125;</span><br><span class="line">  *L ^= P[<span class="number">16</span>];</span><br><span class="line">  *R ^= P[<span class="number">17</span>];</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> temp = *L;</span><br><span class="line">  *L = *R;</span><br><span class="line">  *R = temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">decrypt</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span>* L, <span class="keyword">unsigned</span> <span class="keyword">int</span>* R)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">16</span>; i &gt; <span class="number">0</span>; i -= <span class="number">2</span>) &#123;</span><br><span class="line">    *L ^= P[i + <span class="number">1</span>];</span><br><span class="line">    *R ^= f(*L);</span><br><span class="line">    *R ^= P[i];</span><br><span class="line">    *L ^= f(*R);</span><br><span class="line">  &#125;</span><br><span class="line">  *L ^= P[<span class="number">1</span>];</span><br><span class="line">  *R ^= P[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> temp = *L;</span><br><span class="line">  *L = *R;</span><br><span class="line">  *R = temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span>* key, <span class="keyword">int</span> keylen)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> l = <span class="number">0</span>, r = <span class="number">0</span>, data = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line">  <span class="comment">//对P数组和密钥进行逐位异或，必要时重用密钥</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; <span class="number">18</span>; i++) &#123;</span><br><span class="line">    data = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">      data &lt;&lt;= <span class="number">8</span>;</span><br><span class="line">      data |= key[index];</span><br><span class="line">      index++;</span><br><span class="line">      <span class="keyword">if</span> (index == keylen) &#123;</span><br><span class="line">        index = <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    P[i] ^= data;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 使用当前的P数组和S-box对全0的64位分组使用BlowFish算法进行加密，用输出代替P[1]、P[2]</span></span><br><span class="line">  <span class="comment">// 重复以上步骤使用当前的P数组和S-box对上一步输出进行加密，并用输出代替P[3]、P[4]，</span></span><br><span class="line">  <span class="comment">//   直到按顺序替代所有的P数组和S-box中的元素为止</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; <span class="number">18</span>; i += <span class="number">2</span>) &#123;</span><br><span class="line">    encrypt(&amp;l, &amp;r);</span><br><span class="line">    P[i] = l;</span><br><span class="line">    P[i + <span class="number">1</span>] = r;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> j = <span class="number">0</span>; j &lt; <span class="number">256</span>; j += <span class="number">2</span>) &#123;</span><br><span class="line">      encrypt(&amp;l, &amp;r);</span><br><span class="line">      S[i][j] = l;</span><br><span class="line">      S[i][j + <span class="number">1</span>] = r;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> <span class="keyword">const</span>* argv[])</span> </span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> l = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> r = <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span>* key = <span class="string">"ASimpleKey"</span>;</span><br><span class="line">  init(key, <span class="number">10</span>);<span class="comment">//init subkey</span></span><br><span class="line">  encrypt(&amp;l, &amp;r);<span class="comment">//encrypt</span></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%x,%x\n"</span>, l, r);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="TEA、XTEA、XXTEA"><a href="#TEA、XTEA、XXTEA" class="headerlink" title="TEA、XTEA、XXTEA"></a>TEA、XTEA、XXTEA</h3><h4 id="关于TEA系列算法"><a href="#关于TEA系列算法" class="headerlink" title="关于TEA系列算法"></a>关于TEA系列算法</h4><blockquote>
<p><strong>微型加密算法</strong>（Tiny Encryption Algorithm，TEA）是一种易于描述和执行的块密码，通常只需要很少的代码就可实现。其设计者是David Wheeler、Roger Needham</p>
<p>TEA的分组长度为64位，密钥长度为128位，采用Feistel网络，建议32次循环加密即64轮</p>
<p>XTEA是TEA的扩展，同样是一个64位块的Feistel密码，使用128位密钥，建议64轮</p>
<p>XXTEA是一个非平衡Feistel网络分组密码，在可变长度块上运行，这些块是32位大小的任意倍数（最小64位），使用128位密钥</p>
<p>TEA系列算法典型特征是采用密钥调度常数<strong>0x9e3779b9</strong></p>
</blockquote>
<h4 id="加解密实现-4"><a href="#加解密实现-4" class="headerlink" title="加解密实现"></a>加解密实现</h4><h5 id="TEA加解密实现"><a href="#TEA加解密实现" class="headerlink" title="TEA加解密实现"></a>TEA加解密实现</h5><p><img src="/images/TEA.png" alt=""></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">encrypt</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span>* v, <span class="keyword">unsigned</span> <span class="keyword">int</span>* key)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> l = v[<span class="number">0</span>], r = v[<span class="number">1</span>], sum = <span class="number">0</span>, delta = <span class="number">0x9e3779b9</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">    sum += delta;</span><br><span class="line">    l += ((r &lt;&lt; <span class="number">4</span>) + key[<span class="number">0</span>]) ^ (r + sum) ^ ((r &gt;&gt; <span class="number">5</span>) + key[<span class="number">1</span>]);</span><br><span class="line">    r += ((l &lt;&lt; <span class="number">4</span>) + key[<span class="number">2</span>]) ^ (l + sum) ^ ((l &gt;&gt; <span class="number">5</span>) + key[<span class="number">3</span>]);</span><br><span class="line">  &#125;</span><br><span class="line">  v[<span class="number">0</span>] = l;</span><br><span class="line">  v[<span class="number">1</span>] = r;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">decrypt</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span>* v, <span class="keyword">unsigned</span> <span class="keyword">int</span>* key)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> l = v[<span class="number">0</span>], r = v[<span class="number">1</span>], sum = <span class="number">0</span>, delta = <span class="number">0x9e3779b9</span>;</span><br><span class="line">  sum = delta *<span class="number">32</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">    r -= ((l &lt;&lt; <span class="number">4</span>) + key[<span class="number">2</span>]) ^ (l + sum) ^ ((l &gt;&gt; <span class="number">5</span>) + key[<span class="number">3</span>]);</span><br><span class="line">    l -= ((r &lt;&lt; <span class="number">4</span>) + key[<span class="number">0</span>]) ^ (r + sum) ^ ((r &gt;&gt; <span class="number">5</span>) + key[<span class="number">1</span>]);</span><br><span class="line">    sum -= delta;</span><br><span class="line">  &#125;</span><br><span class="line">  v[<span class="number">0</span>] = l;</span><br><span class="line">  v[<span class="number">1</span>] = r;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> <span class="keyword">const</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//test</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> v[<span class="number">2</span>]=&#123;<span class="number">1</span>,<span class="number">2</span>&#125;,key[<span class="number">4</span>]=&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%u,%u\n"</span>,v[<span class="number">0</span>],v[<span class="number">1</span>]);</span><br><span class="line">    encrypt(v,key);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%u,%u\n"</span>,v[<span class="number">0</span>],v[<span class="number">1</span>]);</span><br><span class="line">    decrypt(v,key);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%u,%u\n"</span>,v[<span class="number">0</span>],v[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="XTEA加解密实现"><a href="#XTEA加解密实现" class="headerlink" title="XTEA加解密实现"></a>XTEA加解密实现</h5><p><img src="/images/XTEA.PNG" alt=""></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">encrypt</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span>* v, <span class="keyword">unsigned</span> <span class="keyword">int</span>* key)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> l = v[<span class="number">0</span>], r = v[<span class="number">1</span>], sum = <span class="number">0</span>, delta = <span class="number">0x9e3779b9</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">    l += (((r &lt;&lt; <span class="number">4</span>) ^ (r &gt;&gt; <span class="number">5</span>)) + r) ^ (sum + key[sum &amp; <span class="number">3</span>]);</span><br><span class="line">    sum += delta;</span><br><span class="line">    r += (((l &lt;&lt; <span class="number">4</span>) ^ (l &gt;&gt; <span class="number">5</span>)) + l) ^ (sum + key[(sum &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>]);</span><br><span class="line">  &#125;</span><br><span class="line">  v[<span class="number">0</span>] = l;</span><br><span class="line">  v[<span class="number">1</span>] = r;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">decrypt</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span>* v, <span class="keyword">unsigned</span> <span class="keyword">int</span>* key)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> l = v[<span class="number">0</span>], r = v[<span class="number">1</span>], sum = <span class="number">0</span>, delta = <span class="number">0x9e3779b9</span>;</span><br><span class="line">  sum = delta * <span class="number">32</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">    r -= (((l &lt;&lt; <span class="number">4</span>) ^ (l &gt;&gt; <span class="number">5</span>)) + l) ^ (sum + key[(sum &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>]);</span><br><span class="line">    sum -= delta;</span><br><span class="line">    l -= (((r &lt;&lt; <span class="number">4</span>) ^ (r &gt;&gt; <span class="number">5</span>)) + r) ^ (sum + key[sum &amp; <span class="number">3</span>]);</span><br><span class="line">  &#125;</span><br><span class="line">  v[<span class="number">0</span>] = l;</span><br><span class="line">  v[<span class="number">1</span>] = r;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> <span class="keyword">const</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//test</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> v[<span class="number">2</span>]=&#123;<span class="number">1</span>,<span class="number">2</span>&#125;,key[<span class="number">4</span>]=&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%u,%u\n"</span>,v[<span class="number">0</span>],v[<span class="number">1</span>]);</span><br><span class="line">    encrypt(v,key);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%u,%u\n"</span>,v[<span class="number">0</span>],v[<span class="number">1</span>]);</span><br><span class="line">    decrypt(v,key);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%u,%u\n"</span>,v[<span class="number">0</span>],v[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="XXTEA加解密实现"><a href="#XXTEA加解密实现" class="headerlink" title="XXTEA加解密实现"></a>XXTEA加解密实现</h5><p><img src="/images/XXTEA.PNG" alt=""></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MX \</span></span><br><span class="line">  ((z &gt;&gt; <span class="number">5</span> ^ y &lt;&lt; <span class="number">2</span>) + (y &gt;&gt; <span class="number">3</span> ^ z &lt;&lt; <span class="number">4</span>) ^ (sum ^ y) + (k[p &amp; <span class="number">3</span> ^ e] ^ z))</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">btea</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span>* v, <span class="keyword">int</span> n, <span class="keyword">unsigned</span> <span class="keyword">int</span>* k)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> z = v[n - <span class="number">1</span>], y = v[<span class="number">0</span>], sum = <span class="number">0</span>, e, DELTA = <span class="number">0x9e3779b9</span>;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> p, q;</span><br><span class="line">  <span class="keyword">if</span> (n &gt; <span class="number">1</span>) &#123; <span class="comment">/* Coding Part */</span></span><br><span class="line">    q = <span class="number">6</span> + <span class="number">52</span> / n;</span><br><span class="line">    <span class="keyword">while</span> (q-- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      sum += DELTA;</span><br><span class="line">      e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">      <span class="keyword">for</span> (p = <span class="number">0</span>; p &lt; n - <span class="number">1</span>; p++)</span><br><span class="line">        y = v[p + <span class="number">1</span>], z = v[p] += MX;</span><br><span class="line">      y = v[<span class="number">0</span>];</span><br><span class="line">      z = v[n - <span class="number">1</span>] += MX;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (n &lt; <span class="number">-1</span>) &#123; <span class="comment">/* Decoding Part */</span></span><br><span class="line">    n = -n;</span><br><span class="line">    q = <span class="number">6</span> + <span class="number">52</span> / n;</span><br><span class="line">    sum = q * DELTA;</span><br><span class="line">    <span class="keyword">while</span> (sum != <span class="number">0</span>) &#123;</span><br><span class="line">      e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">      <span class="keyword">for</span> (p = n - <span class="number">1</span>; p &gt; <span class="number">0</span>; p--)</span><br><span class="line">        z = v[p - <span class="number">1</span>], y = v[p] -= MX;</span><br><span class="line">      z = v[n - <span class="number">1</span>];</span><br><span class="line">      y = v[<span class="number">0</span>] -= MX;</span><br><span class="line">      sum -= DELTA;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> <span class="keyword">const</span>* argv[])</span> </span>&#123;</span><br><span class="line">  <span class="comment">// test</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v[<span class="number">2</span>] = &#123;<span class="number">1</span>, <span class="number">2</span>&#125;, key[<span class="number">4</span>] = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%u,%u\n"</span>, v[<span class="number">0</span>], v[<span class="number">1</span>]);</span><br><span class="line">  btea(v, <span class="number">2</span>, key);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%u,%u\n"</span>, v[<span class="number">0</span>], v[<span class="number">1</span>]);</span><br><span class="line">  btea(v, <span class="number">-2</span>, key);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%u,%u\n"</span>, v[<span class="number">0</span>], v[<span class="number">1</span>]);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="XXTEA逆向分析"><a href="#XXTEA逆向分析" class="headerlink" title="XXTEA逆向分析"></a>XXTEA逆向分析</h4><blockquote>
<p>文件来源：2019RCTF babyre</p>
</blockquote>
<p>该题大致为输入一个16位字符串经过多次变换最终输出<strong>Bingo!</strong> 即可，由于题目的原因出现多解，故还需满足<strong>md5(rctf{flag})==5f8243a662cf71bf31d2b2602638dc1d</strong>，此处不作解释，由于主要是讲解XXTEA的逆向分析，其他过程暂且不细说，我们看到其中最关键的加密函数<strong>sub_55A0DF892CE0</strong>。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">signed</span> __int64 __fastcall <span class="title">sub_55A0DF892CE0</span><span class="params">(<span class="keyword">int</span> *a1, <span class="keyword">signed</span> <span class="keyword">int</span> a2, __int64 a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  v3 = a3;</span><br><span class="line">  v4 = a2;</span><br><span class="line">  v5 = *a1;</span><br><span class="line">  v43 = a2;</span><br><span class="line">  <span class="keyword">if</span> ( a2 &gt; <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v6 = a2 - <span class="number">1</span>;</span><br><span class="line">    v7 = &amp;a1[a2 - <span class="number">1</span>];</span><br><span class="line">    v8 = <span class="number">0</span>;</span><br><span class="line">    v9 = *v7;</span><br><span class="line">    v10 = ((a2 - <span class="number">4</span>) &amp; <span class="number">0xFFFFFFFE</span>) + <span class="number">2</span>;</span><br><span class="line">    v45 = <span class="number">0x9E3779B9</span> * (<span class="number">52</span> / a2) - <span class="number">0x4AB325AA</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v8 -= <span class="number">0x61C88647</span>;</span><br><span class="line">      v11 = v8 &gt;&gt; <span class="number">2</span>;</span><br><span class="line">      <span class="keyword">if</span> ( v43 &lt;= <span class="number">3</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v14 = <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        v12 = *a1;</span><br><span class="line">        v13 = a1;</span><br><span class="line">        v14 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">        &#123;</span><br><span class="line">          v15 = v13[<span class="number">1</span>];</span><br><span class="line">          v13 += <span class="number">2</span>;</span><br><span class="line">          v16 = (v9 ^ *(_DWORD *)(v3 + <span class="number">4L</span>L * (((<span class="keyword">unsigned</span> __int8)v14 ^ (<span class="keyword">unsigned</span> __int8)v11) &amp; <span class="number">3</span>))) + (v15 ^ v8);</span><br><span class="line">          v17 = v14 + <span class="number">1</span>;</span><br><span class="line">          v14 += <span class="number">2</span>;</span><br><span class="line">          v18 = v12 + ((((v9 &gt;&gt; <span class="number">5</span>) ^ <span class="number">4</span> * v15) + ((v15 &gt;&gt; <span class="number">3</span>) ^ <span class="number">16</span> * v9)) ^ v16);</span><br><span class="line">          v12 = *v13;</span><br><span class="line">          *(v13 - <span class="number">2</span>) = v18;</span><br><span class="line">          v9 = v15</span><br><span class="line">             + (((<span class="number">4</span> * v12 ^ (v18 &gt;&gt; <span class="number">5</span>)) + (<span class="number">16</span> * v18 ^ (v12 &gt;&gt; <span class="number">3</span>))) ^ ((v12 ^ v8)</span><br><span class="line">                                                                    + (v18 ^ *(_DWORD *)(v3</span><br><span class="line">                                                                                       + <span class="number">4L</span>L</span><br><span class="line">                                                                                       * (((<span class="keyword">unsigned</span> __int8)v11 ^ v17) &amp; <span class="number">3</span>)))));</span><br><span class="line">          *(v13 - <span class="number">1</span>) = v9;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> ( v10 != v14 );</span><br><span class="line">      &#125;</span><br><span class="line">      v19 = &amp;a1[v14];</span><br><span class="line">      <span class="keyword">do</span></span><br><span class="line">      &#123;</span><br><span class="line">        v20 = v19[<span class="number">1</span>];</span><br><span class="line">        v21 = v11 ^ v14++;</span><br><span class="line">        ++v19;</span><br><span class="line">        v22 = *(v19 - <span class="number">1</span>)</span><br><span class="line">            + (((v9 ^ *(_DWORD *)(v3 + <span class="number">4L</span>L * (v21 &amp; <span class="number">3</span>))) + (v20 ^ v8)) ^ ((<span class="number">16</span> * v9 ^ (v20 &gt;&gt; <span class="number">3</span>)) + ((v9 &gt;&gt; <span class="number">5</span>) ^ <span class="number">4</span> * v20)));</span><br><span class="line">        *(v19 - <span class="number">1</span>) = v22;</span><br><span class="line">        v9 = v22;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">while</span> ( v6 &gt; v14 );</span><br><span class="line">      v9 = *v7</span><br><span class="line">         + (((v22 ^ *(_DWORD *)(v3 + <span class="number">4L</span>L * (((<span class="keyword">unsigned</span> __int8)v6 ^ (<span class="keyword">unsigned</span> __int8)v11) &amp; <span class="number">3</span>))) + (*a1 ^ v8)) ^ ((<span class="number">4</span> * *a1 ^ (v22 &gt;&gt; <span class="number">5</span>)) + (<span class="number">16</span> * v22 ^ ((<span class="keyword">unsigned</span> <span class="keyword">int</span>)*a1 &gt;&gt; <span class="number">3</span>))));</span><br><span class="line">      *v7 = v9;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v8 != v45 );</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0L</span>L;</span><br><span class="line">  &#125;</span><br><span class="line">  result = <span class="number">1L</span>L;</span><br><span class="line">  <span class="keyword">if</span> ( a2 &lt; <span class="number">-1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v24 = -a2;</span><br><span class="line">    v25 = <span class="number">0x9E3779B9</span> * (<span class="number">52</span> / v24 + <span class="number">6</span>);</span><br><span class="line">    <span class="keyword">if</span> ( v25 )</span><br><span class="line">    &#123;</span><br><span class="line">      v26 = &amp;a1[v24 - <span class="number">1</span>];</span><br><span class="line">      v27 = ~v4;</span><br><span class="line">      v44 = &amp;a1[~v4];</span><br><span class="line">      v28 = ~v4 - <span class="number">2</span> - ((~v4 - <span class="number">3</span>) &amp; <span class="number">0xFFFFFFFE</span>);</span><br><span class="line">      <span class="keyword">do</span></span><br><span class="line">      &#123;</span><br><span class="line">        v29 = v25 &gt;&gt; <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> ( v27 &lt;= <span class="number">2</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          v31 = v27;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          v30 = v44;</span><br><span class="line">          v31 = v27;</span><br><span class="line">          v32 = *v44;</span><br><span class="line">          <span class="keyword">do</span></span><br><span class="line">          &#123;</span><br><span class="line">            v33 = *(v30 - <span class="number">1</span>);</span><br><span class="line">            v30 -= <span class="number">2</span>;</span><br><span class="line">            v34 = v32;</span><br><span class="line">            v32 = *v30;</span><br><span class="line">            v35 = ((v5 ^ v25) + (v33 ^ *(_DWORD *)(v3 + <span class="number">4L</span>L * (((<span class="keyword">unsigned</span> __int8)v31 ^ (<span class="keyword">unsigned</span> __int8)v29) &amp; <span class="number">3</span>)))) ^ ((<span class="number">4</span> * v5 ^ (v33 &gt;&gt; <span class="number">5</span>)) + ((v5 &gt;&gt; <span class="number">3</span>) ^ <span class="number">16</span> * v33));</span><br><span class="line">            v36 = v31 - <span class="number">1</span>;</span><br><span class="line">            v31 -= <span class="number">2</span>;</span><br><span class="line">            v37 = v34 - v35;</span><br><span class="line">            v38 = *v30;</span><br><span class="line">            v30[<span class="number">2</span>] = v37;</span><br><span class="line">            v5 = v33</span><br><span class="line">               - (((<span class="number">16</span> * v38 ^ (v37 &gt;&gt; <span class="number">3</span>)) + ((v32 &gt;&gt; <span class="number">5</span>) ^ <span class="number">4</span> * v37)) ^ ((v32 ^ *(_DWORD *)(v3</span><br><span class="line">                                                                                         + <span class="number">4L</span>L</span><br><span class="line">                                                                                         * (((<span class="keyword">unsigned</span> __int8)v29 ^ v36) &amp; <span class="number">3</span>)))</span><br><span class="line">                                                                      + (v25 ^ v37)));</span><br><span class="line">            v30[<span class="number">1</span>] = v5;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">while</span> ( v28 != v31 );</span><br><span class="line">        &#125;</span><br><span class="line">        v39 = &amp;a1[v31];</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">        &#123;</span><br><span class="line">          v40 = *(v39 - <span class="number">1</span>);</span><br><span class="line">          --v39;</span><br><span class="line">          v5 = v39[<span class="number">1</span>]</span><br><span class="line">             - (((v5 ^ v25) + (v40 ^ *(_DWORD *)(v3 + <span class="number">4L</span>L * (((<span class="keyword">unsigned</span> __int8)v29 ^ (<span class="keyword">unsigned</span> __int8)v31) &amp; <span class="number">3</span>)))) ^ (((v5 &gt;&gt; <span class="number">3</span>) ^ <span class="number">16</span> * v40) + ((v40 &gt;&gt; <span class="number">5</span>) ^ <span class="number">4</span> * v5)));</span><br><span class="line">          v39[<span class="number">1</span>] = v5;</span><br><span class="line">          --v31;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> ( v31 );</span><br><span class="line">        v41 = *a1</span><br><span class="line">            - (((((<span class="keyword">unsigned</span> <span class="keyword">int</span>)*v26 &gt;&gt; <span class="number">5</span>) ^ <span class="number">4</span> * v5) + (<span class="number">16</span> * *v26 ^ (v5 &gt;&gt; <span class="number">3</span>))) ^ ((*(_DWORD *)(v3 + <span class="number">4L</span>L * (v29 &amp; <span class="number">3</span>)) ^ *v26)</span><br><span class="line">                                                                                 + (v25 ^ v5)));</span><br><span class="line">        v42 = v25 == <span class="number">0x9E3779B9</span>;</span><br><span class="line">        v25 += <span class="number">0x61C88647</span>;</span><br><span class="line">        v5 = v41;</span><br><span class="line">        *a1 = v41;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">while</span> ( !v42 );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0L</span>L;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们可以看到反编译的伪代码也是十分清晰的，纵观整个函数，整个函数过程都围绕着<strong>0x9E3779B9</strong>这个魔数，相信很多人都有似曾相识的感觉，没错！该函数与上文的<strong>XXTEA加解密实现</strong>结构基本相同，实现了<strong>XXTEA</strong>加解密。接下来我们看到函数的调用</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sub_55A0DF892CE0(v, -(v10 &gt;&gt; <span class="number">2</span>), key);  <span class="comment">// stea(v,-2,key)</span></span><br></pre></td></tr></table></figure>

<p>结合其他有关信息可以简单看出函数参数v为两个32位无符号数， <strong>-(v10 &gt;&gt; 2)</strong>的值为<strong>-2</strong>，key为128位密钥，它们是<strong>0xE0C7E0C7, 0xC6F1D3D7, 0xC6D3C6D3, 0xC4D0D2CE</strong>，此处调用了XXTEAdecode对两个32位无符号数进行解密，解密结果与之后的常量异或后比较判断</p>
<p>整个题目的核心算法就是XXTEA，只要识别出该算法，那么逆向将变得非常简单，逻辑无非就是输入一个16进制字符串之后hexencode，得到一个64位无符号数（即2个32位无符号数），然后将之2个32位无符号数xxteadecrypt得到新的64位无符号数，此处要求最后一个字节的值小于0x4，并将第（8-最后一个字节的值+1）字节的值置为00，而后将之经下一个函数进行一些位操作验证结果是否等于0x69e2,这一步并不改变原有值无视之，最终验证按字节与0x17异或出来结果是否为Bingo!，结合上面猜测第7字节的值为00，最后一个字节值为0x02，且md5(rctf{flag})==5f8243a662cf71bf31d2b2602638dc1d，由此可以确定最终解密后的64位无符号数的值为0x02XX367870797e55(小端序)，直接写脚本就可以爆破次高8位即可，依次就可以得到该题的flag了</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;openssl/md5.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="comment">// -lcrypto</span></span><br><span class="line"><span class="function"><span class="built_in">string</span> <span class="title">MD5</span><span class="params">(<span class="keyword">const</span> <span class="built_in">string</span>&amp; src)</span> </span>&#123;</span><br><span class="line">  MD5_CTX ctx;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">string</span> md5_string;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> md[<span class="number">16</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">  <span class="keyword">char</span> tmp[<span class="number">33</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">  MD5_Init(&amp;ctx);</span><br><span class="line">  MD5_Update(&amp;ctx, src.c_str(), src.size());</span><br><span class="line">  MD5_Final(md, &amp;ctx);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; ++i) &#123;</span><br><span class="line">    <span class="built_in">memset</span>(tmp, <span class="number">0x00</span>, <span class="keyword">sizeof</span>(tmp));</span><br><span class="line">    <span class="built_in">sprintf</span>(tmp, <span class="string">"%02X"</span>, md[i]);</span><br><span class="line">    md5_string += tmp;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> md5_string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="built_in">string</span> <span class="title">aaa</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span>* v)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">string</span> str;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> j = <span class="number">0</span>; j &lt; <span class="number">8</span>; j += <span class="number">2</span>) &#123;</span><br><span class="line">      <span class="keyword">unsigned</span> <span class="keyword">char</span> cur = v[i] &amp; <span class="number">0xff</span>;</span><br><span class="line">      str += ((cur &amp; <span class="number">0xf0</span>) &gt;&gt; <span class="number">4</span>) &lt; <span class="number">10</span> ? (((cur &amp; <span class="number">0xf0</span>) &gt;&gt; <span class="number">4</span>) + <span class="number">0x30</span>)</span><br><span class="line">                                      : (((cur &amp; <span class="number">0xf0</span>) &gt;&gt; <span class="number">4</span>) + <span class="number">0x57</span>);</span><br><span class="line">      str += (cur &amp; <span class="number">0x0f</span>) &lt; <span class="number">10</span> ? ((cur &amp; <span class="number">0x0f</span>) + <span class="number">0x30</span>) : ((cur &amp; <span class="number">0x0f</span>) + <span class="number">0x57</span>);</span><br><span class="line">      v[i] &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MX \</span></span><br><span class="line">  ((z &gt;&gt; <span class="number">5</span> ^ y &lt;&lt; <span class="number">2</span>) + (y &gt;&gt; <span class="number">3</span> ^ z &lt;&lt; <span class="number">4</span>) ^ (sum ^ y) + (k[p &amp; <span class="number">3</span> ^ e] ^ z))</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">btea</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span>* v, <span class="keyword">int</span> n, <span class="keyword">unsigned</span> <span class="keyword">int</span>* k)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> z = v[n - <span class="number">1</span>], y = v[<span class="number">0</span>], sum = <span class="number">0</span>, e, DELTA = <span class="number">0x9e3779b9</span>;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> p, q;</span><br><span class="line">  <span class="keyword">if</span> (n &gt; <span class="number">1</span>) &#123; <span class="comment">/* Coding Part */</span></span><br><span class="line">    q = <span class="number">6</span> + <span class="number">52</span> / n;</span><br><span class="line">    <span class="keyword">while</span> (q-- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      sum += DELTA;</span><br><span class="line">      e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">      <span class="keyword">for</span> (p = <span class="number">0</span>; p &lt; n - <span class="number">1</span>; p++)</span><br><span class="line">        y = v[p + <span class="number">1</span>], z = v[p] += MX;</span><br><span class="line">      y = v[<span class="number">0</span>];</span><br><span class="line">      z = v[n - <span class="number">1</span>] += MX;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (n &lt; <span class="number">-1</span>) &#123; <span class="comment">/* Decoding Part */</span></span><br><span class="line">    n = -n;</span><br><span class="line">    q = <span class="number">6</span> + <span class="number">52</span> / n;</span><br><span class="line">    sum = q * DELTA;</span><br><span class="line">    <span class="keyword">while</span> (sum != <span class="number">0</span>) &#123;</span><br><span class="line">      e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">      <span class="keyword">for</span> (p = n - <span class="number">1</span>; p &gt; <span class="number">0</span>; p--)</span><br><span class="line">        z = v[p - <span class="number">1</span>], y = v[p] -= MX;</span><br><span class="line">      z = v[n - <span class="number">1</span>];</span><br><span class="line">      y = v[<span class="number">0</span>] -= MX;</span><br><span class="line">      sum -= DELTA;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 55 7e 79 70 78 36 xx 02</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> t[<span class="number">2</span>] = &#123;<span class="number">0x70797e55</span>, <span class="number">0x02003678</span>&#125;;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v[<span class="number">2</span>] = &#123;<span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> key[<span class="number">4</span>] = &#123;<span class="number">0xE0C7E0C7</span>, <span class="number">0xC6F1D3D7</span>, <span class="number">0xC6D3C6D3</span>, <span class="number">0xC4D0D2CE</span>&#125;;</span><br><span class="line">  <span class="built_in">string</span> flagmd5 = <span class="string">"5F8243A662CF71BF31D2B2602638DC1D"</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> i = <span class="number">0x0</span>; i &lt;= <span class="number">0xff</span>; i += <span class="number">0x1</span>) &#123;</span><br><span class="line">    v[<span class="number">0</span>] = t[<span class="number">0</span>];</span><br><span class="line">    v[<span class="number">1</span>] = t[<span class="number">1</span>] | (i &lt;&lt; <span class="number">16</span>);</span><br><span class="line">    <span class="built_in">string</span> flag = <span class="string">""</span>;</span><br><span class="line">    flag += <span class="string">"rctf&#123;"</span>;</span><br><span class="line">    btea(v, <span class="number">2</span>, key);</span><br><span class="line">    flag += aaa(v);</span><br><span class="line">    flag += <span class="string">"&#125;"</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; flag &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">if</span> (MD5(flag) == flagmd5) &#123;</span><br><span class="line">      <span class="built_in">cout</span> &lt;&lt; <span class="string">"success!"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">      <span class="built_in">cout</span> &lt;&lt; flag &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="TX-TEA魔改算法"><a href="#TX-TEA魔改算法" class="headerlink" title="TX TEA魔改算法"></a>TX TEA魔改算法</h4><blockquote>
<p>TX 将TEA算法魔改成16轮（TEA保密的最低要求）并且广泛应用</p>
</blockquote>
<p>相关内容可以看这里<a href="https://github.com/iweizime/StepChanger/wiki/腾讯TEA加密算法" target="_blank" rel="noopener">腾讯TEA加密算法</a></p>
<p>主要就是将加密轮次改为16轮，并且采用改进的CBC模式加密</p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>对于TEA系列算法的识别只要依据常数<strong>0x9e3779b9</strong>并且其相关加密结构就可以很容易判断是TEA、XTEA亦或XXTEA，之后只要找到其密文以及加密密钥辅以以上加解密实现代码就可以很快解密了，TEA算法在逆向分析中，IDA反编译以后一般都是比较清晰的，只要有一定的了解就能轻而易举的识别出对应算法，而后动态调试验证即可，至于findcrypto3插件识别也是依据常数识别的，所以只要知道这个特征即可。</p>
<h4 id="附件"><a href="#附件" class="headerlink" title="附件"></a>附件</h4><p><a href="https://www.lanzous.com/i5572od" target="_blank" rel="noopener">TEA系列算法源码</a></p>
<p><a href="https://www.lanzous.com/i5572qf" target="_blank" rel="noopener">2019RCTF babyre</a></p>
<h4 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h4><p><a href="https://en.wikipedia.org/wiki/Tiny_Encryption_Algorithm" target="_blank" rel="noopener">Tiny Encryption Algorithm</a></p>
<p><a href="https://en.wikipedia.org/wiki/XTEA" target="_blank" rel="noopener">XTEA</a></p>
<p><a href="https://en.wikipedia.org/wiki/XXTEA" target="_blank" rel="noopener">XXTEA</a></p>
<p><a href="https://www.jianshu.com/p/4272e0805da3" target="_blank" rel="noopener">TEA、XTEA、XXTEA加密解密算法</a></p>
<h3 id="RC4"><a href="#RC4" class="headerlink" title="RC4"></a>RC4</h3><h4 id="关于RC4算法"><a href="#关于RC4算法" class="headerlink" title="关于RC4算法"></a>关于RC4算法</h4><blockquote>
<p><strong>RC4</strong>（Rivest Cipher 4）是一种<a href="https://zh.wikipedia.org/wiki/流加密" target="_blank" rel="noopener">流加密</a>算法，密钥长度可变。加解密使用相同的密钥，美国密码学家Ronald Rivest在1987年设计的。</p>
<p>RC4由伪随机数生成器和异或运算组成。密钥长度可变，范围是[1,255]。RC4一个字节一个字节地加解密。给定一个密钥，伪随机数生成器接受密钥并产生一个S盒。S盒用来加密数据，而且在加密过程中S盒会变化。</p>
<p>由于异或运算的对合性，RC4加密解密使用同一套算法。</p>
</blockquote>
<h4 id="加解密实现-5"><a href="#加解密实现-5" class="headerlink" title="加解密实现"></a>加解密实现</h4><h5 id="伪代码"><a href="#伪代码" class="headerlink" title="伪代码"></a><strong>伪代码</strong></h5><h6 id="KSA-the-Key-Scheduling-Algorithm"><a href="#KSA-the-Key-Scheduling-Algorithm" class="headerlink" title="KSA(the Key-Scheduling Algorithm)"></a>KSA(the Key-Scheduling Algorithm)</h6><p>通过密钥调度算法（KSA）初始化长度为256的S盒。第一个for循环将0到255的互不重复的元素装入S盒。第二个for循环根据密钥打乱S盒。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">for i from 0 to 255</span><br><span class="line">    S[i] :&#x3D; i</span><br><span class="line">endfor</span><br><span class="line">j :&#x3D; 0</span><br><span class="line">for( i&#x3D;0 ; i&lt;256 ; i++)</span><br><span class="line">    j :&#x3D; (j + S[i] + key[i mod keylength]) % 256</span><br><span class="line">    swap values of S[i] and S[j]</span><br><span class="line">endfor</span><br></pre></td></tr></table></figure>

<h6 id="PGRA-the-Pseudo-Random-Generation-Algorithm"><a href="#PGRA-the-Pseudo-Random-Generation-Algorithm" class="headerlink" title="PGRA(the Pseudo-Random Generation Algorithm)"></a>PGRA(the Pseudo-Random Generation Algorithm)</h6><p>下面i,j是两个指针。每收到一个字节，就进行while循环。通过一定的算法（(a),(b)）定位S盒中的一个元素，并与输入字节异或，得到k。循环中还改变了S盒（(c)）。如果输入的是明文，输出的就是密文；如果输入的是密文，输出的就是明文。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">i :&#x3D; 0</span><br><span class="line">j :&#x3D; 0</span><br><span class="line">while GeneratingOutput:</span><br><span class="line">    i :&#x3D; (i + 1) mod 256   &#x2F;&#x2F;a</span><br><span class="line">    j :&#x3D; (j + S[i]) mod 256 &#x2F;&#x2F;b</span><br><span class="line">    swap values of S[i] and S[j]  &#x2F;&#x2F;c</span><br><span class="line">    k :&#x3D; inputByte ^ S[(S[i] + S[j]) % 256]</span><br><span class="line">    output K</span><br><span class="line">endwhile</span><br></pre></td></tr></table></figure>

<h5 id="C语言实现"><a href="#C语言实现" class="headerlink" title="C语言实现"></a>C语言实现</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">RC4_init</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span>* Sbox, <span class="keyword">unsigned</span> <span class="keyword">char</span>* key, <span class="keyword">int</span> keylen)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; <span class="number">256</span>; i++) &#123;</span><br><span class="line">    Sbox[i] = i;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">size_t</span> j = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; <span class="number">256</span>; i++) &#123;</span><br><span class="line">    j = (j + Sbox[i] + key[i % keylen]) % <span class="number">256</span>;</span><br><span class="line">    <span class="keyword">char</span> temp = Sbox[i];</span><br><span class="line">    Sbox[i] = Sbox[j];</span><br><span class="line">    Sbox[j] = temp;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">RC4</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span>* Sbox,</span></span></span><br><span class="line"><span class="function"><span class="params">         <span class="keyword">unsigned</span> <span class="keyword">char</span>* data,</span></span></span><br><span class="line"><span class="function"><span class="params">         <span class="keyword">unsigned</span> <span class="keyword">char</span>* key,</span></span></span><br><span class="line"><span class="function"><span class="params">         <span class="keyword">int</span> datalen,</span></span></span><br><span class="line"><span class="function"><span class="params">         <span class="keyword">int</span> keylen)</span> </span>&#123;</span><br><span class="line">  RC4_init(Sbox, key, keylen);</span><br><span class="line">  <span class="keyword">size_t</span> i = <span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">size_t</span> k = <span class="number">0</span>; k &lt; datalen; k++) &#123;</span><br><span class="line">    i = (i + <span class="number">1</span>) % <span class="number">256</span>;</span><br><span class="line">    j = (j + Sbox[i]) % <span class="number">256</span>;</span><br><span class="line">    <span class="keyword">char</span> temp = Sbox[i];</span><br><span class="line">    Sbox[i] = Sbox[j];</span><br><span class="line">    Sbox[j] = temp;</span><br><span class="line">    data[k] ^= Sbox[(Sbox[i] + Sbox[j]) % <span class="number">256</span>];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> <span class="keyword">const</span>* argv[])</span> </span>&#123;</span><br><span class="line">  <span class="comment">//   test</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> Sbox[<span class="number">256</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> data[] = <span class="string">"helloworld"</span>;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> key[] = <span class="string">"1234"</span>;</span><br><span class="line">  RC4(Sbox, data, key, <span class="built_in">strlen</span>(data), <span class="built_in">strlen</span>(key));</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%s\n"</span>, data);</span><br><span class="line">  RC4(Sbox, data, key, <span class="built_in">strlen</span>(data), <span class="built_in">strlen</span>(key));</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%s\n"</span>, data);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"-----------------------------"</span>);</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> datahex[] = &#123;<span class="number">0x68</span>, <span class="number">0x65</span>, <span class="number">0x6c</span>, <span class="number">0x6c</span>, <span class="number">0x6f</span>, <span class="number">0x77</span>,</span><br><span class="line">                             <span class="number">0x6f</span>, <span class="number">0x72</span>, <span class="number">0x6c</span>, <span class="number">0x64</span>, <span class="string">'\0'</span>&#125;;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> keyhex[] = &#123;<span class="number">0x31</span>, <span class="number">0x32</span>, <span class="number">0x33</span>, <span class="number">0x34</span>, <span class="string">'\0'</span>&#125;;</span><br><span class="line">  <span class="comment">//   strlen(key)函数求的是字符串的实际长度，它求得方法是从开始到遇到第一个'\0'</span></span><br><span class="line">  RC4(Sbox, datahex, keyhex, <span class="built_in">strlen</span>(datahex), <span class="built_in">strlen</span>(keyhex));</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%s\n"</span>, datahex);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(datahex); i++)</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%.2x"</span>, (<span class="keyword">int</span>)datahex[i]);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">""</span>);</span><br><span class="line">  RC4(Sbox, datahex, keyhex, <span class="built_in">strlen</span>(datahex), <span class="built_in">strlen</span>(keyhex));</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%s\n"</span>, datahex);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(datahex); i++)</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%.2x"</span>, (<span class="keyword">int</span>)datahex[i]);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">""</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="逆向分析"><a href="#逆向分析" class="headerlink" title="逆向分析"></a>逆向分析</h4><p>RC4反汇编/反编译之后一般有两个函数，一个就是用key初始Sbox，另外一个就是按字节加密字符串，以下两个函数是RC4加密反编译的结果</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> __int64 __fastcall <span class="title">RC4_init</span><span class="params">(__int64 a1, __int64 a2, <span class="keyword">int</span> a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v4; <span class="comment">// ST1F_1</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 i; <span class="comment">// [rsp+1Ch] [rbp-18h]</span></span><br><span class="line">  __int64 v6; <span class="comment">// [rsp+24h] [rbp-10h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 j; <span class="comment">// [rsp+2Ch] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0L</span>L; i &lt;= <span class="number">0xFF</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    result = a1 + i;</span><br><span class="line">    *(_BYTE *)(a1 + i) = i;</span><br><span class="line">  &#125;</span><br><span class="line">  LOBYTE(v6) = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0L</span>L; j &lt;= <span class="number">0xFF</span>; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    v6 = (<span class="keyword">unsigned</span> __int8)(*(_BYTE *)(a1 + j) + v6 + *(_BYTE *)(j % a3 + a2));</span><br><span class="line">    v4 = *(_BYTE *)(a1 + j);</span><br><span class="line">    *(_BYTE *)(j + a1) = *(_BYTE *)(a1 + v6);</span><br><span class="line">    result = v4;</span><br><span class="line">    *(_BYTE *)(v6 + a1) = v4;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">RC4</span><span class="params">(__int64 a1, __int64 a2, __int64 a3, <span class="keyword">int</span> a4, <span class="keyword">int</span> a5)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> v5; <span class="comment">// ST27_1</span></span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// [rsp+4h] [rbp-3Ch]</span></span><br><span class="line">  __int64 v8; <span class="comment">// [rsp+28h] [rbp-18h]</span></span><br><span class="line">  __int64 v9; <span class="comment">// [rsp+30h] [rbp-10h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 i; <span class="comment">// [rsp+38h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v7 = a4;</span><br><span class="line">  RC4_init(a1, a3, a5);</span><br><span class="line">  LOBYTE(v8) = <span class="number">0</span>;</span><br><span class="line">  LOBYTE(v9) = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0L</span>L; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    result = v7;</span><br><span class="line">    <span class="keyword">if</span> ( v7 &lt;= i )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v8 = (<span class="keyword">unsigned</span> __int8)(v8 + <span class="number">1</span>);</span><br><span class="line">    v9 = (<span class="keyword">unsigned</span> __int8)(*(_BYTE *)(a1 + v8) + v9);</span><br><span class="line">    v5 = *(_BYTE *)(a1 + v8);</span><br><span class="line">    *(_BYTE *)(v8 + a1) = *(_BYTE *)(a1 + v9);</span><br><span class="line">    *(_BYTE *)(v9 + a1) = v5;</span><br><span class="line">    *(_BYTE *)(a2 + i) ^= *(_BYTE *)((<span class="keyword">unsigned</span> __int8)(*(_BYTE *)(a1 + v8) + *(_BYTE *)(a1 + v9)) + a1);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>用伪随机数数列初始化Sbox是其最大的特征，另外一个特征就是无论是初始化Sbox还是加密过程都大量用到<strong>unsigned __int8</strong>也就是加密过程中的<strong>mod256</strong>，有一些可执行文件反编译之后就直接是<strong>mod256</strong>，这更好判断，一般RC4题型都是结合base64encode等其他编码方法出题的，解密只要找到key和加密后的字符串利用以上代码解密即可</p>
<h2 id="hash算法"><a href="#hash算法" class="headerlink" title="hash算法"></a>hash算法</h2><h3 id="MD5"><a href="#MD5" class="headerlink" title="MD5"></a>MD5</h3><h4 id="关于MD5"><a href="#关于MD5" class="headerlink" title="关于MD5"></a>关于MD5</h4><blockquote>
<p><strong>MD5消息摘要算法</strong>，一种被广泛使用的密码散列函数，可以产生出一个128位（16字节）的散列值（hash value），用于确保信息传输完整一致。        </p>
</blockquote>
<h4 id="算法原理-5"><a href="#算法原理-5" class="headerlink" title="算法原理"></a>算法原理</h4><h5 id="数据填充"><a href="#数据填充" class="headerlink" title="数据填充"></a>数据填充</h5><p>填充消息使其长度与448模512同余，即使长度满足要求也需填充，填充方法是：附加一个1在消息后面，然后用0填充，直到消息长度与448模512同余，至少填充1位，至多填充512位</p>
<h5 id="添加长度"><a href="#添加长度" class="headerlink" title="添加长度"></a>添加长度</h5><p>在第一步的结果之后附加上64位的消息长度，若消息长度大于2^64则只记录其低64位，附加之后消息长度正好是512的倍数</p>
<h5 id="初始化变量"><a href="#初始化变量" class="headerlink" title="初始化变量"></a>初始化变量</h5><p>A=0X67452301L，B=0XEFCDAB89L，C=0X98BADCFEL，D=0X10325476L</p>
<h5 id="4-处理分组数据并输出"><a href="#4-处理分组数据并输出" class="headerlink" title="4.处理分组数据并输出"></a>4.处理分组数据并输出</h5><p>以512位一一个分组由类似的64次循环构成，分成4组16次。<em>F</em> 一个非线性函数；一个函数运算一次。<em>Mi</em> 表示一个 32-bits 的输入数据，<em>Ki</em>表示一个 32-bits 常数，用来完成每次不同的计算。</p>
<p><img src="/images/MD5.png" alt=""></p>
<p><strong>四个非线性函数为</strong></p>
<p>F( X ,Y ,Z ) = ( X &amp; Y ) | ( (~X) &amp; Z )</p>
<p>G( X ,Y ,Z ) = ( X &amp; Z ) | ( Y &amp; (~Z) )</p>
<p>H( X ,Y ,Z ) =X ^ Y ^ Z</p>
<p>I( X ,Y ,Z ) =Y ^ ( X | (~Z) )</p>
<p>待到所有分组处理完毕后输出一个<strong>128bit</strong>的散列结果</p>
<p><strong>伪代码(from wiki)</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Note: All variables are unsigned 32 bits and wrap modulo 2^32 when calculating</span></span><br><span class="line">var <span class="keyword">int</span>[<span class="number">64</span>] r, k</span><br><span class="line"></span><br><span class="line"><span class="comment">//r specifies the per-round shift amounts</span></span><br><span class="line">r[ <span class="number">0.</span><span class="number">.15</span>]：= &#123;<span class="number">7</span>, <span class="number">12</span>, <span class="number">17</span>, <span class="number">22</span>,  <span class="number">7</span>, <span class="number">12</span>, <span class="number">17</span>, <span class="number">22</span>,  <span class="number">7</span>, <span class="number">12</span>, <span class="number">17</span>, <span class="number">22</span>,  <span class="number">7</span>, <span class="number">12</span>, <span class="number">17</span>, <span class="number">22</span>&#125; </span><br><span class="line">r[<span class="number">16.</span><span class="number">.31</span>]：= &#123;<span class="number">5</span>,  <span class="number">9</span>, <span class="number">14</span>, <span class="number">20</span>,  <span class="number">5</span>,  <span class="number">9</span>, <span class="number">14</span>, <span class="number">20</span>,  <span class="number">5</span>,  <span class="number">9</span>, <span class="number">14</span>, <span class="number">20</span>,  <span class="number">5</span>,  <span class="number">9</span>, <span class="number">14</span>, <span class="number">20</span>&#125;</span><br><span class="line">r[<span class="number">32.</span><span class="number">.47</span>]：= &#123;<span class="number">4</span>, <span class="number">11</span>, <span class="number">16</span>, <span class="number">23</span>,  <span class="number">4</span>, <span class="number">11</span>, <span class="number">16</span>, <span class="number">23</span>,  <span class="number">4</span>, <span class="number">11</span>, <span class="number">16</span>, <span class="number">23</span>,  <span class="number">4</span>, <span class="number">11</span>, <span class="number">16</span>, <span class="number">23</span>&#125;</span><br><span class="line">r[<span class="number">48.</span><span class="number">.63</span>]：= &#123;<span class="number">6</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">21</span>,  <span class="number">6</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">21</span>,  <span class="number">6</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">21</span>,  <span class="number">6</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">21</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Use binary integer part of the sines of integers as constants:</span></span><br><span class="line"><span class="keyword">for</span> i from <span class="number">0</span> to <span class="number">63</span></span><br><span class="line">    k[i] := <span class="built_in">floor</span>(<span class="built_in">abs</span>(<span class="built_in">sin</span>(i + <span class="number">1</span>)) × <span class="number">2</span>^<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//Initialize variables:</span></span><br><span class="line">var <span class="keyword">int</span> h0 := <span class="number">0x67452301</span></span><br><span class="line">var <span class="keyword">int</span> h1 := <span class="number">0xEFCDAB89</span></span><br><span class="line">var <span class="keyword">int</span> h2 := <span class="number">0x98BADCFE</span></span><br><span class="line">var <span class="keyword">int</span> h3 := <span class="number">0x10325476</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Pre-processing:</span></span><br><span class="line">append <span class="string">"1"</span> <span class="built_in">bit</span> to message</span><br><span class="line">append <span class="string">"0"</span> bits until message length in bits ≡ <span class="number">448</span> (mod <span class="number">512</span>)</span><br><span class="line">append <span class="built_in">bit</span> length of message as <span class="number">64</span>-<span class="built_in">bit</span> little-endian integer to message</span><br><span class="line"></span><br><span class="line"><span class="comment">//Process the message in successive 512-bit chunks:</span></span><br><span class="line"><span class="keyword">for</span> each <span class="number">512</span>-<span class="built_in">bit</span> chunk of message</span><br><span class="line">    <span class="keyword">break</span> chunk into sixteen <span class="number">32</span>-<span class="built_in">bit</span> little-endian words w[i], <span class="number">0</span> ≤ i ≤ <span class="number">15</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//Initialize hash value for this chunk:</span></span><br><span class="line">    var <span class="keyword">int</span> a := h0</span><br><span class="line">    var <span class="keyword">int</span> b := h1</span><br><span class="line">    var <span class="keyword">int</span> c := h2</span><br><span class="line">    var <span class="keyword">int</span> d := h3</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Main loop:</span></span><br><span class="line">    <span class="keyword">for</span> i from <span class="number">0</span> to <span class="number">63</span></span><br><span class="line">        <span class="keyword">if</span> <span class="number">0</span> ≤ i ≤ <span class="number">15</span> then</span><br><span class="line">            f := (b <span class="keyword">and</span> c) <span class="keyword">or</span> ((<span class="keyword">not</span> b) <span class="keyword">and</span> d)</span><br><span class="line">            g := i</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> <span class="number">16</span> ≤ i ≤ <span class="number">31</span></span><br><span class="line">            f := (d <span class="keyword">and</span> b) <span class="keyword">or</span> ((<span class="keyword">not</span> d) <span class="keyword">and</span> c)</span><br><span class="line">            g := (<span class="number">5</span>×i + <span class="number">1</span>) mod <span class="number">16</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> <span class="number">32</span> ≤ i ≤ <span class="number">47</span></span><br><span class="line">            f := b <span class="keyword">xor</span> c <span class="keyword">xor</span> d</span><br><span class="line">            g := (<span class="number">3</span>×i + <span class="number">5</span>) mod <span class="number">16</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> <span class="number">48</span> ≤ i ≤ <span class="number">63</span></span><br><span class="line">            f := c <span class="keyword">xor</span> (b <span class="keyword">or</span> (<span class="keyword">not</span> d))</span><br><span class="line">            g := (<span class="number">7</span>×i) mod <span class="number">16</span></span><br><span class="line"> </span><br><span class="line">        temp := d</span><br><span class="line">        d := c</span><br><span class="line">        c := b</span><br><span class="line">        b := leftrotate((a + f + k[i] + w[g]),r[i]) + b</span><br><span class="line">        a := temp</span><br><span class="line">    Next i</span><br><span class="line">    <span class="comment">//Add this chunk's hash to result so far:</span></span><br><span class="line">    h0 := h0 + a</span><br><span class="line">    h1 := h1 + b </span><br><span class="line">    h2 := h2 + c</span><br><span class="line">    h3 := h3 + d</span><br><span class="line">End ForEach</span><br><span class="line">var <span class="keyword">int</span> digest := h0 append h1 append h2 append h3 <span class="comment">//(expressed as little-endian)</span></span><br></pre></td></tr></table></figure>

<h4 id="C语言实现-1"><a href="#C语言实现-1" class="headerlink" title="C语言实现"></a>C语言实现</h4><p><strong>from <a href="https://github.com/pod32g/MD5" target="_blank" rel="noopener">https://github.com/pod32g/MD5</a></strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// from https://github.com/pod32g/MD5</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Simple MD5 implementation</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Compile with: gcc -o md5 md5.c</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Constants are the integer part of the sines of integers (in radians) * 2^32.</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">uint32_t</span> k[<span class="number">64</span>] = &#123;</span><br><span class="line">    <span class="number">0xd76aa478</span>, <span class="number">0xe8c7b756</span>, <span class="number">0x242070db</span>, <span class="number">0xc1bdceee</span>, <span class="number">0xf57c0faf</span>, <span class="number">0x4787c62a</span>,</span><br><span class="line">    <span class="number">0xa8304613</span>, <span class="number">0xfd469501</span>, <span class="number">0x698098d8</span>, <span class="number">0x8b44f7af</span>, <span class="number">0xffff5bb1</span>, <span class="number">0x895cd7be</span>,</span><br><span class="line">    <span class="number">0x6b901122</span>, <span class="number">0xfd987193</span>, <span class="number">0xa679438e</span>, <span class="number">0x49b40821</span>, <span class="number">0xf61e2562</span>, <span class="number">0xc040b340</span>,</span><br><span class="line">    <span class="number">0x265e5a51</span>, <span class="number">0xe9b6c7aa</span>, <span class="number">0xd62f105d</span>, <span class="number">0x02441453</span>, <span class="number">0xd8a1e681</span>, <span class="number">0xe7d3fbc8</span>,</span><br><span class="line">    <span class="number">0x21e1cde6</span>, <span class="number">0xc33707d6</span>, <span class="number">0xf4d50d87</span>, <span class="number">0x455a14ed</span>, <span class="number">0xa9e3e905</span>, <span class="number">0xfcefa3f8</span>,</span><br><span class="line">    <span class="number">0x676f02d9</span>, <span class="number">0x8d2a4c8a</span>, <span class="number">0xfffa3942</span>, <span class="number">0x8771f681</span>, <span class="number">0x6d9d6122</span>, <span class="number">0xfde5380c</span>,</span><br><span class="line">    <span class="number">0xa4beea44</span>, <span class="number">0x4bdecfa9</span>, <span class="number">0xf6bb4b60</span>, <span class="number">0xbebfbc70</span>, <span class="number">0x289b7ec6</span>, <span class="number">0xeaa127fa</span>,</span><br><span class="line">    <span class="number">0xd4ef3085</span>, <span class="number">0x04881d05</span>, <span class="number">0xd9d4d039</span>, <span class="number">0xe6db99e5</span>, <span class="number">0x1fa27cf8</span>, <span class="number">0xc4ac5665</span>,</span><br><span class="line">    <span class="number">0xf4292244</span>, <span class="number">0x432aff97</span>, <span class="number">0xab9423a7</span>, <span class="number">0xfc93a039</span>, <span class="number">0x655b59c3</span>, <span class="number">0x8f0ccc92</span>,</span><br><span class="line">    <span class="number">0xffeff47d</span>, <span class="number">0x85845dd1</span>, <span class="number">0x6fa87e4f</span>, <span class="number">0xfe2ce6e0</span>, <span class="number">0xa3014314</span>, <span class="number">0x4e0811a1</span>,</span><br><span class="line">    <span class="number">0xf7537e82</span>, <span class="number">0xbd3af235</span>, <span class="number">0x2ad7d2bb</span>, <span class="number">0xeb86d391</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// r specifies the per-round shift amounts</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">uint32_t</span> r[] = &#123;<span class="number">7</span>,  <span class="number">12</span>, <span class="number">17</span>, <span class="number">22</span>, <span class="number">7</span>,  <span class="number">12</span>, <span class="number">17</span>, <span class="number">22</span>, <span class="number">7</span>,  <span class="number">12</span>, <span class="number">17</span>, <span class="number">22</span>, <span class="number">7</span>,</span><br><span class="line">                      <span class="number">12</span>, <span class="number">17</span>, <span class="number">22</span>, <span class="number">5</span>,  <span class="number">9</span>,  <span class="number">14</span>, <span class="number">20</span>, <span class="number">5</span>,  <span class="number">9</span>,  <span class="number">14</span>, <span class="number">20</span>, <span class="number">5</span>,  <span class="number">9</span>,</span><br><span class="line">                      <span class="number">14</span>, <span class="number">20</span>, <span class="number">5</span>,  <span class="number">9</span>,  <span class="number">14</span>, <span class="number">20</span>, <span class="number">4</span>,  <span class="number">11</span>, <span class="number">16</span>, <span class="number">23</span>, <span class="number">4</span>,  <span class="number">11</span>, <span class="number">16</span>,</span><br><span class="line">                      <span class="number">23</span>, <span class="number">4</span>,  <span class="number">11</span>, <span class="number">16</span>, <span class="number">23</span>, <span class="number">4</span>,  <span class="number">11</span>, <span class="number">16</span>, <span class="number">23</span>, <span class="number">6</span>,  <span class="number">10</span>, <span class="number">15</span>, <span class="number">21</span>,</span><br><span class="line">                      <span class="number">6</span>,  <span class="number">10</span>, <span class="number">15</span>, <span class="number">21</span>, <span class="number">6</span>,  <span class="number">10</span>, <span class="number">15</span>, <span class="number">21</span>, <span class="number">6</span>,  <span class="number">10</span>, <span class="number">15</span>, <span class="number">21</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// leftrotate function definition</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LEFTROTATE(x, c) (((x) <span class="meta-string">&lt;&lt; (c)) | ((x) &gt;&gt; (32 - (c))))</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">to_bytes</span><span class="params">(<span class="keyword">uint32_t</span> val, <span class="keyword">uint8_t</span>* bytes)</span> </span>&#123;</span><br><span class="line">  bytes[<span class="number">0</span>] = (<span class="keyword">uint8_t</span>)val;</span><br><span class="line">  bytes[<span class="number">1</span>] = (<span class="keyword">uint8_t</span>)(val &gt;&gt; <span class="number">8</span>);</span><br><span class="line">  bytes[<span class="number">2</span>] = (<span class="keyword">uint8_t</span>)(val &gt;&gt; <span class="number">16</span>);</span><br><span class="line">  bytes[<span class="number">3</span>] = (<span class="keyword">uint8_t</span>)(val &gt;&gt; <span class="number">24</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">uint32_t</span> <span class="title">to_int32</span><span class="params">(<span class="keyword">const</span> <span class="keyword">uint8_t</span>* bytes)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="keyword">uint32_t</span>)bytes[<span class="number">0</span>] | ((<span class="keyword">uint32_t</span>)bytes[<span class="number">1</span>] &lt;&lt; <span class="number">8</span>) |</span><br><span class="line">         ((<span class="keyword">uint32_t</span>)bytes[<span class="number">2</span>] &lt;&lt; <span class="number">16</span>) | ((<span class="keyword">uint32_t</span>)bytes[<span class="number">3</span>] &lt;&lt; <span class="number">24</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">md5</span><span class="params">(<span class="keyword">const</span> <span class="keyword">uint8_t</span>* initial_msg, <span class="keyword">size_t</span> initial_len, <span class="keyword">uint8_t</span>* digest)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// These vars will contain the hash</span></span><br><span class="line">  <span class="keyword">uint32_t</span> h0, h1, h2, h3;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Message (to prepare)</span></span><br><span class="line">  <span class="keyword">uint8_t</span>* msg = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">size_t</span> new_len, offset;</span><br><span class="line">  <span class="keyword">uint32_t</span> w[<span class="number">16</span>];</span><br><span class="line">  <span class="keyword">uint32_t</span> a, b, c, d, i, f, g, temp;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Initialize variables - simple count in nibbles:</span></span><br><span class="line">  h0 = <span class="number">0x67452301</span>;</span><br><span class="line">  h1 = <span class="number">0xefcdab89</span>;</span><br><span class="line">  h2 = <span class="number">0x98badcfe</span>;</span><br><span class="line">  h3 = <span class="number">0x10325476</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Pre-processing:</span></span><br><span class="line">  <span class="comment">// append "1" bit to message</span></span><br><span class="line">  <span class="comment">// append "0" bits until message length in bits ≡ 448 (mod 512)</span></span><br><span class="line">  <span class="comment">// append length mod (2^64) to message</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (new_len = initial_len + <span class="number">1</span>; new_len % (<span class="number">512</span> / <span class="number">8</span>) != <span class="number">448</span> / <span class="number">8</span>; new_len++)</span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">  msg = (<span class="keyword">uint8_t</span>*)<span class="built_in">malloc</span>(new_len + <span class="number">8</span>);</span><br><span class="line">  <span class="built_in">memcpy</span>(msg, initial_msg, initial_len);</span><br><span class="line">  msg[initial_len] =</span><br><span class="line">      <span class="number">0x80</span>;  <span class="comment">// append the "1" bit; most significant bit is "first"</span></span><br><span class="line">  <span class="keyword">for</span> (offset = initial_len + <span class="number">1</span>; offset &lt; new_len; offset++)</span><br><span class="line">    msg[offset] = <span class="number">0</span>;  <span class="comment">// append "0" bits</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// append the len in bits at the end of the buffer.</span></span><br><span class="line">  to_bytes(initial_len * <span class="number">8</span>, msg + new_len);</span><br><span class="line">  <span class="comment">// initial_len&gt;&gt;29 == initial_len*8&gt;&gt;32, but avoids overflow.</span></span><br><span class="line">  to_bytes(initial_len &gt;&gt; <span class="number">29</span>, msg + new_len + <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Process the message in successive 512-bit chunks:</span></span><br><span class="line">  <span class="comment">// for each 512-bit chunk of message:</span></span><br><span class="line">  <span class="keyword">for</span> (offset = <span class="number">0</span>; offset &lt; new_len; offset += (<span class="number">512</span> / <span class="number">8</span>)) &#123;</span><br><span class="line">    <span class="comment">// break chunk into sixteen 32-bit words w[j], 0 ≤ j ≤ 15</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">      w[i] = to_int32(msg + offset + i * <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Initialize hash value for this chunk:</span></span><br><span class="line">    a = h0;</span><br><span class="line">    b = h1;</span><br><span class="line">    c = h2;</span><br><span class="line">    d = h3;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Main loop:</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">64</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (i &lt; <span class="number">16</span>) &#123;</span><br><span class="line">        f = (b &amp; c) | ((~b) &amp; d);</span><br><span class="line">        g = i;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (i &lt; <span class="number">32</span>) &#123;</span><br><span class="line">        f = (d &amp; b) | ((~d) &amp; c);</span><br><span class="line">        g = (<span class="number">5</span> * i + <span class="number">1</span>) % <span class="number">16</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (i &lt; <span class="number">48</span>) &#123;</span><br><span class="line">        f = b ^ c ^ d;</span><br><span class="line">        g = (<span class="number">3</span> * i + <span class="number">5</span>) % <span class="number">16</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        f = c ^ (b | (~d));</span><br><span class="line">        g = (<span class="number">7</span> * i) % <span class="number">16</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      temp = d;</span><br><span class="line">      d = c;</span><br><span class="line">      c = b;</span><br><span class="line">      b = b + LEFTROTATE((a + f + k[i] + w[g]), r[i]);</span><br><span class="line">      a = temp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add this chunk's hash to result so far:</span></span><br><span class="line">    h0 += a;</span><br><span class="line">    h1 += b;</span><br><span class="line">    h2 += c;</span><br><span class="line">    h3 += d;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// cleanup</span></span><br><span class="line">  <span class="built_in">free</span>(msg);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// var char digest[16] := h0 append h1 append h2 append h3 //(Output is in</span></span><br><span class="line">  <span class="comment">// little-endian)</span></span><br><span class="line">  to_bytes(h0, digest);</span><br><span class="line">  to_bytes(h1, digest + <span class="number">4</span>);</span><br><span class="line">  to_bytes(h2, digest + <span class="number">8</span>);</span><br><span class="line">  to_bytes(h3, digest + <span class="number">12</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">char</span>* msg;</span><br><span class="line">  <span class="keyword">size_t</span> len;</span><br><span class="line">  <span class="keyword">int</span> i;</span><br><span class="line">  <span class="keyword">uint8_t</span> result[<span class="number">16</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (argc &lt; <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"usage: %s 'string'\n"</span>, argv[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  msg = argv[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">  len = <span class="built_in">strlen</span>(msg);</span><br><span class="line"></span><br><span class="line">  md5((<span class="keyword">uint8_t</span>*)msg, len, result);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// display result</span></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%2.2x"</span>, result[i]);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="md5逆向分析"><a href="#md5逆向分析" class="headerlink" title="md5逆向分析"></a>md5逆向分析</h4><p>逆向分析中如果软件采用openssl等加密库载入od、ida显而易见就可知是md5加密，而对于一些原生的c、c++等语言实现的md5加密算法，也可以通过md5初始化变量这个特征来实现，下面是一个md5加密过程反汇编的结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">push    ebp</span><br><span class="line">mov     ebp, esp</span><br><span class="line">sub     esp, 98h</span><br><span class="line">mov     [ebp+var_40], 0</span><br><span class="line">mov     [ebp+var_C], 67452301h</span><br><span class="line">mov     [ebp+var_10], 0EFCDAB89h</span><br><span class="line">mov     [ebp+var_14], 98BADCFEh</span><br><span class="line">mov     [ebp+var_18], 10325476h</span><br><span class="line">mov     eax, [ebp+arg_4]</span><br><span class="line">add     eax, 1</span><br><span class="line">mov     [ebp+var_1C], eax</span><br><span class="line">jmp     short loc_4015B5</span><br></pre></td></tr></table></figure>

<p>显而易见程序初始化了4个变量，恰好是A=0X67452301L，B=0XEFCDAB89L，C=0X98BADCFEL，D=0X10325476L，据此可以初步识别为md5算法，继续向下追踪明文填充、分组处理进而可以判断加密过程是否为md5算法。</p>
<p>对于 <strong>md5(input) == 常量</strong>一般只能通过诸如爆破的方法求出input，而更多的软件一般都是采用 <strong>md5(input) == sn</strong>对此破解即变得相当简单，简单分析是否为md5变种亦或是对sn还采取了其他算法加密、编码，就可以依此来编写注册机。</p>
<h4 id="md5穷举"><a href="#md5穷举" class="headerlink" title="md5穷举"></a>md5穷举</h4><p>md5算法本身不可逆，解密都是基于彩虹表(cmd5)、暴力破解工具(hashcat)、以及字典</p>
<p><a href="https://cmd5.com/" target="_blank" rel="noopener">cmd5</a>(cmd5实时查询已收录11位及11位以下数字，8位小写字母，7位小写字母加数字，1-6位大小写字母+数字+特殊字符)</p>
<p><a href="https://github.com/hashcat" target="_blank" rel="noopener">hashcat</a></p>
<p><a href="https://xz.aliyun.com/t/4008" target="_blank" rel="noopener">hashcat 用法</a></p>
<h4 id="md5碰撞"><a href="#md5碰撞" class="headerlink" title="md5碰撞"></a>md5碰撞</h4><p>2004年，王小云教授提出了非常高效的MD5碰撞方法。</p>
<p>2009年，冯登国、谢涛利用差分攻击，将MD5的碰撞算法复杂度进一步降低。</p>
<p>以下是一个<strong>md5碰撞</strong>的例子</p>
<p><strong>文件a二进制为</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4DC968FF0EE35C209572D4777B721587D36FA7B21BDC56B74A3DC0783E7B9518AFBFA200A8284BF36E8E4B55B35F427593D849676DA0D1555D8360FB5F07FEA2</span><br></pre></td></tr></table></figure>

<p><strong>文件b二进制为</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4DC968FF0EE35C209572D4777B721587D36FA7B21BDC56B74A3DC0783E7B9518AFBFA202A8284BF36E8E4B55B35F427593D849676DA0D1D55D8360FB5F07FEA2</span><br></pre></td></tr></table></figure>

<p>两个文件都具有共同的md5值<strong>008ee33a9d58b51cfeb425b0959121c9</strong></p>
<p><img src="/images/md5%E7%A2%B0%E6%92%9E.PNG" alt=""></p>
<h4 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h4><p>MD5算法已经不具备安全性，不应将之运用于密码存储、软件加解密等应用上，当然在当前，MD5算法因其普遍、稳定、快速的特点，仍广泛应用于普通数据的错误检查领域。</p>
<h4 id="附件-1"><a href="#附件-1" class="headerlink" title="附件"></a>附件</h4><p><a href="https://www.lanzous.com/i54jpoh" target="_blank" rel="noopener">MD5encrypt 加密源码及可执行文件</a></p>
<p><a href="https://www.lanzous.com/i543jfg" target="_blank" rel="noopener">MD5碰撞例子</a></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Crypto/" rel="tag"><i class="fa fa-tag"></i>Crypto</a>
          
            <a href="/tags/algorithm/" rel="tag"><i class="fa fa-tag"></i>algorithm</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/01/01/Win10-Install-Guide/" rel="next" title="Win10-ReInstall-Guide">
                <i class="fa fa-chevron-left"></i> Win10-ReInstall-Guide
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/02/18/Install-OracleDB-On-CentOS7/" rel="prev" title="Install OracleDB(12cSE) on CentOS7">
                Install OracleDB(12cSE) on CentOS7 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/feng.jpg"
                alt="feng" />
            
              <p class="site-author-name" itemprop="name">feng</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">15</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">12</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/yifeng-lee" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:feng@m.scnu.edu.cn" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#对称加密算法"><span class="nav-number">1.</span> <span class="nav-text">对称加密算法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#DES、3DES"><span class="nav-number">1.1.</span> <span class="nav-text">DES、3DES</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#关于DES"><span class="nav-number">1.1.1.</span> <span class="nav-text">关于DES</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#算法原理"><span class="nav-number">1.1.2.</span> <span class="nav-text">算法原理</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#IP表初始置换"><span class="nav-number">1.1.2.1.</span> <span class="nav-text">IP表初始置换</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#子密钥生成"><span class="nav-number">1.1.2.2.</span> <span class="nav-text">子密钥生成</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#迭代加密"><span class="nav-number">1.1.2.3.</span> <span class="nav-text">迭代加密</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#输出"><span class="nav-number">1.1.2.4.</span> <span class="nav-text">输出</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#图解"><span class="nav-number">1.1.2.5.</span> <span class="nav-text">图解</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#解密"><span class="nav-number">1.1.2.6.</span> <span class="nav-text">解密</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DES加解密实现"><span class="nav-number">1.1.3.</span> <span class="nav-text">DES加解密实现</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DES的扩展3-DES"><span class="nav-number">1.1.4.</span> <span class="nav-text">DES的扩展3-DES</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AES"><span class="nav-number">1.2.</span> <span class="nav-text">AES</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#关于AES"><span class="nav-number">1.2.1.</span> <span class="nav-text">关于AES</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#算法原理-1"><span class="nav-number">1.2.2.</span> <span class="nav-text">算法原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#加解密实现"><span class="nav-number">1.2.3.</span> <span class="nav-text">加解密实现</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#IDEA"><span class="nav-number">1.3.</span> <span class="nav-text">IDEA</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#关于IDEA"><span class="nav-number">1.3.1.</span> <span class="nav-text">关于IDEA</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#算法原理-2"><span class="nav-number">1.3.2.</span> <span class="nav-text">算法原理</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#子密钥生成-1"><span class="nav-number">1.3.2.1.</span> <span class="nav-text">子密钥生成</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#IDEA加密"><span class="nav-number">1.3.2.2.</span> <span class="nav-text">IDEA加密</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#IDEA解密"><span class="nav-number">1.3.2.3.</span> <span class="nav-text">IDEA解密</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#加解密实现-1"><span class="nav-number">1.3.3.</span> <span class="nav-text">加解密实现</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SM4"><span class="nav-number">1.4.</span> <span class="nav-text">SM4</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#关于SM4"><span class="nav-number">1.4.1.</span> <span class="nav-text">关于SM4</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#算法原理-3"><span class="nav-number">1.4.2.</span> <span class="nav-text">算法原理</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#前置知识"><span class="nav-number">1.4.2.1.</span> <span class="nav-text">前置知识</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#密钥扩展算法"><span class="nav-number">1.4.2.2.</span> <span class="nav-text">密钥扩展算法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#加密算法"><span class="nav-number">1.4.2.3.</span> <span class="nav-text">加密算法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#解密算法"><span class="nav-number">1.4.2.4.</span> <span class="nav-text">解密算法</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#加解密实现-2"><span class="nav-number">1.4.3.</span> <span class="nav-text">加解密实现</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BlowFish"><span class="nav-number">1.5.</span> <span class="nav-text">BlowFish</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#关于BlowFish算法"><span class="nav-number">1.5.1.</span> <span class="nav-text">关于BlowFish算法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#算法原理-4"><span class="nav-number">1.5.2.</span> <span class="nav-text">算法原理</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#子密钥生成-2"><span class="nav-number">1.5.2.1.</span> <span class="nav-text">子密钥生成</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#加密"><span class="nav-number">1.5.2.2.</span> <span class="nav-text">加密</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#解密-1"><span class="nav-number">1.5.2.3.</span> <span class="nav-text">解密</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#加解密实现-3"><span class="nav-number">1.5.3.</span> <span class="nav-text">加解密实现</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TEA、XTEA、XXTEA"><span class="nav-number">1.6.</span> <span class="nav-text">TEA、XTEA、XXTEA</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#关于TEA系列算法"><span class="nav-number">1.6.1.</span> <span class="nav-text">关于TEA系列算法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#加解密实现-4"><span class="nav-number">1.6.2.</span> <span class="nav-text">加解密实现</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#TEA加解密实现"><span class="nav-number">1.6.2.1.</span> <span class="nav-text">TEA加解密实现</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#XTEA加解密实现"><span class="nav-number">1.6.2.2.</span> <span class="nav-text">XTEA加解密实现</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#XXTEA加解密实现"><span class="nav-number">1.6.2.3.</span> <span class="nav-text">XXTEA加解密实现</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#XXTEA逆向分析"><span class="nav-number">1.6.3.</span> <span class="nav-text">XXTEA逆向分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#TX-TEA魔改算法"><span class="nav-number">1.6.4.</span> <span class="nav-text">TX TEA魔改算法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#总结"><span class="nav-number">1.6.5.</span> <span class="nav-text">总结</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#附件"><span class="nav-number">1.6.6.</span> <span class="nav-text">附件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#参考文献"><span class="nav-number">1.6.7.</span> <span class="nav-text">参考文献</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RC4"><span class="nav-number">1.7.</span> <span class="nav-text">RC4</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#关于RC4算法"><span class="nav-number">1.7.1.</span> <span class="nav-text">关于RC4算法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#加解密实现-5"><span class="nav-number">1.7.2.</span> <span class="nav-text">加解密实现</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#伪代码"><span class="nav-number">1.7.2.1.</span> <span class="nav-text">伪代码</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#KSA-the-Key-Scheduling-Algorithm"><span class="nav-number">1.7.2.1.1.</span> <span class="nav-text">KSA(the Key-Scheduling Algorithm)</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#PGRA-the-Pseudo-Random-Generation-Algorithm"><span class="nav-number">1.7.2.1.2.</span> <span class="nav-text">PGRA(the Pseudo-Random Generation Algorithm)</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#C语言实现"><span class="nav-number">1.7.2.2.</span> <span class="nav-text">C语言实现</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#逆向分析"><span class="nav-number">1.7.3.</span> <span class="nav-text">逆向分析</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#hash算法"><span class="nav-number">2.</span> <span class="nav-text">hash算法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MD5"><span class="nav-number">2.1.</span> <span class="nav-text">MD5</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#关于MD5"><span class="nav-number">2.1.1.</span> <span class="nav-text">关于MD5</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#算法原理-5"><span class="nav-number">2.1.2.</span> <span class="nav-text">算法原理</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#数据填充"><span class="nav-number">2.1.2.1.</span> <span class="nav-text">数据填充</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#添加长度"><span class="nav-number">2.1.2.2.</span> <span class="nav-text">添加长度</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#初始化变量"><span class="nav-number">2.1.2.3.</span> <span class="nav-text">初始化变量</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-处理分组数据并输出"><span class="nav-number">2.1.2.4.</span> <span class="nav-text">4.处理分组数据并输出</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#C语言实现-1"><span class="nav-number">2.1.3.</span> <span class="nav-text">C语言实现</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#md5逆向分析"><span class="nav-number">2.1.4.</span> <span class="nav-text">md5逆向分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#md5穷举"><span class="nav-number">2.1.5.</span> <span class="nav-text">md5穷举</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#md5碰撞"><span class="nav-number">2.1.6.</span> <span class="nav-text">md5碰撞</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#总结-1"><span class="nav-number">2.1.7.</span> <span class="nav-text">总结</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#附件-1"><span class="nav-number">2.1.8.</span> <span class="nav-text">附件</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright"><font color=black face=STLiti>Copyright &nbsp;</font><font color=black>&copy;</font> <font color=black face=STLiti><span itemprop="copyrightYear">2020</span></font>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder" style="font-family:STLiti;color:black;">feng . All Rights Reserved.</span>

  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
